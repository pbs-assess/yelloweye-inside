---
title: "Evaluation of potential rebuilding strategies for Inside Yelloweye Rockfish (*Sebastes ruberrimus*) in British Columbia"
author: |
  Dana R. Haggarty^1^,
  Quang C. Huynh^2^,
  Robyn E. Forrest^1^,
  Sean C. Anderson^1^,
  Midoli J. Bresch^1^,
  Elise A. Keppel^1^
  
author_list: "Haggarty, D.R.,  Huynh, Q.C., Forrest, R.E.,  Anderson, S.C., Bresch, M.J., Keppel, E.A."
address: |
  ^1^Pacific Biological Station\
     Fisheries and Oceans Canada, 3190 Hammond Bay Road\
     Nanaimo, British Columbia, V9T 6N7, Canada\
  ^2^Institute for the Oceans and Fisheries\
     University of British Columbia AERL, 2202 Main Mall\
     Vancouver, British Columbia, V6T 1Z4, Canada\
year: 2020
report_number: nnn
region: Pacific Region

abstract: |
  Under Canadian policy and legislation, fish stocks that have been assessed as being below the Limit Reference Point (LRP) require a rebuilding plan to grow the stock above the LRP. Rebuilding plans should be based upon objectives characterised by (1) a target, (2) a desired time to reach the target, (3) and an acceptable probability of reaching the target. Rebuilding plans should also include planned management measures or management procedures (MPs), milestone objectives, and should undergo regular evaluation.
  
  The inside stock of Yelloweye Rockfish (*Sebastes ruberrimus*, Inside Yelloweye Rockfish) is a data-limited stock, occurring in Groundfish Management Area 4B (Queen Charlotte Strait, Strait of Georgia, and Strait of Juan de Fuca) in British Columbia (BC). The stock was assessed as being below the LRP in 2010, resulting in a published rebuilding plan. It is also listed under the *Species at Risk Act* (SARA) as a Species of Special Concern. The current MP for rebuilding is a fixed annual total allowable catch (TAC) of 15 metric tonnes, which has not been re-evaluated since the last assessment.
  
  The purpose of this project is to provide scientific advice to support re-evaluation of the rebuilding plan for Inside Yelloweye Rockfish. We apply a new management strategy evaluation (MSE) framework (the MP Framework), recently developed for BC groundfishes, to evaluate the performance of alternative data-limited MPs, with respect to meeting rebuilding objectives. The MP Framework follows six best-practice steps for MSE: (1) defining the decision context, (2) setting objectives and performance metrics, (3) specifying operating models (OMs) to represent the underlying system and calculate performance metrics, (4) selecting candidate MPs, (5) conducting closed-loop simulations to evaluate performance of the MPs, and (6) presenting results to facilitate evaluation of trade-offs.
  
  We followed this framework to evaluate the performance of 34 data-limited MPs with respect to meeting the principal objective, which is to rebuild the stock above the LRP over 1.5 generations with at least 95% [19 times out of 20] probability of success. We also evaluated performance of MPs with respect to two additional conservation metrics, four average-catch objectives, and one catch-variability objective. To account for uncertainty in underlying population dynamics and data sources, we developed six alternative OM scenarios, which differed with respect to specific model and data assumptions. These OM scenarios were divided into a "reference set" (four OMs) and a "robustness set" (two OMs). We conditioned all OMs on observed catch data, indices of abundance, and available age composition data. We used closed-loop simulation to evaluate the performance of the MPs and screened out MPs that did not meet a basic set of criteria, resulting in five remaining candidate MPs: annual constant-catch MPs of 10 tonnes or 15 tonnes, and three MPs that adjust the TAC based on the relative slope of the inside hard-bottom longline (HBLL) survey index of abundance.
  
  All five final MPs met the principle objective with greater than 0.98 probability (49 times out of 50), across all four OM reference set scenarios. This was largely because none of the reference set OMs estimated the stock to be below the LRP in 2020. Within the two OM robustness set scenarios, the scenario that simulated higher variability in the future HBLL survey performed similarly to the reference set scenarios. However, under the scenario that assumed a lower rate of natural mortality for the stock ("Low M"), all MPs had lower probabilities of meeting the principle objective, with the lowest probability achieved by the current MP (constant catch of 15 t).
  
  We present a number of visualizations to show trade-offs among conservation and catch objectives for the different MPs across alternative OM scenarios. The visualizations present trade-offs in tabular and graphical formats, intended to support the process of selecting the final MP. Because all the MPs met the principle objective under the reference set scenarios, there were no strong trade-offs between conservation and catch objectives. Of the two OM robustness set scenarios, trade-offs were most apparent under the Low M scenario, where the probability of meeting the principle objective decreased as the probability of achieving an average short-term catch of 10 t increased.
  
  We discuss major uncertainties, including uncertainty in natural mortality, selectivity, and historical catches, noting that we attempted to account for these uncertainties by evaluating performance of MPs across multiple OMs. We highlight issues regarding estimates of current stock status for Inside Yelloweye Rockfish, and the role of reference points in the MP Framework. We make recommendations for assessment frequency and suggest triggers for re-assessment. Performance of MPs with respect to meeting two alternative assessment criteria for the Committee on the Status of Endangered Wildlife in Canada (COSEWIC) are also evaluated.
header: "Draft working paper --- Do not cite or circulate" # or "" to omit
output:
 csasdown::resdoc_pdf:
   french: true
  # csasdown::resdoc_word
# ------------
# End of options to set
knit: bookdown::render_book
link-citations: true
bibliography: [refs.bib, mpframework-refs.bib]
csl: csl/csas.csl # or csl/csas-french.csl for French
# Any extra LaTeX code for the header:
# header-includes:
# - \usepackage{etex}

---

```{r setup, echo=FALSE, cache=FALSE, message=FALSE, results='hide', warning=FALSE}
library(knitr)
if (is_latex_output()) {
  knitr_figs_dir <- "knitr-figs-pdf/"
  knitr_cache_dir <- "knitr-cache-pdf/"
  fig_out_type <- "png"
} else {
  knitr_figs_dir <- "knitr-figs-docx/"
  knitr_cache_dir <- "knitr-cache-docx/"
  fig_out_type <- "png"
}
fig_asp <- 0.618
fig_width <- 7.5
fig_out_width <- "5.5in"
fig_dpi <- 180
fig_align <- "center"
fig_pos <- "htb"
opts_chunk$set(
  collapse = TRUE,
  warning = FALSE,
  message = FALSE,
  comment = "#>",
  fig.path = knitr_figs_dir,
  cache.path = knitr_cache_dir,
  fig.asp = fig_asp,
  fig.width = fig_width,
  out.width = fig_out_width,
  echo = FALSE,
  autodep = TRUE,
  cache = TRUE,
  cache.comments = FALSE,
  dev = fig_out_type,
  dpi = fig_dpi,
  fig.align = fig_align,
  fig.pos = fig_pos
)
options(xtable.comment = FALSE)
options(kableExtra.latex.load_packages = FALSE)
```

```{r load-libraries, cache=FALSE}
library(gfutilities)
library(csasdown)
library(RColorBrewer)
library(dplyr)
library(tidyr)
library(stringr)
library(ggplot2)
library(here)
filter <- dplyr::filter
options(tinytex.verbose = TRUE)
knitr::opts_chunk$set(crop = NULL)
round2 <- function(x, never_perfect = TRUE) {
  out <- sprintf("%.2f",round(x, 2))
  if (out == "1.00" && never_perfect)
    out <- "> 0.99"
  if (out == "0.00" && never_perfect)
    out <- "< 0.01"
  out
}
```

<!-- The math symbols greater and less than seem to render in RStudio Rmd files when inside $$..$$ chunks but tinytex doesn't recognize them unless the following are defined -->
\newcommand{\lt}{\ensuremath <}
\newcommand{\gt}{\ensuremath >}
\mathchardef\mhyphen="2D

<!--chapter:end:index.Rmd-->

\clearpage

# INTRODUCTION {#sec:introduction}

The purpose of this project is to provide scientific advice to support revision of the rebuilding plan for the inside stock of Yelloweye Rockfish (*Sebastes ruberrimus*)[@ifmp2018], consistent with national policy guidance [@dfo2009; @dfo2013]. 
The project applies a closed-loop simulation framework [@anderson2020gfmp] to evaluate the performance of alternative management procedures (MPs) with respect to rebuilding objectives for the inside stock of Yelloweye Rockfish (hereafter Inside Yelloweye Rockfish).

## MOTIVATION: POLICY AND LEGISLATIVE OBLIGATIONS {#sec:introduction-motivation}

The Canadian Sustainable Fisheries Framework (SFF) lays the foundation for the precautionary approach (PA) to fisheries management in Canada [@dfo2006; @dfo2009].
The PA Framework [@dfo2009] relies on the definition of biological reference points (BRPs), which define biomass targets and low biomass thresholds that are to be avoided with high probability.
The approach requires that fishing mortality be adjusted in relation to two levels of stock status---an Upper Stock Reference (USR) and a Limit Reference Point (LRP) (Figure \@ref(fig:pa-illustration)).
The LRP and USR delineate three stock status zones ("critical", "cautious", and "healthy").

Canadian fish stocks that have been assessed as being below the LRP, i.e., in the critical zone [@dfo2009], require a rebuilding plan to grow the stock above the LRP [@dfo2013].

(ref:fig-pa) Illustration of DFO's Precautionary Approach Framework. Based on @dfo2009.

```{r pa-illustration, fig.cap="(ref:fig-pa)", out.width="3.8in"}
knitr::include_graphics(here::here("figs/pa-framework.png"))
```

In June 2019, major amendments to Canada's *Fisheries Act* legislated many key components of the SFF, which are encoded in the Fish Stocks provisions ([Section 6 of the *Fisheries Act*](https://laws-lois.justice.gc.ca/eng/acts/f-14/page-3.html#h-1175547)).
The Fish Stocks provisions require that major stocks be managed at sustainable levels, specifically at biomass levels above the LRP.
Furthermore,  Section 6.2(1) of the provisions states that if a major fish stock has declined below its LRP, a rebuilding plan shall be established to rebuild the stock above the LRP.
Major fish stocks will be designated under regulations, with the first batch of stocks due to be designated in the fall of 2020.

The guidance for the development of rebuilding plans in Canada [@dfo2013] states that rebuilding plans should be based upon objectives characterised by:

1. A target.
2. A desired time to reach the target.
3. An agreed-upon acceptable probability of reaching the target.

Rebuilding plans should also include planned management measures (i.e., MPs), milestone objectives, and should undergo regular performance reviews (every three years), in addition to annual monitoring and evaluation. 
Current guidance states that the timelines for rebuilding should be 1.5 to 2 times the generation time of the species [@dfo2013], where generation time is the average number of years between the birth of an individual and the birth of its offspring.

## BACKGROUND {#sec:introduction-background}

Inside Yelloweye Rockfish occur in Groundfish Management Area 4B in British Columbia (BC) (Figure \@ref(fig:map-4B)).
The stock is expected to be designated as a major fish stock in the fall of 2020, at which time its management will be legislated under the Fish Stocks provisions.
The stock was assessed as being below the LRP in 2010 [@yamanaka2011; @dfo2012].
In response, a rebuilding plan was developed and published in Appendix 9 of the Pacific Region Integrated Fishery Management Plan (IFMP) for Groundfish [@ifmp2018].
The Inside Yelloweye stock is also listed under the *Species at Risk Act* (SARA) as a Species of Special Concern [@cosewic2008], and is anticipated to be reassessed by the Committee on the Status of Endangered Wildlife in Canada (COSEWIC) in 2020.
Results from this project may inform the COSEWIC reassessment and, potentially, a SARA Recovery Potential Assessment, should one be required (see Appendix \@ref(app:cosewic)).

(ref:fig-map-4B) Map of Groundfish Management Area 4B showing rockfish conservation areas (RCAs) and the boundaries separating the Inside Yelloweye Rockfish designatable unit (DU) from the Outside Yelloweye Rockfish DU. The red lines indicate a proposed adjustment to the range for the Inside DU, based on recent genetic evidence [@andrews2018; @siegle2011; @siegle2013]. 

```{r map-4B, fig.cap="(ref:fig-map-4B)", out.width="5in"}
knitr::include_graphics(here::here("figs/InsideYE_Map_new.png"))
```

The current rebuilding plan objective is to "rebuild the stock above the LRP over 80 years with 56% probability of success".
The milestone objective is to "achieve positive trends within each 10 year period".
The current MP for Inside Yelloweye Rockfish aims to keep the total annual catch (commercial, recreational, First Nations food, social and ceremonial (FSC), and survey) below 15 tonnes (see Appendix 9 of @ifmp2018 for details).

The guidance for rebuilding plans in Canada states that there should be a high probability of rebuilding fish stocks out of the critical zone within the stated time-frame [@dfo2013].
Part of the motivation for this project was concern, expressed by fisheries managers, that the 56% probability of success stated in the current rebuilding plan [@ifmp2018] is inconsistent with the definition of high probability.

The guidance document also identifies some recommended management measures, which include: keeping removals from all sources to the lowest possible level; development of a harvest control rule (HCR); and application of management strategy evaluation (MSE) to evaluate, via simulation, the performance of alternative management measures with respect to meeting rebuilding objectives for the stock [@dfo2013].
The current rebuilding plan implements an annual fixed TAC of 15 metric tonnes [@ifmp2018], which has not been simulation-tested.

Yelloweye Rockfish are a long-lived species [up to 121 years in B.C., @keppel2019], occurring in rocky demersal habitats that have a patchy, discontinuous distribution along BC's inner coast [@yamanaka2011].
These life history traits make the species vulnerable to overexploitation by fisheries.
The inside stock is considered to be data-limited, as there is sparse availability of age-composition data, a lack of biological data from commercial, recreational, and First Nations' fisheries, and uncertainty in the magnitude of historical catches.

## MANAGEMENT STRATEGY EVALUATION (MSE) {#sec:introduction-mse}

Worldwide, the provision of scientific advice for managing fisheries has been moving towards MSE (or management-oriented) approaches [e.g., @butterworth1999; @rademeyer2007; @berkson2015; @geromont2015; @punt2016; @carruthers2016].
MSE focuses on identifying MPs that perform best, with respect to meeting agreed-upon policy and fishery objectives, when implemented in a "closed-loop" simulation environment (Figure \@ref(fig:mse-chart-basic)).
In output-controlled fisheries, such as the quota-managed BC groundfish fishery, MPs describe management measures for setting catch limits.
MPs can vary greatly in their data demands, from very data-rich approaches, including statistical catch-at-age stock assessments with harvest control rules, to simple data rules ("data-limited" approaches), which only rely on catch data and an index of abundance [e.g., @geromont2015; @carruthers2016].

Closed-loop simulation is distinguished from conventional stock assessment approaches because it simulates feedback between implementation of MPs and the underlying system (the fish stock and its environment), which is described by one or more operating models (OMs).
The closed-loop simulation approach takes into account the effect of the MPs on the system, as well as the future data collected from the system and its use in the MPs [@punt2016; @carruthers2018; @anderson2020gfmp].

(ref:fig-mse-chart-basic) Illustration of the fisheries closed-loop simulation process from @anderson2020gfmp following @punt2016. The management procedure may be based on a simple data rule (e.g., decrease the allowable catch x% if the survey index decreases y%) or it might be an estimation model combined with a harvest control rule.

```{r mse-chart-basic, fig.cap="(ref:fig-mse-chart-basic)", out.width="6.3in"}
knitr::include_graphics(here::here("figs/mse-chart-simple2.png"))
```
 
## APPROACH {#sec:introduction-approach}

Data-limitations for the Inside Yelloweye stock pose a challenge to evaluating the expected performance of management measures needed to bring the stock into compliance with the Fish Stocks provisions, i.e., to build the stock out of the critical zone within the agreed time-frame and with the agreed probability.
Closed-loop simulation-testing of data-limited MPs allows for evaluation of the relative performance of MPs across a range of uncertainties in, for example, underlying fish biology, observation error, estimation error, and implementation error [e.g., @kell2006; @carruthers2016].

Since 2017, a partnership agreement between the University of British Columbia (UBC) and DFO [@dfo_dlmtool_2017] has supported development of two open-source software packages for MSE, implemented in the statistical programming environment R [@r2019]: the Data Limited Methods toolkit (DLMtool) [@carruthers2018; @carruthers_hordyk_2018] and the Management Strategy Evaluation toolkit (MSEtool) [@huynh_msetool_2019].
After several years of development, these packages provide some of the fastest, most flexible and extensible software for conducting MSE for fisheries. They can be applied to data-poor or data-rich stocks, enabling rapid assessment of multiple MPs according to customizable conservation and fisheries objectives, and evaluation of key trade-offs.

### The Management Procedure Framework for Groundfish in British Columbia {#sec:introduction-mp-framework}

Concurrently with the development of this document, a management procedure framework (MP Framework) for Groundfish in British Columbia [@anderson2020gfmp] has been developed for evaluating performance of a wide range of MPs for data-limited groundfish species.
The MP Framework uses the functionality of DLMtool and MSEtool extensively, supported by an R package gfdlm [@gfdlm] written by the authors of @anderson2020gfmp, which houses a suite of software support tools and custom visualizations.

We follow the MP Framework for selecting MPs to set catch limits for data-limited groundfish stocks [@anderson2020gfmp].
Our evaluation of the Inside Yelloweye rebuilding plan represents the first application of the MP Framework for providing science advice in support of catch decisions.
The framework follows six best practice steps described below and in greater detail in @anderson2020gfmp.

The best practice steps are based on a review by @punt2016, who identified five key steps in the MSE process (Steps 2--6 below).
An additional first step of the MP Framework, defining the decision context, was identified by @gregory2012 and @cox2016.
In large part, the DLMtool software has been designed to allow practitioners to follow these steps [Figure \@ref(fig:mse-chart); @carruthers2018].

(ref:fig-mse-chart) The steps of the MSE process following @punt2016 as implemented in DLMtool. Copied from @anderson2020gfmp and adapted from @carruthers2018. This figure expands on Figure \@ref(fig:mse-chart-basic).

```{r mse-chart, fig.cap="(ref:fig-mse-chart)", out.width="\\textwidth"}
knitr::include_graphics(here::here("figs/mse-chart.png"))
```

The six steps are as follows:

  Step 1: Definition of the decision context.

  Step 2: Selection of objectives and performance metrics.

  Step 3: Selection of uncertainties/specification of operating models.

  Step 4: Identification of candidate management procedures.

  Step 5: Simulation of the application of the management procedures.

  Step 6: Presentation of results and selection of management procedure.

After selection and implementation of the MP for setting the catch limit (Figure \@ref(fig:mse-chart); e.g., applying the selected MP algorithm to the observed survey index), a final necessary step is to periodically monitor and evaluate the performance of the MP [@dfo2013; @dowling2015a; @carruthers2018]. 
This may be done through informal means, e.g., via feedback from fishers and survey information [e.g., @cox2008a], or through more formal statistical measures, where observed data are compared to predictions from the OMs to test whether the system is performing as expected [@butterworth2008; @carruthers_hordyk_2018; discussed in @anderson2020gfmp].

In the following sections, we describe our approach for developing a candidate rebuilding plan for Inside Yelloweye Rockfish, following the six best practice steps.


<!--chapter:end:00-introduction.Rmd-->

# DEFINE THE DECISION CONTEXT {#sec:decision-context}

Key questions to guide defining the decision context for MSE include:

* What is the exact decision to be made?

* What is the time frame for making the decision?

* What are specific roles and responsibilities of parties involved? Parties include Science, Management, First Nations, industry, academia, and/or non-governmental organizations (NGOs).

* How will the final decision be made?

For this rebuilding plan, the decision to be made is which MP to use to determine catch limits for the period until the next available catch advice.
The final decision on the MP to determine future catch limits should be made based on a consensus by the Regional Peer Review (RPR) committee, after review of the scientific content of the advice (including the structure and content of the OMs), and consideration of the relative performance of the MPs and trade-offs among performance metrics.

<!--chapter:end:01-decision-context.Rmd-->

# SELECTION OF OBJECTIVES AND PERFORMANCE METRICS  {#sec:objectives-metrics}

Clear management and fishery objectives must be identified, along with the performance metrics that measure them.
Objectives may span a wide range of policy or legislated objectives (e.g., maintaining the stock above the LRP), economic objectives (e.g., maintaining an average catch or reducing variability in catch), and cultural objectives (e.g., maintaining minimum required access to the stock or specific fishing areas). In a rebuilding scenario, conservation objectives must take precedence. However, in a simulation framework it is possible to examine trade-offs between conservation and other short and long-term fishery objectives, so long as the primary conservation objective is met. 
Fully quantified objectives include a metric or target, the desired probability of success, and a time frame to achieve the objective (e.g., probability of maintaining the stock above the LRP is greater than 0.95 [19 times out of 20], over 1.5 generations of the stock).
Performance metrics are quantified measures of the objectives. In closed-loop simulation, they are calculated in the OM at each time step of the projections.

The original rebuilding plan objective was to
rebuild the stock above the LRP over 80 years with 56% probability of success. An additional milestone objective was to achieve positive biomass trends within each 10 year period.
The MP that was agreed upon to meet these objectives was to maintain the combined TAC (commercial, recreational, FSC, biological survey) below 15 tonnes annually [@ifmp2018].

## OBJECTIVES AND MILESTONES {#sec:objectives-metrics-obj}

We present a set of refined objectives and associated performance metrics for the rebuilding plan for Inside Yelloweye Rockfish.
Key provisional conservation objectives are guided by the PA Framework
[@dfo2006; @dfo2009], the rebuilding plan guidance document [@dfo2013], and regional precedents [@cox2019; @cox2020].
Additional objectives related to fisheries yield and variability in annual fisheries yield are based on precedents in other DFO Pacific Region analyses [e.g., @cox2008a; @forrest2018; @cox2019; @cox2020].

The proposed core conservation objective is:

1. Rebuild the stock above the LRP over 56 years (1.5 generations) with at least 95% [19 times out of 20] probability of success.

We adjusted the original rebuilding time-frame of 80 years [@ifmp2018] to 56 years in this analysis, based on the estimated generation time for outside Yelloweye Rockfish [@cox2020], reflecting the guidance that rebuilding should be achieved within 1.5 to 2 generation times [@dfo2013].
For more information on generation time, please see Appendix \@ref(app:biological-data), Section \@ref(sec:generation).
The desired probability of success was increased from 56% to 95% to reflect rebuilding guidance that the probability of rebuilding should be high, and international best practice, where policies in numerous jurisdictions aim to keep stocks above the LRP with 90-95% probability [18 to 19 times out of 20][@sainsbury2008; @mcilgorm2013].

We also propose the following additional objectives, further specified in Section \@ref(sec:objectives-metrics-pm):

2. Rebuild the stock above the USR over 56 years (1.5 generations).

3. Rebuild the stock above the LRP over 38 years (1 generation).

4. Given the above conservation objectives are achieved, maintain an average target catch in the short and long term.

5. Given the above conservation objectives are achieved, minimize variability in fisheries catch from year to year.

Note that we did not assign target probabilities to these objectives as they are provided for the purpose of evaluating trade-offs with Objective 1.
However, we screened out MPs that did not meet a minimum probability of maintaining catch above 10 t in the short-term (see Section \@ref(sec:simulation)).

In addition to the above objectives, we propose refining the milestones identified in the original rebuilding plan [@ifmp2018] with the italicized text as follows:

6. Achieve positive biomass trends within each 10 year period *for as long as the stock remains below the LRP*.

The 10 year period identified in the milestones for the current Inside Yelloweye rebuilding plan [@ifmp2018] reflected an assumption that rebuilding out of the critical zone could be very slow for this stock.
We adjusted the milestone to reflect the assumption that, once the stock is no longer in the critical zone, the milestone would no longer be required.
The current rebuilding guidance [@dfo2013] only provides for objectives to build stocks out of the critical zone, with milestones intended to ensure progress is achieved during the rebuilding process.
The guidance does discuss having longer-term objectives to keep rebuilding stocks into the healthy zone, above the USR.
However, this is supposed to be achieved beyond the period and scope of the rebuilding plan [@dfo2013].

## PERFORMANCE METRICS {#sec:objectives-metrics-pm}

We propose the following performance metrics to measure the objectives, where *B* represents spawning biomass, MSY refers to maximum sustainable yield, *B*~MSY~ refers to equilibrium spawning biomass at MSY, GT represents generation time, and AADC represents average absolute deviation in catch ($C$) over $n$ years (note: *ST* = short term, *LT* = long term).
We define the LRP and USR as 0.4*B*~MSY~ and 0.8*B*~MSY~, respectively, following the provisional definitions in the PA Framework [@dfo2006], as used in the 2010 stock assessment [@yamanaka2011].
In the closed-loop simulations, all reference points and performance metrics are calculated in the OM.
Raw performance metrics are calculated in each of the 100 years of the projection period and summarized according to the time-frame of interest:

1. **LRP 1.5GT**: P(*B* > 0.4 *B*~MSY~) after 1.5 GT (in 2075, year 56 of the projection period)
2. **USR 1.5GT**: P(*B* > 0.8 *B*~MSY~) after 1.5 GT (in 2075, year 56 of the projection period)
3. **LRP 1GT**: P(*B* > 0.4 *B*~MSY~) after 1 GT (in 2057, year 38 of the projection period)
4. **ST C10**: P(average catch > 10 t) during 2020--2029, years 1--10 of the projection period  
5. **ST C15**: P(average catch > 15 t) during 2020--2029, years 1--10 of the projection period
<!-- 6. ST C20: P(catch > 20 t) during 2020--2029 RF: we don't report this one-->
6. **LT C20**: P(average catch > 20 t) after 1 GT (in 2057, year 38 of the projection period)
7. **ST AADC**: P(AADC~2020--2029~ < AADC~2012--2019~)

We included the performance metric LRP 1 GT as a check that the MPs do not crash the stock in the short term.
We selected 10 t, 15 t and 20 t as catch targets, representing catch levels spanning 5 t below and above the current 15 t TAC.

We calculated AADC~2020--2029~ as:

$$
\textrm{AADC}_\textrm{2020-2029} = \dfrac{1}{9}\sum_{y=2021}^{2029} \mid C_y - C_{y-1} \mid.
$$

A baseline period (2012--2019) was selected because it is the period since the start of the 15 t TAC. We calculated AADC~2012--2019~ as:

$$
\textrm{AADC}_\textrm{2012-2019} = \dfrac{1}{7}\sum_{y=2013}^{2019} \mid C_y - C_{y-1} \mid.
$$

In cases where performance metrics are calculated over a range of years, care needs to be taken to clearly report how summary statistics are calculated.
@anderson2020gfmp provisionally suggested calculating performance statistics across replicates and years for the entire time window defined for the performance metric.
We follow this protocol here.
For example, we averaged the short-term catch metrics over replicates and the years 2020--2029.

<!--chapter:end:02-objectives.Rmd-->

# SELECTION OF UNCERTAINTIES/SPECIFICATION OF OPERATING MODELS {#sec:om}

DLMtool OMs are organized into four main components representing a real fished system:

1. population dynamics of the fish stock (e.g., growth, recruitment, mortality);
2. fishery dynamics (e.g., selectivity, spatial targeting);
3. observation processes (e.g., bias and precision in survey indices); and
4. management implementation (e.g., catch limit overages).

Equations and parameters describing the four OM components are provided in detail in Appendix B of @carruthers2018 and Appendix A of @anderson2020gfmp.
DLMtool allows the incorporation of uncertainty in many OM parameters through optional specification of probability distributions.
To further isolate the effects of specific sources of uncertainty on performance of MPs, we develop alternative OMs that change the value (or distribution) of one or more parameters and/or data sources of interest (Section \@ref(sec:approach3-oms)).

Best practice recommends calibrating or conditioning OMs with observed data, so they can reproduce historical observations.
DLMtool's companion software package, MSEtool [@huynh_msetool_2019], includes an efficient implementation of a stock reduction analysis (SRA) [@kimura1982; @walters2006], which is effectively a statistical catch-at-age model that estimates the combinations of historical fishing mortality and recruitment that would be consistent with the observed data. The SRA is fully described in Appendix B of @anderson2020gfmp.

There are two distinct time-periods in the simulation framework:
(1) the historical period, which includes all years from the first year of the observed catch time series $t_1$ to the final year of the observed catch time series $t_c$ (where "c" represents the "current" year); and
(2) the projection period, which covers the period from the first year after $t_c$ to the final projection year $t_N$.
The historical period is conditioned on historical observations using the SRA [see Appendix B of @anderson2020gfmp].
The closed-loop simulations, with application of the MPs and calculation of performance metrics, begin in the first year of the projection period (year $t_{c+1}$).

OM development in the MP Framework follows three steps:

1. Set parameter values and ranges in the OM.

2. Pass the OM parameters to the SRA model, which conditions the OM by fitting to historical observed catches, indices of abundance, and any available years of age-composition data.
This results in conditioned estimates of model parameters and estimates of historical biomass and historical fishing mortality (in years $t_1$ to $t_c$), which are consistent with historical observations.

3. Pass the conditioned parameter values back to the OM (now the "conditioned" OM) for use in the closed-loop simulation projections, starting in year $t_{c+1}$.

Where possible, we derived OM settings from all available survey biological data from area 4B, which is primarily collected on the inside hard bottom longline (HBLL) surveys (Appendix \@ref(app:biological-data)).
We derived other parameters from the scientific literature and stock assessments for Yelloweye Rockfish in other areas (see Appendix \@ref(app:desc-om-yelloweye) for details).
A list of "default" OM parameter settings recommended for most BC groundfish stocks is provided in Appendix C of @anderson2020gfmp.

We conditioned the OMs with the SRA, using age-composition data from research surveys (Appendix \@ref(app:biological-data)), inside HBLL survey indices (Appendix \@ref(app:index-data)), and commercial and recreational catch data (Appendix \@ref(app:catch-data)).
Results from conditioning the OMs are provided below in Section \@ref(sec:approach3-conditioning).

## OPERATING MODELS {#sec:approach3-oms}

MSE best practice recommends dividing MSE trials into a "reference set" of core OMs that include the most important uncertainties (e.g., depletion of the stock or range of natural mortality values), and a "robustness set", to capture a wider range of uncertainties that may be less plausible but should nonetheless be explored [@rademeyer2007].
@anderson2020gfmp recommended presenting performance metrics from the reference and robustness sets separately.
They recommended that, for most results, reference set performance metrics should be averaged across all OM reference set scenarios (an ensemble approach to integrate across OM uncertainties) but that performance metrics from individual OM robustness set scenarios should be presented separately. 
Presenting robustness results separately allows managers to see how MPs that performed well in the reference set perform under a set of more diverse assumptions [@rademeyer2007].

For Inside Yelloweye Rockfish, we established four reference set OMs: (1) a baseline OM; (2) an OM reflecting an alternative assumption about the magnitude of historical catch during the period 1986--2005; (3) an OM allowing for episodic (rare but large) future recruitment events; and (4) an OM estimating selectivity in the HBLL survey (Table \@ref(tab:ye-scen)).

We further established two robustness set OMs encompassing additional sources of uncertainty: (A) an OM that assumes lower natural mortality than the other OMs; and (B) an OM that assumes a higher coefficient of variation (CV) in the future HBLL survey (Table \@ref(tab:ye-scen)).

```{r ye-scen, results='asis'}
sc <- readRDS(here("mse/om/ye-scenarios2.rds"))
sc <- sc %>%
  select(-order) %>%
  mutate(scenario_human = gsub("\\\n", " ", scenario_human))
  sc %>% select(-scenario) %>%
  csasdown::csas_table(caption = "Inside Yelloweye Rockfish OM scenarios.",
    col_names = c("OM Scenario name", "Set type")) %>%
  kableExtra::kable_styling(latex_options = c("hold_position"))
```

### Reference set {#sec:approach3-reference}

The following OMs were developed as the reference set. We hereafter refer to them by their numbers, e.g., OM Scenario (1), or letters, e.g., OM Scenario (A).

#### (1) Base {#sec:approach3-reference1}

Data sources are provided in Appendices \@ref(app:biological-data) through \@ref(app:catch-data).
Parameter settings for the Base OM are provided in Appendix \@ref(app:desc-om-yelloweye).
We here provide a brief description of the Base OM assumptions that were adjusted in other OM scenarios.

There are two main uncertainties associated with the historical commercial catch time series for Inside Yelloweye Rockfish (details in Appendix \@ref(app:catch-data), Section \@ref(sec:com-catch-data)).
These are: (1) aggregated reporting of rockfish as Other Rockfish (ORF; rockfish species other than Pacific Ocean Perch) and (2) the magnitude of unreported catch that was discarded at sea prior to the introduction of 100% at-sea monitoring in the groundfish longline fleet in 2006 [@stanley2009].
For consistency with @yamanaka2011, we doubled the nominal catch data for the period 1986---2005, as industry did not have confidence in the catch data for those years [@dfo2012; see  Appendix \@ref(app:catch-data), Section \@ref(sec:com-catch-data)].

Projected recruitment deviations were sampled in log space with standard deviation $\tau = 0.4$, with autocorrelation estimated post-hoc from the historical recruitment deviates in the SRA model [Appendix A of @anderson2020gfmp].

The Inside Yelloweye Rockfish stock is indexed by two fishery-independent surveys: the inside Hard Bottom Longline Survey (Appendix \@ref(app:index-data), Section \@ref(sec:hbll-index-data)) and the Dogfish Survey (Appendix \@ref(app:index-data), Section \@ref(sec:dogfish-index-data)).
The SRA model exhibited better retrospective behaviour when the SRA model was fit with more likelihood weight applied to the Dogfish Survey. The age of full selectivity in the HBLL survey was fixed at 22 years (see Section \@ref(sec:approach3-conditioning) below).

Historical commerical CPUE was also available and used as an index of abundance for conditioning the OM [@yamanaka2011]. Following the decisions made for the 2011 assessment, the time series was divided into three stanzas (1986-1990, 1995-2001, and 2003-2005), representing periods when fishery behaviour is likely to have changed in response to management regulations (Appendix \@ref(app:catch-data), Section \@ref(sec:management-changes)). 

Natural mortality (*M*) was sampled  from a probability distribution based on that used by @yamanaka2011, where $M \sim \textrm{Lognormal}(0.045, 0.2)$ (Appendix \@ref(app:desc-om-yelloweye), Section \@ref(app:desc-stock-m-yelloweye)).

During the projection period, only the HBLL index was assumed to be available for the MPs, as this survey is conducted annually. Projecting only one index of abundance is consistent with many data-limited MPs, which only use a single index of abundance (see Appendix \@ref(app:mps)).
Observation error in the projected index values was simulated with random deviates from a lognormal distribution with mean of 1 and standard deviation of 0.25 based on the estimated observation error in the HBLL index.

All other OM scenarios were adjusted from this baseline OM and differed only in terms of adjustments to key parameters or data sources, described below.

#### (2) Low catch {#sec:approach3-reference2}

In the "Low catch" OM scenario, we test model sensitivity to the assumption of large unreported catch for the period 1986--2005.
Instead of doubling nominal catch data for this period, the SRA was fit to the nominal catch data.
As for the other OM scenarios, we used the reconstructed catch up to 1985 and the nominal catch from 1986 onwards.

#### (3) Episodic recruitment {#sec:approach3-reference3}

Long-lived, late-maturing species such as Pacific rockfishes often exhibit episodic, or periodic, recruitment strategies characterized by high fecundity and occasional very large recruitment events [@winemiller1992; @rose2001; @winemiller2005].
This life history strategy is sometimes called the storage effect (@warner1985) because strong recruitment events are stored in the adult population and are capable of contributing to reproduction, sometimes significantly, when favourable conditions return. 
Longevity in rockfish is thought to have evolved as a strategy for weathering un-favourable conditions.
Very large or even extreme year classes have been observed for several BC rockfish species [e.g., Pacific Ocean Perch: @haigh2019; Bocaccio: @haigh2020].


To address the possibility that future recruitment during the projection period could be characterized by occasional very large recruitment events, we included an "Episodic recruitment" OM scenario.
This OM scenario addresses the concern that very large cohorts are not adequately modelled by the lognormal distribution for recruitment deviations that was used in OM Scenario (1).
In the Episodic recruitment OM scenario, recruitment deviations $\varepsilon_{R,y}$ for each year of the projection period are generated as:

$$
\varepsilon_{R,y} = 
\left\{
\begin{array}{ll}
\varepsilon^{(1)}_{R,y} & \eta_y = 0\\
\varepsilon^{(3)}_{R,y} & \eta_y = 1,
\end{array}
\right.
$$

where $\varepsilon^{(1)}_{R,y}$ is the recruitment deviation from OM Scenario (1) and
$\log\varepsilon^{(3)}_{R,y} \sim \textrm{Normal}(-0.5\tau^2, \tau)$ represents the "episodic" recruitment distribution with $\tau = 2$ (standard deviation).
The paramater $\eta_y$ is a Bernoulli random variable $\eta_y \sim \textrm{Bernoulli}(p = 1/38)$, which selects whether an extreme recruitment event will occur. 
We assume that an extreme recruitment event is expected to occur once every generation (38 years), based on the observation that strong recruitment events in Inside Yelloweye Rockfish were present in 1948 and 1970. 
Although recent environmental conditions may be favourable for some species of rockfishes [@haigh2020; @lincandeo2020], we don't yet have any evidence of recent strong recruitment events for Inside Yelloweye Rockfish that might indicate more frequent episodic or spasmodic recruitment events. 

#### (4) Estimate HBLL selectivity {#sec:approach3-reference4}

Annual sample sizes of age-composition data from research surveys are very small (Appendix \@ref(app:biological-data)). 
This makes estimation of selectivity in the surveys highly uncertain, which led to the choice to fix survey selectivity in the other OM scenarios.

Given large uncertainty in our choice of selectivity, we allowed the SRA to estimate selectivity for the surveys in this OM scenario and utilized the available survey age-composition data.

### Robustness set {#sec:approach3-robustness}

#### (A) Low M {#sec:approach3-referenceA}

Lower values of natural mortality have been used for Inside Yelloweye Rockfish [@yamanaka2001; @cosewic2008; @wood2019]. This OM scenario used a lower mean in the distribution for *M*, with $M \sim \textrm{Lognormal}(0.025, 0.2)$, reflecting the possibility that the stock could be less productive than assumed in the other OM scenarios. 

#### (B) Higher HBLL CV {#sec:approach3-referenceB}

```{r higher-cv}
SRA_highCV <- readRDS(here::here("mse/om/updog_fixsel.rds"))
Iobs <- SRA_highCV@OM@cpars$Data@AddInd[1, , ] %>% t()
Ipred <- lapply(SRA_highCV@Misc, getElement, "Ipred")
Isd <- rbind %>% do.call(lapply(Ipred, function(x, y) apply(log(y/x), 2, function(xx) sd(xx, na.rm = TRUE)), y = Iobs))
mean_Isd <- mean(Isd[,1])
range_Isd <- range(Isd[,1])
```

This OM scenario considers the possibility that the future HBLL index might be less precise than assumed in the other OM scenarios.
Instead of an observation standard deviation $\sigma_I = 0.25$, we use the standard deviation ($\sigma_I$) and autocorrelation ($\theta_\textrm{AC}$) from the index residuals in OM Scenario (1), obtained from the SRA fit to the HBLL index.

This $\sigma_I$ has a mean of `r round2(mean_Isd)` and a range of `r round2(range_Isd[1])`--`r round2(range_Isd[2])`.

## CONDITIONING THE OPERATING MODELS {#sec:approach3-conditioning} 

After specifying the OM parameters (Appendix \@ref(app:desc-om-yelloweye)), we conditioned the OMs using the SRA model described in Appendix B of @anderson2020gfmp.

Note that the DLMtool OM combines all fleets into a single fleet.
However, if the OM is conditioned using the SRA model, the SRA can accommodate multiple fleets, and selectivity is fleet-specific.
In this case, fishery selectivity in the OM for the projection period is replaced with the SRA-conditioned estimates of fishing mortality-at-age in the final year  of the historical period ($t_c$), normalized by dividing by apical fishing mortality in that year.
This essentially provides the DLMtool OM with relative selectivity-at-age, weighted by catch across all fleets.
The closed-loop simulation projections therefore assume that the relative selectivity across fleets remains constant in the projection period.

Similarly, if the OM is conditioned using the SRA model, analysts can also specify (or estimate) selectivity parameters for the individual indices of abundance (in this case two fishery-independent surveys and three commercial CPUE series (Figure \@ref(fig:survey-fits))).
In this case, the SRA passes all of the indices back to DLMtool, preserving the estimated or user-defined selectivities-at-age for each index.
However, note that the DLMtool MPs only utilize a single index of abundance (see Appendix \@ref(app:mps)).
In the current study, all index-based MPs utilize the inside HBLL survey.

We used the SRA to populate the following parameters in the conditioned OMs:

- $B_{t_c}/B_0$ (or "D"; depletion in the last historical year $t_c$)
- $R_0$ (unfished recruitment)
- $\theta_\textrm{AC}$ (or "AC"; first-order autocorrelation of recruitment deviations)
- $\varepsilon_{\textrm{R},y}$ for years $t_1$ to $t_c$ (annual recruitment deviations)
- $F_{a,y}$ (fishing mortality at age by year)

See Appendix B of @anderson2020gfmp for details on these parameters.

The SRA was run for 250 replicates.
Each replicate used a different value of *M* and *h* (sampled independently from the distributions shown in Appendix \@ref(app:desc-om-yelloweye), except for OM Scenario (A), which used a different distribution for *M*).
The model was initialized under the assumption that spawning biomass ($B_y$) was in an unfished equilibrium state prior to 1918, the first year of the time series, i.e., $B_{1918} = B_0$.
While this is unlikely to be true, as First Nations and others would have been catching Yelloweye Rockfish prior to 1918, these numbers are expected to be small enough not to impact the outcomes of the performance of MPs in the projection period.

### Selection of base OM {#sec:approach3-conditioning-base-om}

Initial attempts to fit the SRA model did not produce good fits to the dogfish survey.
Furthermore, retrospective analysis showed persistent retrospective bias in annual estimates of spawning biomass when sequentially removing 11 years of data (when evaluated at the mean values of *M* and *h*, Figure \@ref(fig:retro-initial), top panel).
The choice to base retrospective analysis on 11 years of data was primarily to evaluate sensitivity of the model to removal of each year of data, going back to 2009, the terminal year for the 2011 assessment.

Increasing the likelihood weight for the SRA fit to the Dogfish survey [$\lambda^I_s = 4$; Equation B.22 in @anderson2020gfmp], and fixing age-at-full-selectivity in the HBLL survey to 22 years, removed the retrospective pattern (Figure \@ref(fig:retro-initial), bottom panel). 
Therefore, for OM Scenario (1) and all other OM scenarios except Scenario (4), we fixed the age-at-full selectivity of the HBLL Survey at 22 years (Figure \@ref(fig:HBLL-selectivity)), while also upweighting the Dogfish survey.

(ref:fig-retro-initial) Retrospective patterns in spawning biomass for the initial fit and OM Scenario (1). Coloured lines represent estimates of spawning biomass with $X$ years of data removed, where $X$ is shown in the legend for each series.

```{r retro-initial, fig.cap="(ref:fig-retro-initial)", out.width="4.25in"}
knitr::include_graphics(here::here("mse/figures/retrospective-spawning-biomass.png"))
```

There are a number of factors that increase uncertainty in estimating selectivity for the Dogfish survey e.g. the absence of biological data from this survey, and changes in fishing operations and hook type that occurred in 2004 (Appendix \@ref(app:index-data), Section \@ref(sec:dogfish-index-data)). There are also several differences between the HBLL and Dogfish longline surveys (Appendix \@ref(app:index-data), Section \@ref(sec:dogfish-index-data)), but, for the reasons mentioned, we cannot reliably estimate the selectivity for the Dogfish survey. Out of necessity, selectivity in the Dogfish survey was set to mirror selectivity in the HBLL survey, whether it was estimated (OM Scenario (4)) or fixed (all other OM scenarios).

Age composition data from the commerical fishery were available from a single fishing trip in 1989, and length samples from 2002--2019 were identified from the recreational fishery. Attempts to fit the SRA model to these data did not produce satisfactory estimates of selectivity. The estimated values of the age of full selectivity were very high, suggesting that most ages were not completely vulnerable to the fishery, and significantly differed from values estimated for the Outside Yelloweye population [@cox2020]. Since it is unlikely that selectivity varies to such an extent between geographical regions, these data were not further considered. 

As a result, selectivity for these gears was fixed in all OM scenarios (Figure \@ref(fig:sra-selectivity)).
Parameter values were set so that the selectivity-at-age curves approximated those estimated by @cox2020 for the commercial longline and recreational fisheries for outside Yelloweye Rockfish (see Appendix \@ref(app:desc-om-yelloweye), Section \@ref(app:desc-fleet-selectivity-yelloweye)).
As noted above, these selectivities were returned to the DLMtool OMs as a combined-fleet selectivity curve from the terminal year ($t_c$) of the historical period (Figure \@ref(fig:om-selectivity)).

### OM conditioning results {#sec:approach3-conditioning-results} 

#### Fits to data {#sec:approach3-conditioning-indices}

The predicted catch in the SRA models matched the catch data by design, which was achieved by setting the standard deviation of the observation error to a value of 0.01 [@anderson2020gfmp, their Equation B.27].

The SRA was able to fit to the indices of abundance reasonably well (Figure \@ref(fig:survey-fits)) and convergence was achieved for all replicates in all OM scenarios.
For all OM scenarios, the estimated index fell within the observed confidence intervals in most years, although there were some outliers (Figure \@ref(fig:survey-fits)).
The fit to the early 1986  and 1989 observations in the Dogfish Survey was slightly better in OM Scenario (A), which is consistent with a less productive, more depleted stock. However, these two observations are more uncertain than those in recent years, due to changes in fishing operations and hook type that occurred in 2004 (Appendix \@ref(app:index-data), Section \@ref(sec:dogfish-index-data)).
Fits to the commercial CPUE series were generally good, due to the short time stanzas for each series (Figure \@ref(fig:survey-fits)).

(ref:fig-survey-fits)
SRA model fits to the HBLL, Dogfish, and three commercial CPUE relative indices.
Panels from left to right represent OM scenarios.
Thin lines represent individual SRA model fits across stochastic draws from the various OM parameters.
Dots represent index mean and line segments represent 2 times the standard errors as entered into the SRA models.

```{r survey-fits, fig.cap="(ref:fig-survey-fits)", out.width="\\textwidth"}
knitr::include_graphics(here("mse/figures/ye-index-fits.png"))
```

The SRA model fit the survey age-composition data reasonably well, despite very small sample sizes (Figures \@ref(fig:sra-conditioned-comp-fit1) to \@ref(fig:sra-conditioned-comp-fitB)). We note that in comparing OM Scenarios (1) and (4) it appears that fixing or estimating selectivity in the HBLL survey did not generate very different fits to the age composition data (Figures \@ref(fig:sra-conditioned-comp-fit1) and \@ref(fig:sra-conditioned-comp-fit4)).

For most years, the SRA predicted larger abundance in the plus group (80+ *y*) than what was observed. 
A lack of fish older than 80 *y* in the survey suggested that total mortality could have been greater in the past than estimated in our OMs.
This could be represented in the OMs in two ways.
First, *M* could be increased in the models. 
However, our preliminary model investigations indicated that increasing *M* also increases retrospective bias.
Secondly, the catch history could be changed to predict higher values of fishing mortality.
This was done in OM Scenario (2) by assuming lower catches in 1986-2005, which resulted in a slightly smaller stock (Figure \@ref(fig:biomass-om)) and higher fishing mortality (Figure \@ref(fig:F-om)).
However, the estimated plus group was only slightly reduced in most years for this OM scenario (Figure \@ref(fig:sra-conditioned-comp-fit2)).

This issue is a challenge for very long-lived species with poor age-composition sampling.
With such small sample sizes, there is a relatively small chance of observing very old fish.
Large structural uncertainties in the model and available data (e.g., the Dogfish survey, catch data) made it difficult to resolve one issue, e.g., persistent overprediction of old fish, without generating another issue, e.g., retrospective bias.


\clearpage

(ref:fig-sra-comp-fit1)
SRA model fits to the survey age composition data for OM Scenario (1), showing observed (points) and estimated (green lines) proportions. Sample sizes (N) are number of sets from which age samples were collected in each year.

```{r sra-conditioned-comp-fit1, out.width="0.85\\textwidth", fig.cap="(ref:fig-sra-comp-fit1)"}
knitr::include_graphics(here("mse/figures/conditioning/HBLL_age_comp_updog_fixsel.png"))
```

\clearpage

(ref:fig-sra-comp-fit2)
Same as Figure \@ref(fig:sra-conditioned-comp-fit1) for OM Scenario (2).

```{r sra-conditioned-comp-fit2, out.width="0.85\\textwidth", fig.cap="(ref:fig-sra-comp-fit2)"}
knitr::include_graphics(here("mse/figures/conditioning/HBLL_age_comp_lowcatch_fixsel.png"))
```

\clearpage

(ref:fig-sra-comp-fit3)
Same as Figure \@ref(fig:sra-conditioned-comp-fit1) for OM Scenario (3).

```{r sra-conditioned-comp-fit3, out.width="0.85\\textwidth", fig.cap="(ref:fig-sra-comp-fit3)"}
knitr::include_graphics(here("mse/figures/conditioning/HBLL_age_comp_episodic_recruitment.png"))
```

\clearpage

(ref:fig-sra-comp-fit4)
Same as Figure \@ref(fig:sra-conditioned-comp-fit1) for OM Scenario (4).

```{r sra-conditioned-comp-fit4, out.width="0.85\\textwidth", fig.cap="(ref:fig-sra-comp-fit4)"}
knitr::include_graphics(here("mse/figures/conditioning/HBLL_age_comp_upweight_dogfish.png"))
```


\clearpage

(ref:fig-sra-comp-fitA)
Same as Figure \@ref(fig:sra-conditioned-comp-fit1) for OM Scenario (A).

```{r sra-conditioned-comp-fitA, out.width="0.85\\textwidth", fig.cap="(ref:fig-sra-comp-fitA)"}
knitr::include_graphics(here("mse/figures/conditioning/HBLL_age_comp_lowM_fixsel.png"))
```

\clearpage

(ref:fig-sra-comp-fitB)
Same as Figure \@ref(fig:sra-conditioned-comp-fit1) for OM Scenario (B).

```{r sra-conditioned-comp-fitB, out.width="0.85\\textwidth", fig.cap="(ref:fig-sra-comp-fitB)"}
knitr::include_graphics(here("mse/figures/conditioning/HBLL_age_comp_high_index_cv.png"))
```

#### Parameter estimates {#sec:approach3-conditioning-parameters}

The OM reference and robustness scenarios rendered a range of estimated parameter values (Figure \@ref(fig:sra-conditioned-parameters)).

(ref:fig-sra-conditioned-parameters) Histograms of parameters estimated by the SRA. AC refers to $\theta_\textrm{AC}$. D refers to depletion ($B_{t_c}/B_0$).
For visualization purposes, the *R*~0~ axis limits have been restricted to a maximum of 490 and the AC axis limits to a minimum of 0.76.
This excludes a small number of replicates.

```{r sra-conditioned-parameters, out.width="0.85\\textwidth", fig.cap="(ref:fig-sra-conditioned-parameters)"}
knitr::include_graphics(here("mse/figures/ye-sra-estimated.png"))
```

Estimated means and coefficients of variation (CV) for reference points *F*~MSY~, *B*~MSY~ and MSY are provided in Table \@ref(tab:sra-ref-pts).
The CVs are large due to the large range of sampled values for *M* and *h* (Appendix \@ref(app:desc-om-yelloweye), Sections \@ref(app:desc-stock-m-yelloweye) and \@ref(app:desc-stock-h-yelloweye)).

```{r sra-ref-pts, results='asis'}
ref_pts <- readr::read_csv(here::here("mse/figures/ref_pt.csv"))
ref_pts %>%
  mutate(X1 = gsub("\\\n", " ", X1)) %>%
  select(X1, FMSY, BMSY, MSY) %>%
  rename("F~MSY~ (/y)" = FMSY, "B~MSY~ (t)" = BMSY, "MSY (t)" = MSY) %>% 
  rename("OM Scenario" = X1) %>% 
  csasdown::csas_table(caption = "Estimated reference points for each OM Scenario. Standard deviations across replicates are shown in parentheses.") %>% 
  kableExtra::column_spec(1:5, width = "5cm") 
```

\clearpage

#### Historical trajectories {#sec:approach3-conditioning-trajectories}

In all OM scenarios, except OM Scenario (A), the median spawning biomass in 2019 is estimated to be above the LRP (Figure \@ref(fig:biomass-om)). 
OM Scenario (A) estimated median spawning biomass to have been below the LRP for most years after 2000 and less than 50% probability of being above the LRP in 2019 (Figure \@ref(fig:ref-pt)).
OM Scenario (2) and OM Scenario (4) also had a small probability of being below the LRP in the current year.
Therefore, according to all the reference set OM scenarios and one robustness set OM scenario, the stock can already be considered to have rebuilt above the LRP. 
The median spawning biomass is estimated to be above the USR in OM Scenarios (1), (2), (3), and (B); and estimated to be below the USR in OM Scenarios (4) and (A).

All OM scenarios predicted a slight increase in spawning biomass during the last decade of the time series (Figure \@ref(fig:biomass-om)).
The credible interval for all OM scenarios except (A) was very broad, arising from uncertainties in natural mortality and steepness (Figure \@ref(fig:sra-conditioned-parameters)).
Note that trajectories are identical for OM Scenarios (1), (3) and (B), as OM Scenarios (3) and (B) only differ from OM Scenario (1) in the treatment of parameters in the projection period.
The very narrow credible interval for OM Scenario (A) reflects the very low fixed value of *M* in this OM scenario, restricting the range of possible outcomes.

The implied spawning biomass depletion trajectories during the historical period from the eight OMs follow the same pattern as those for *B* (Figure \@ref(fig:depletion-om)).

Estimates of historical recruitment deviations were similar across OM scenarios (Figure \@ref(fig:recdev-om)).

Estimated historical apical fishing mortality varied across OM scenarios, with larger values estimated for OM Scenarios (4) and (A), the more depleted trajectories (Figure \@ref(fig:F-om)).
All OM scenarios predicted large peaks in fishing mortality during the 1980s and 1990s (Figure \@ref(fig:F-om)).

(ref:fig-biomass-om)
Spawning biomass relative to spawning biomass at MSY (*B*/*B*~MSY~) trajectories for reference and robustness set OMs.
Lines represent medians, and dark and light grey shading represent 50% and 95% quantiles across replicates, respectively.
Dotted horizontal lines represent the USR (0.8 *B*~MSY~) and LRP (0.4 *B*~MSY~).

```{r biomass-om, fig.cap="(ref:fig-biomass-om)", out.width="\\textwidth"}
knitr::include_graphics(here("mse/figures/ye-compare-SRA-MSY-panel.png"))
```

(ref:fig-ref-pt)
Probability that the 2019 spawning biomass is above the LRP and USR for the six operating models.

```{r ref-pt, fig.cap="(ref:fig-ref-pt)", out.width="2.5in"}
knitr::include_graphics(here("mse/figures/historical_indicators_ref_pt.png"))
```

(ref:fig-depletion-om)
Spawning biomass depletion trajectories for reference and robustness set OMs.
Depletion is represented as a fraction of $B_0$ (spawning biomass at unfished equilibrium).
Lines represent individual replicates.

```{r depletion-om, fig.cap="(ref:fig-depletion-om)", out.width="\\textwidth"}
knitr::include_graphics(here("mse/figures/ye-compare-SRA-depletion-panel.png"))
```


(ref:fig-recdev-om)
Historical recruitment deviations estimated by the SRA model (in log space).
Lines represent individual replicates.

```{r recdev-om, fig.cap="(ref:fig-recdev-om)", out.width="\\textwidth"}
knitr::include_graphics(here::here("mse/figures/ye-compare-SRA-recdev-panel.png"))
```

(ref:fig-F-om)
Apical fishing mortality ($F_y$) trajectories for reference and robustness set OMs.
Apical fishing mortality is the maximum $F_y$ experienced by fish of any age in a given year.
Lines represent individual replicates.

```{r F-om, fig.cap="(ref:fig-F-om)", out.width="\\textwidth"}
knitr::include_graphics(here::here("mse/figures/ye-compare-SRA-F-panel.png"))
```

\clearpage

## SURPLUS PRODUCTION MODEL OM SCENARIO

The 2011 stock assessment for Inside Yelloweye Rockfish applied a Bayesian state space surplus production (SP) model, fit to catch, commercial CPUE, and the HBLL and Dogfish surveys [@yamanaka2011]. 
The assessment estimated a 90% [nine times out of 10] probability that the stock was below the LRP, i.e., in the critical zone. 
The assessment results triggered a rebuilding plan [@ifmp2018], which is updated in this document.
The SRA models under all OM scenarios in the current analysis predict similar biomass trajectories to that in @yamanaka2011.
However, only OM Scenario (A) estimates the stock to have been below the LRP during the 2000s (Figure \@ref(fig:biomass-om)).

Model results diverged between the two analyses due to large differences in model structure between the SP model used in @yamanaka2011 and the SRA used here. To explore the effects of model structure on stock status, we fit a SP model to the currently-available catch, CPUE and fishery-independent indices of abundance. 
We used the SP model implemented in the R software package MSEtool [@huynh_msetool_2019], fully described in Appendix D of @anderson2020gfmp,
which was configured to resemble the 2011 assessment as much as possible, although the model used here estimated parameters using maximum likelihood.
The SP model set *B*~MSY~ to 50% of unfished biomass, set the initial biomass in 1918 to 90% of unfished biomass, and used a prior probability distribution for the intrinsic rate of population growth (*r*) as a likelihood penalty.
The prior probability distribution for *r* was normally distributed with a mean of 0.068 and standard deviation of 0.03, based on values used in @yamanaka2011.

SP model results more closely matched those of the previous assessment, estimating the stock to be below the LRP (Figure \@ref(fig:spm-biomass)).
The model estimated the reference points *B*~MSY~ = 1844 t, *F*~MSY~ = 0.03 *y*^-1^, and MSY = 62 t.
MSY and *F*~MSY~ estimates were similar to those from the SRA Base OM (Table \@ref(tab:sra-ref-pts)), but the estimate of *B*~MSY~ was approximately 35% higher for the SP model than the SRA. We note that very similar findings were made by @cox2020 in the rebuilding plan for the outside stock of Yelloweye Rockfish.
Their analysis, also based on age-structured models, predicted the current stock status for Outside Yelloweye Rockfish to be above the LRP, i.e., not in need of rebuilding, in contrast to results obtained by the SP model used in the 2014 stock assessment [@yamanaka2018yelloweyeoutside]. 

Notably, the biomass trends for the inside population since 2000 also differs between the two types of models. A flat, stable trend (below the LRP) was estimated in the SP model. On the other hand, many of the OMs developed from the SRA indicated that stock size has been increasing, although the trend is much flatter in the Low M scenario. We attempted four alternative model fits in an attempt to find scenarios that would mirror the biomass trend estimated in the SP model (Figure \@ref(fig:alt-SRA-fit)).  

First, the dogfish survey was further downweighted with a likelihood weighting factor $\lambda = 0.1$. This did not change the spawning biomass trend and the resulting stock status was more optimistic compared to the Base OM. Second, the 2019 dogfish survey value was excluded from the likelihood since the observed mean is higher than in previous recent years (with $\lambda = 4$ following the Base OM). This scenario also did not appreciably affect the spawning biomass trend and magnitude. Third, the survey age comps was downweighted with $\lambda = 0.1$. Similar to the first alternative, the spawning biomass trend was similar to the Base OM although the resultant stock status was somewhat less optimistic. Finally, the survey age comps were removed from the likelihood with $\lambda = 0$. This scenario estimated the stock to be below the LRP in concordance with the SP model. 

These results suggest that differences in estimated stock status between the current analysis and the previous stock assessment [@yamanaka2011] are in large part due to the data types included in the respective models and model structure. Both use catch and indices of abundance although the SP model leaves out the age compositions. When the two models use the same data types, i.e., excluding the age compositions from the likelihood with fixed assumptions regarding survey selectivity, both behave more similarly.

The age-structured model was chosen over the SP model to develop operating models for inside yelloweye rockfish on first principles. The age-structured model is more realistic in modeling delays in stock productivity over time. A single cohort contributes to the spawning biomass (and vulnerable biomass) over several years as it progresses through the age structure of the population. This mechanism can explain the increasing biomass estimated in the SRA. As fishing mortality decreased from catch reductions in the late 1990s into 2000, the spawning biomass started to increase. Also, the age of 5% maturity is lower than the age of 5% selectivity of the commercial fleet which would allow portions of cohorts to spawn before significant vulnerability to fishing.

For the SP model, this delay may be implicitly incorporated in the production function of the SP model but the biomass predicted in a given year is explicitly a function of the biomass observed in the previous year. Furthermore, the stock biomass in the SP model is implicitly vulnerable biomass since there are no explicit assumptions about selectivity. There is more difficulty in explaining the productivity of the stock mechanistically as all biological processes regarding growth, natural mortality, and maturity is incorporated in the intrinsic rate parameter *r*.

(ref:fig-spm-biomass) Biomass relative to biomass at MSY (*B*/*B*~MSY~) trajectory from the SP model.
Dotted horizontal lines represent the USR (0.8 *B*~MSY~) and LRP (0.4 *B*~MSY~).

```{r spm-biomass, fig.cap="(ref:fig-spm-biomass)", out.width="0.8\\textwidth"}
knitr::include_graphics(here::here("mse/figures/SP_fit.png"))
```


(ref:fig-alt-SRA-fit) Relative spawning biomass (*B*/*B*~MSY~) from alternative fits to the SRA that downweighted or eliminated data from the likelihood. Mean values of natural mortality and steepness were used. Dotted horizontal lines represent the USR (0.8 *B*~MSY~) and LRP (0.4 *B*~MSY~). The Base and Exclude 2019 dogfish scenarios overlap and the corresponding lines are jittered in the figure for clarity.

```{r alt-SRA-fit, fig.cap="(ref:fig-alt-SRA-fit)"}
knitr::include_graphics(here::here("mse/figures/alt_SRA_fit.png"))
```


\clearpage

<!--chapter:end:03-om.Rmd-->


# IDENTIFICATION OF CANDIDATE MANAGEMENT PROCEDURES  {#sec:mp}

@anderson2020gfmp screened all MPs that were available in DLMtool as of November 2019.
DLMtool includes a comprehensive set of data-limited MPs that make different types of management recommendations, including adjustments to TAC, effort, or spatial allocation of catch or effort.
@anderson2020gfmp excluded certain MPs from the MP Framework that had requirements that would rarely be met for BC groundfish stocks.
Excluded MPs were those that required: knowledge of absolute abundance; recent age-composition data; knowledge of depletion; and knowledge of steepness (*h*) of the stock-recruit relationship, since these are likely to be major axes of uncertainty for the stocks to which this framework will be applied.
While it is necessary to explore these axes of uncertainty within OMs, implementing MPs that require knowledge of these factors would require many additional assumptions.
@anderson2020gfmp also adjusted some of the DLMtool MPs to accommodate the types of data available for BC groundfish (e.g., biennial surveys in several management areas).

The MP Framework only considers MPs that make TAC recommendations, because most groundfish stocks are managed by quotas and TACs.
A library of all MPs considered in the MP Framework is provided in @anderson2020gfmp (their Appendix D).
MPs that were considered for the current rebuilding plan are detailed in Appendix \@ref(app:mps) of this document.

We evaluated two main types of MPs: empirical (data-based) and model-based MPs.
We also evaluated three reference MPs.

The full set of candidate MPs is provided in Table \@ref(tab:mps). See Appendix \@ref(app:mps) for full descriptions.

## EMPIRICAL MPs

Empirical MPs make use of catch and population index data.
These MPs can be divided into two main categories: constant-catch MPs and index-based MPs.

### Constant-catch MPs

Constant-catch MPs set the recommended catch to some fixed level, typically based on recent or historical catches.
Constant-catch MPs do not incorporate feedback between the management system and the population---they make the same catch recommendation regardless of trends in the population index.
The current MP being used for Inside Yelloweye Rockfish is a constant-catch MP of 15 t.

We considered three constant-catch MPs: 5 t, 10 t, and 15 t (Appendix \@ref(app:mps), Section \@ref(sec:mp-cc)).

### Index-based MPs 

Index-based MPs, in general, adjust the TAC based on changes in a population index over time.
Index-ratio MPs increase or decrease the TAC in accordance with the ratio of the index from two different time periods.
Index-slope MPs increase or decrease the TAC in accordance with the estimated slope in the index over a recent period of time. 
A third type, index-target MPs, adjusts the TAC based on the ratio of the recent index and a fixed target index value, based on some pre-agreed historical period.
We did not consider an index-target MP here, as further guidance would be needed in order to select the appropriate target value.
Also, for rebuilding plans, the main objective is to rebuild the stock above the LRP.
However, the LRP is not likely to be a desired final target stock status.

We evaluated index-based MPs with either annual updates or five-year updates (denoted "5u") with fixed TAC between updates, i.e., the last recommended TAC. 
All index-based MPs set a minimum TAC "floor" = 0.5 t, which is approximately the amount of catch required for scientific surveys to continue.
We included the following index-based MPs: Iratio, Islope, GB_slope and IDX, with a variety of configurations (Appendix \@ref(app:mps), Section \@ref(sec:mp-ibased)).

## MODEL-BASED MPs

In addition to the empirical MPs, we considered a surplus production (SP) model, paired with two alternative harvest control rules (HCRs).
We evaluated two assessment frequencies (five and 10 years), with a fixed TAC between assessments (Appendix \@ref(app:mps), Section \@ref(sec:mp-sp)).
We used the SP model coded in MSEtool [@huynh_msetool_2019] and based on @fletcher1978 [see Appendix D of @anderson2020gfmp].

The alternative HCRs (Figure \@ref(fig:mp-hcrs)) were characterized by:

1. 80% B~MSY~ and 40% B~MSY~ as the USR and LRP, respectively; and
2. 40% B~0~ and 10% B~0~ as the USR and LRP, respectively.

## REFERENCE MPs

In addition to the empirical and model-based candidate MPs, we included the following reference MPs:

1. No fishing (NFref)
2. Fishing at *F*/*F*~MSY~ (FMSYref)
3. Fishing at 0.75 *F*/*F*~MSY~ (FMSYref75)

The purpose of reference MPs is not to explore viable management strategies but to bound the range of expected or possible performance and contextualize whether differences between performance statistics among MPs are meaningful [@punt2016].
For example, the "no fishing" reference MP provides information on maximum possible stock levels and the maximum possible rate of rebuilding under a rebuilding scenario.

\clearpage

```{r mps, results='asis'}
mp <- readr::read_csv(here("mse",  "mp.txt"), comment = "#")
csasdown::csas_table(mp, caption = "Candidate MPs. \"5u\" and \"10u\" refer to every-five- and every-10-year update intervals; the other MPs were applied annually. Other numbers refer to MP configurations.", col_names = c("Management procedure", "MP type"))
```

\clearpage

<!--chapter:end:04-mp.Rmd-->

# SIMULATION OF THE APPLICATION OF MANAGEMENT PROCEDURES {#sec:simulation}

```{r rversion}
rversion <- gsub(" \\([0-9-]+\\)", "", devtools::session_info()$platform$version)
```

```{r mp-sat}
pm_df_list <- readRDS(here("mse/om/ye-pm-all.rds"))
pm_all <- bind_rows(pm_df_list, .id = "scenario")
pm_avg <- group_by(pm_all, MP) %>%
  summarise_if(is.numeric, mean, na.rm = TRUE)
pm_min <- group_by(pm_all, MP) %>%
  summarise_if(is.numeric, min, na.rm = TRUE)
reference_mp <- c("FMSYref75", "NFref", "FMSYref")

satisficed_criteria <- c("LRP 1.5GT" = 0.9, "ST C10" = 0.5)
mp_sat <- dplyr::filter(pm_min, `LRP 1.5GT` > satisficed_criteria[1], `ST C10` > satisficed_criteria[2]) %>%
  pull(MP)
mp_sat <- mp_sat[!mp_sat %in% reference_mp]

pm_avg_sat <- pm_avg %>% filter(MP %in% mp_sat)
pm_min_sat <- pm_min %>% filter(MP %in% mp_sat)
```

We ran the closed-loop simulations across 250 stochastic replicates using DLMtool version 5.4.2, `r rversion`, and the simulation random seed set to 1. The length of the projection period was set at 100 years to facilitate calculation of the extinction risk assessment criteria for COSEWIC (Appendix \@ref(app:cosewic)).
We assessed convergence of the closed-loop simulation by plotting the cumulative performance metrics as replicates were added (Figure \@ref(fig:converge)).
We deemed 250 replicates sufficient, since the rank order of MPs remained consistent as additional replicates were added (Figure \@ref(fig:converge)).

@anderson2020gfmp recommended filtering MPs with a "satisficing" step, where trial simulations are run to screen out MPs that do not meet a basic set of performance criteria [@miller2010; see @anderson2020gfmp].
We initially set the following criteria to determine which MPs are satisficed: LRP 1.5GT > 0.9.
To determine which MPs would be carried forward as satisficed MPs, we began by assessing average and minimum performance across all candidate MPs for the reference set of OMs (Figures \@ref(fig:tigure-avg) and \@ref(fig:tigure-min)).
All MPs met the satisficing criterion (LRP 1.5GT > 0.9), both in individual OM reference set scenarios and averaged across all four reference OMs (Figures \@ref(fig:tigure-avg) and \@ref(fig:tigure-min)).
Since many MPs also generated low catches, we applied an additional satisficing filter, retaining only MPs where average ST C10 > 0.50.
This resulted in only constant-catch TACs of 10 t and 15 t and Islope MPs being satisficed (Figure \@ref(fig:tigure-avg)).
The `r gfutilities::number_to_word(length(mp_sat))` satisficed MPs were `r gfutilities::commify(sort(mp_sat))` (see Appendix \@ref(app:mps) for descriptions).

Within the reference set, average LRP 1.5GT was `r round2(max(pm_avg_sat$"LRP 1.5GT"))` for all MPs and ST C10 varied between `r round2(min(pm_avg_sat$"ST C10"))` and `r round2(max(pm_avg_sat$"ST C10"))` (Figure \@ref(fig:tigure-avg) and \@ref(fig:tigure-panel)).
Minimum LRP 1.5GT was `r round2(max(pm_min_sat$"LRP 1.5GT"))` for all MPs and ST C10 varied between `r round2(min(pm_min_sat$"ST C10"))` and `r round2(max(pm_min_sat$"ST C10"))` across MPs within the reference set (Figure \@ref(fig:tigure-min) and \@ref(fig:tigure-panel)).

We focus on evaluating trade-offs among satisficed MPs in Section \@ref(sec:results). 
However, in terms of MPs that did not meet the satisficing criteria (Figure \@ref(fig:proj-not-satisficed-eg)):

- Iratio generated low catches within the first decade but generated high catches later on. There was high variability among replicates in each OM.
- IDX and IDX_smooth returned gradually lower catches over time. See Appendix \@ref(app:mps) Section \@ref(sec:mp-idx) for details.
- Iratio and GB_slope generated zero catch in the low catch OM; hence, they did not satisfy the ST C10 > 0.50 criteria.
- The surplus production MPs generated no or very little catch in the first decade, but increased catches later on, e.g., after 50 years.

(ref:fig-converge)
Assessing convergence of the closed-loop simulations on consistent rank order of MPs within performance metrics.
Colours represent individual satisficed and reference MPs.
Lines that do not cross by the final replicates indicate that rank order among replicates has converged.
Although not shown, we also checked that the satisficing rules had converged (i.e., the selection of satisficed MPs did not change with additional replicates).
We only show LRP 1.5GT and ST C10 since these were the main two performance metrics used in the satisficing step.
The other performance metrics were also checked (not shown).

```{r converge, fig.cap="(ref:fig-converge)", out.width="\\textwidth"}
knitr::include_graphics(here("mse/figures/ye-convergence.png"))
```

(ref:fig-tigure-avg) Average performance of all candidate MPs across the OM reference set scenarios.
MPs are ordered by decreasing performance metric values from top to bottom starting with the left-most performance metric (LRP 1.5GT) and using columns from left to right to break any ties.
The colour shading reflects the probabilities.
Outlined cells represent MPs that met a particular performance metric's satisficing criteria.
Using this set of criteria, MPs would be "satisficed" if cells in *both* "`r names(satisficed_criteria)[1]`" and "`r names(satisficed_criteria)[2]`" were outlined.
Light grey MPs indicate reference MPs.

```{r tigure-avg, fig.cap="(ref:fig-tigure-avg)", out.width="3.5in"}
knitr::include_graphics(here("mse/figures/ye-tigure-refset-avg.png"))
```

(ref:fig-tigure-min) Minimum performance of all candidate MPs across the OM reference set scenarios.
This figure is the same as Figure \@ref(fig:tigure-avg) but shows the **minimum** performance metric across the OMs in the reference set for the purposes of applying satisficing rules.
In other words, this figure illustrates the worst performance of each MP across the OM reference set scenarios.

```{r tigure-min, fig.cap="(ref:fig-tigure-min)", out.width="3.5in"}
knitr::include_graphics(here("mse/figures/ye-tigure-refset-min.png"))
```

\clearpage

(ref:fig-proj-not-satisficed-eg) 
Examples of MPs that were not satisficed for OM Scenario (1). 
B/B~MSY~, F/F~MSY~, and catch are shown for both the historical and projected time periods.
Dark line indicates the median value and the darker and lighter shaded ribbons indicate the 50% and 90% quantiles.
Thin gray lines represent illustrative simulation replicates.
The vertical dashed line indicates the last year of the historical period ($t_c$).
The horizontal dashed lines indicate B/B~MSY~ = 0.8 and 0.4, and F/F~MSY~ = 1.

```{r proj-not-satisficed-eg, fig.cap="(ref:fig-proj-not-satisficed-eg)", out.width="0.8\\textwidth"}
knitr::include_graphics(here("mse/figures/ye-projections-not-sat2.png"))
```

\clearpage

<!--chapter:end:05-simulation.Rmd-->

# PRESENTATION OF TRADE-OFFS AMONG MANAGEMENT PROCEDURES {#sec:results}

## REFERENCE SET RESULTS

Performance within the OM reference set of scenarios varied across satisficed MPs (hereafter just "MPs") and performance metrics (Figures \@ref(fig:tigure-panel) and \@ref(fig:dot-lines)).
All MPs were able to achieve LRP 1.5GT > 0.99.
The fixed TACs of 10 t and 15 t, by definition, met their respective ST C10 and ST C15 performance metrics (Figures \@ref(fig:tigure-panel) and \@ref(fig:dot-lines)).
The Islope MPs showed some contrast across MPs within the reference set for ST C10 and ST C15.
The Islope MPs achieved between 0.59 and 0.88 for ST C10, depending on the OM and the Islope MP configuration (Figures \@ref(fig:tigure-panel)).

Within the reference set, there was virtually no trade-off between LRP 1.5GT and ST C10 since all MPs were able to achieve LRP 1.5 GT > 0.99 (Figure \@ref(fig:tradeoff-reference)).
Multidimensional trade-offs are sometimes represented using radar plots. However, these were challenging to interpret for this analysis (Figure \@ref(fig:spider-satisficed-mps-avg)), which exemplifies some of the warnings about radar plots offered in @anderson2020gfmp.
We include radar plots here to gauge reader interest at the Regional Peer Review meeting and to illustrate their potential pitfalls for the MP Framework.

<!--
A dot-and-line plot of the performance metrics aggregated across scenarios helps compare performance across MPs (Figure \@ref(fig:dot-lines)).
In general, variation performance metric values for any one MP across reference set OMs was small, with the slight exception of Islope_10_lambda08 for LT C20 (Figure \@ref(fig:dot-lines)).
-->

The timeseries trajectories of the projected survey index (Figure \@ref(fig:proj-index)), *B*/*B*~MSY~, *F*/*F*~MSY~, and catch (Figures \@ref(fig:proj-updog-fixsel)--\@ref(fig:proj-upweight-dogfish)) further demonstrate performance across the various MPs and reference set OMs.
We note that none of the biomass projections predicted the stock to be below the LRP in the first year of the projection period, and all MPs achieved continuous growth throughout the projection period, albeit at different rates (Figures \@ref(fig:proj-updog-fixsel)--\@ref(fig:proj-upweight-dogfish)).

Kobe plots demonstrate either the final *B*/*B*~MSY~ vs. *F*/*F*~MSY~ status among replicates (Figure \@ref(fig:kobe)) or the trajectory of these stock status values through time (Figure \@ref(fig:worm)).
Within the reference set and across all MPs, only OM Scenario (2) produced some replicates that had *F* > *F*~MSY~ and *B* < *B*~MSY~ (and *B* < LRP) by the final projection year (Figure \@ref(fig:kobe)).

We note that OM Scenario (3), Episodic recruitment, yielded near identical results to the Base OM Scenario (1) (e.g., Figure \@ref(fig:tigure-panel)).
The Episodic recruitment scenario modeled the likelihood of an extreme recruitment event to occur approximately once every generation (38 years) (Section \@ref(sec:approach3-reference3)).
Despite the Episodic recruitment scenario predicting some fairly extreme large recruitment events it also predicted extreme low recruitment events (Figure \@ref(fig:recdev-om-proj)) and it is likely that these effects counter-balanced one another, producing no contrast in final results.
It is also possible that long lag effects prevented single large recruitment events from affecting MP performance.
Future adaptations of this framework might explore alternative assumptions about the period and magnitude of extreme recruitment events for Inside Yelloweye Rockfish.
Exploration of alternative probability distributions for projected recruitment deviations (e.g., skewed or heavy-tailed distributions) could also be explored.

(ref:fig-tigure-panel) Performance of satisficed MPs for the OM reference set scenarios.
MPs are ordered by decreasing performance metric values from the averaged reference set (Figure \@ref(fig:tigure-avg)).
These are the same data underlying Figure \@ref(fig:tigure-avg) and Figure \@ref(fig:tigure-min) but shown for individual OM reference set scenarios, and only for satisficed MPs.

```{r tigure-panel, fig.cap="(ref:fig-tigure-panel)", out.width="0.8\\textwidth"}
knitr::include_graphics(here("mse/figures/ye-tigure-refset.png"))
```


\clearpage

(ref:fig-dot-lines)
Dot-and-line plot of performance metrics across OM scenarios.
Dots represent average performance metric values and thin lines represent the range of values across OM scenarios.
Thick lines represent the range of values across OM scenarios after dropping the high and low values.
Reference MPs are indicated by open circles (True).
Non-reference MPs are indicated by closed circles (False).

```{r dot-lines, fig.cap="(ref:fig-dot-lines)", out.width="\\textwidth"}
knitr::include_graphics(here("mse/figures/ye-dot-refset-avg.png"))
```

\clearpage

```{r tradeoff-reference, fig.cap="Trade-off between LRP 1.5GT and ST C10 average performance metrics across the OM reference set scenarios. Reference MPs are indicated by open circles (True). Non-reference MPs are indicated by closed circles (False).", out.width="5in"}
knitr::include_graphics(here("mse/figures/ye-tradeoff-refset-avg.png"))
```

\clearpage

```{r spider-satisficed-mps-avg, fig.cap="Radar-plot representation of average performance metric trade-offs for the OM reference set scenarios. The outside of the hexagon represents a performance metric probability of 1 while the middle represents a value of 0. Dashed lines represent reference MPs.", out.width="5in"}
knitr::include_graphics(here("mse/figures/ye-radar-refset-avg.png"))
```

\clearpage

```{r proj-index, fig.cap="Historical and projected HBLL-inside survey relative abundance index values. Vertical dashed line represents 2019. The shaded region represents the 95\\% quantile of the simulated index values and individual lines represent four sample replicates.", out.width="\\textwidth"}
knitr::include_graphics(here("mse/figures/ye-projections-index.png"))
```

\clearpage

(ref:fig-proj-updog-fixsel) *B*/*B*~MSY~, *F*/*F*~MSY~, and catch from the historical and projected time periods for the OM "(1) Base".
Dark line indicates the median value and the darker and lighter shaded ribbons indicate the 50% and 90% quantiles.
Thin gray lines represent illustrative simulation replicates.
The vertical dashed line indicates the last year of the historical period.
The horizontal dashed lines indicate *B*/*B*~MSY~ = 0.8 and 0.4, and *F*/*F*~MSY~ = 1.

```{r proj-updog-fixsel, fig.cap="(ref:fig-proj-updog-fixsel)", out.width="6.5in"}
knitr::include_graphics(here("mse/figures/ye-projections-updog_fixsel.png"))
```

(ref:fig-proj-low-catch) Same as Figure \@ref(fig:proj-updog-fixsel) but for the OM "(2) Low catch".

```{r proj-low-catch, fig.cap="(ref:fig-proj-low-catch)", out.width="6.5in"}
knitr::include_graphics(here("mse/figures/ye-projections-lowcatch_fixsel.png"))
```

(ref:fig-proj-episodic-recruitment) Same as Figure \@ref(fig:proj-updog-fixsel) but for the OM "(3) Episodic recruitment".

```{r proj-episodic-recruitment, fig.cap="(ref:fig-proj-episodic-recruitment)", out.width="6.5in"}
knitr::include_graphics(here("mse/figures/ye-projections-episodic_recruitment.png"))
```

(ref:fig-proj-upweight-dogfish) Same as Figure \@ref(fig:proj-updog-fixsel) but for the OM "(4) Estimate HBLL selectivity".

```{r proj-upweight-dogfish, fig.cap="(ref:fig-proj-upweight-dogfish)", out.width="6.5in"}
knitr::include_graphics(here("mse/figures/ye-projections-upweight_dogfish.png"))
```

\clearpage

(ref:fig-kobe) *B*/*B*~MSY~ and *F*/*F*~MSY~ values from the final year of the projections across all replicates.
Dots represent individual replicates.
Contour lines indicate two-dimensional kernel-density-smoothed quantiles at 0.25, 0.50, and 0.75 levels, calculated in log space.
The vertical dashed lines show B/B~MSY~ = 0.4 (left) and 0.8 (right).
The horizontal dashed line shows F/F~MSY~ = 1.

```{r kobe, fig.cap="(ref:fig-kobe)", out.width="\\textwidth"}
knitr::include_graphics(here("mse/figures/ye-kobe.png"))
```

\clearpage

(ref:fig-worm) Trajectory of *B*/*B*~MSY~ and *F*/*F*~MSY~ values summarized across replicates.
The solid line corresponds to the median value.
Each diamond represents the 50% quantile of *B*/*B*~MSY~ (horizontal) and *F*/*F*~MSY~ (vertical).
The vertical dashed lines show B/B~MSY~ = 0.4 (left) and 0.8 (right).
The horizontal dashed line shows F/F~MSY~ = 1.

```{r worm, fig.cap="(ref:fig-worm)", out.width="\\textwidth"}
knitr::include_graphics(here("mse/figures/ye-worms.png"))
```

\clearpage

(ref:fig-recdev-om-proj)
Historical recruitment deviations estimated by the SRA model (left of the vertical dashed line) and projected recruitment deviations (right of the vertical dashed line) for the six OM scenarios.
Lines represent individual replicates. For clarity, only the first 50 replicates are shown. The vertical dashed line represents the last year of the historical period (2019).

```{r recdev-om-proj, fig.cap="(ref:fig-recdev-om-proj)", out.width="\\textwidth"}
knitr::include_graphics(here::here("mse/figures/ye-compare-SRA-nat-recdev-panel-proj.png"))
```

\clearpage

## ROBUSTNESS SET RESULTS

OM Scenario (A), Low M, reduced the probability of achieving the LRP 1.5GT performance metric to a range of 0.75--0.90 compared to > 0.99 across the reference set (Figure \@ref(fig:tigure-panel-rob) vs Figure \@ref(fig:tigure-panel)).
There were similar declines in the other conservation performance metrics.

OM Scenario (B), High HBLL CV, slightly reduced the probability of achieving the ST C10 performance metric compared to the OM reference scenarios (Figure \@ref(fig:tigure-panel-rob) vs Figure \@ref(fig:tigure-panel)), presumably because of the added error in the projected HBLL index.
For example, Islope_5_lambda04 achieved at least 0.86 probability of achieving ST C10 across the reference set OMs but only achieved this performance metric with a probability of 0.79 in OM Scenario (B).

OM Scenario (A) demonstrated a trade-off between ST C10 and LRP 1.5GT among MPs (Figure \@ref(fig:tradeoff-robust)).
OM Scenario (B) demonstrated no trade-off between ST C10 and LRP 1.5GT since all MPs achieved LRP 1.5GT with probability > 0.99.
Similar to the results for the reference set, we found the radar plots challenging to interpret (Figure \@ref(fig:spider-satisficed-mps-robust)).

Projection timeseries plots of *B*/*B*~MSY~, *F*/*F*~MSY~, and catch further explain the closed-loop simulation results for the robustness set (Figure \@ref(fig:proj-low-m) and \@ref(fig:proj-high-index-cv)).
For example, in OM Scenario (A), the CC_15t MP took the stock to very low biomass levels in some replicates (Figure \@ref(fig:proj-low-m)).
The Kobe plots indicated that a number of replicates resulted in *F* > *F*~MSY~ and *B* < LRP  (Figure \@ref(fig:kobe)). 
The FMSYref and FMSYref75 MPs illustrate that catches would have to be lower in OM Scenario (A) than in the reference set OMs to achieve similar conservation outcomes (e.g., Figure \@ref(fig:proj-low-m) vs. \@ref(fig:proj-updog-fixsel)).
This occurred across the MPs, although least for the CC_10t MP, and, among the Islope MPs, it occurred the least for Islope_10_lambda04 (Figure \@ref(fig:kobe)).

There was increased TAC variability across replicates and within individual replicates in OM Scenario (B) compared to the reference set OM projections, most likely due to increased variability in the projected index (e.g., Figure \@ref(fig:proj-high-index-cv) vs. \@ref(fig:proj-updog-fixsel)).

By comparing the projections across OM scenarios on the same figure, it is clear that *F*/*F*~MSY~, *B*/*B*~MSY~, and catch were most sensitive to the OM Scenario (A) assumptions (Figure \@ref(fig:proj-scenarios)). 
Note that the rank order of MPs, which is likely more important in a decision context, differed under OM Scenario (A) compared to the OM reference set scenarios (Figures \@ref(fig:tigure-panel) and \@ref(fig:tigure-panel-rob)).

(ref:fig-tigure-panel-rob) Performance of satisficed MPs for the robustness set OMs.

```{r tigure-panel-rob, fig.cap="(ref:fig-tigure-panel-rob)", out.width="5.5in"}
knitr::include_graphics(here("mse/figures/ye-tigure-robset.png"))
```

```{r dots-satisficed-mps-robust, fig.cap="Performance of satisficed MPs for the robustness set OMs.", out.width="0.9\\textwidth", eval=FALSE}
knitr::include_graphics(here("mse/figures/ye-dot-robset.png"))
```

```{r tradeoff-robust, fig.cap="Trade-off plot between LRP 1.5GT and ST C10 performance metric values for satisficed MPs for the robustness set OMs. Reference MPs are indicated by open circles (True). Non-reference MPs are indicated by closed circles (False).", out.width="6in"}
knitr::include_graphics(here("mse/figures/ye-tradeoff-robset.png"))
```

```{r spider-satisficed-mps-robust, fig.cap="Radar-plot representation of the trade-off in performance metric values for satisficed MPs for the robustness set OMs.", out.width="\\textwidth"}
knitr::include_graphics(here("mse/figures/ye-radar-robset.png"))
```

(ref:fig-proj-low-m) Same as Figure \@ref(fig:proj-updog-fixsel) but for the OM "(A) Low M".

```{r proj-low-m, fig.cap="(ref:fig-proj-low-m)", out.width="6.5in"}
knitr::include_graphics(here("mse/figures/ye-projections-lowM_fixsel.png"))
```

(ref:fig-proj-high-index-cv) Same as Figure \@ref(fig:proj-updog-fixsel) but for the OM "(B) High HBLL CV".

```{r proj-high-index-cv, fig.cap="(ref:fig-proj-high-index-cv)", out.width="6.5in"}
knitr::include_graphics(here("mse/figures/ye-projections-high_index_cv.png"))
```

(ref:fig-proj-scenarios) B/B~MSY~, F/F~MSY~, and catch from the historical and projected time periods.
Colours represent the OM reference and robustness set scenarios.
Lines represent medians and shaded regions represent 50% quantiles.
Satisficed and reference MPs are shown from top to bottom.
The vertical dashed line indicates the last year of the historical period.

```{r proj-scenarios, fig.cap="(ref:fig-proj-scenarios)", out.width="0.9\\textwidth"}
knitr::include_graphics(here("mse/figures/ye-projections-scenarios.png"))
```

\clearpage

## COSEWIC CONSIDERATIONS

We present results with respect to meeting two alternative COSEWIC criteria (probabilities of past stock declines and probabilities of future extinction) in Appendix \@ref(app:cosewic).


<!--chapter:end:06-results.Rmd-->

# DISCUSSION {#sec:discussion}

We applied a new MP Framework for Pacific groundfishes [@anderson2020gfmp] to evaluate the ability of alternative MPs to meet rebuilding objectives for Inside Yelloweye Rockfish.
This is the first application of the MP Framework for decision-making purposes.

We evaluated the performance of 31 data-limited MPs (and three reference MPs) with respect to meeting the objectives described in Section \@ref(sec:objectives-metrics).
We screened out MPs that did not meet both satisficing criteria LRP 1.5GT > 0.9 and ST C10 > 0.50 across the OM reference set scenarios, resulting in `r gfutilities::number_to_word(length(mp_sat))` remaining MPs (`r gfutilities::commify(sort(mp_sat))`).
All remaining MPs achieved the conservation metrics LRP 1.5 GT, USR 1.5GT and LRP 1GT with greater than 0.98 probability (49 times out of 50) across all four OM reference set scenarios.
This was largely because none of the reference set OMs estimated the stock to be in the critical zone in 2020---the start of the projection period.
Within the two OM robustness set scenarios, OM Scenario (B), which simulated higher variability in the future HBLL survey, performed similarly to the OM reference set scenarios.
However, under OM Scenario (A), the Low M scenario, the probabilities of meeting the performance metric LRP 1.5GT ranged from 0.75 (75 times out of 100) to 0.9 (nine times out of 10), with the current MP (CC_15t) having the lowest probability in this range.

Whereas the rebuilding plan guidance [@dfo2013] only describes objectives related to rebuilding, we also evaluated performance of MPs with respect to three average-catch objectives and one catch-variability objective.
The CC_10t and CC_15t MPs, by definition, met their respective ST C10 and ST C15 performance metrics.
The Islope MPs showed some contrast across MPs within the reference set for ST C10 and ST C15, depending on the MP configuration and the OM scenario.
The OM robustness set scenarios generally produced lower probabilities of meeting the ST C10 metric.

We presented a number of visualizations to show trade-offs among conservation and catch objectives [see also @anderson2020gfmp].
The visualizations present trade-offs in different tabular and graphical formats, intended to support the process of selecting the final MP.
Because all the MPs met the LRP 1.5 GT objective under the OM reference set scenarios, there were no strong trade-offs between conservation and catch objectives.
Of the two OM robustness set scenarios, trade-offs were most apparent under the Low M scenario, where the probability of meeting the LRP 1.5GT objective decreased as the probability of achieving an ST C10 increased.

We found the radar plot visualizations difficult to interpret.
While these plots can be useful for rapid visualization of multiple trade-offs, and have been recommended for visualization of MSE results [@punt2017], they become more difficult to interpret as more metrics ("spokes") are added.
They are also very sensitive to the order in which the metrics are placed, and have been shown to be less interpretable that Cartesian plots [@diehl2010; @feldman2013; @albo2016]. We presented radar plots here to gauge interest from RPR participants and solicit feedback on whether to include them in future applications of the MP Framework.

## NATURAL MORTALITY {#sec:discussion-m}

The purpose of the robustness set is to explore OM formulations that represent alternative  hypotheses to those in the reference set [@rademeyer2007; @punt2016].
Candidate MPs should perform well across both OM reference and robustness scenarios [@rademeyer2007].
In our study, the two OM robustness set scenarios performed differently from the OM reference set scenarios, especially OM Scenario (A).
This low mortality/low productivity scenario ($M \sim \textrm{Lognormal}(0.025, 0.2)$) was the only one where the median biomass was estimated to be in the critical zone at the start of the projection period.
For all other OM scenarios, we sampled from a probability distribution for *M* with mean 0.045 y^-1^, which matched that used in the previous stock assessment [@yamanaka2011].

The rate of natural mortality of fish populations is of one of the most important, yet most difficult parameters to estimate. 
Numerous methods have been developed to estimate *M* from available life history parameters.
An [app](http://barefootecologist.com.au/shiny_m.html) developed by NOAA scientists that estimates *M* using various published empirical methods was populated with inside Yelloweye Rockfish parameters. Estimates of *M* ranged from 0.03 to 0.17, depending on the empirical method. Other Yelloweye Rockfish assessments have used lower values for *M*, closer to or lower than those used in OM Scenario (A) (mean 0.025 y^-1^).
For example, the recent rebuilding plan for the outside stock of Yelloweye Rockfish estimated median values for *M* between 0.031 *y*^-1^ and 0.044 *y*^-1^, depending on the OM [@cox2020].
The 2008 COSEWIC assessment and status report for inside and outside Yelloweye Rockfish stocks [@cosewic2008] used a value of *M* = 0.02 *y*^-1^, citing the 2001 stock assessment for the inside stock [@yamanaka2001].
Similarly, stock assessments for the southern Gulf of Alaska stock of Yelloweye Rockfish have used a value of *M* = 0.02 *y*^-1^ [@wood2019].

It is likely that natural mortality rates have varied over time, due to changes in predator populations in the Strait of Georgia. 
Yelloweye Rockfish occupy a relatively high trophic position [@olson2020] and Steller Sea Lions, Orca Whales (*Orcinus orca*) and Chinook Salmon (*Oncorhynchus tshawytscha*) are the only predators of Yelloweye Rockfish listed in a large data-base of predator-prey interactions (database assembled for @dunne2016; @szoboszlai2015). 
Populations of all three predator species have experienced large fluctuations in the last century.
Steller Sea Lion abundance was greatly reduced due to hunting and predator controls, but have now recovered to historical levels [@olesiuk2018; and see Appendix F]. 
The Southern Resident population of Orca Whales is endangered and the Northern Resident population is threatened [@cosewic2008b]. The cause of decline for both populations is attributed to the declining abundance of Chinook Salmon [@ford2010].
Pacific Halibut have also been observed preying on Yelloweye Rockfish in the Gulf of Alaska [@livingston2017]; however, Pacific Halibut are not very abundant in inside waters (see data for 2018 IPHC survey in @anderson2019synopsis). 
Lingcod are likely predators of juvenile Yelloweye Rockfish as they are known predators of rockfish species. 
However, stomach content studies are often not able to resolve rockfish species beyond unidentified rockfish (i.e. @beaudreau2007, @livingston2017).
Lingcod in the Strait of Georgia also suffered major population declines and were thought to have been fished down to 2% of historic levels in 1990 but the population has increased since [@logan2005; @holt2016]. 
Future projects might investigate the effects of time-varying natural mortality on Inside Yelloweye Rockfish.

## ROCKFISH CONSERVATION AREAS {#sec:discussion-rca}

As part of the rockfish conservation strategy, 164 Rockfish Conservation Areas (RCAs), in which fisheries targeting or catching rockfish as bycatch are prohibited, were established in BC waters between 2004-2006 [@yamanaka2010]. 
There are 130 RCAs in Area 4B (Figure \@ref(fig:map-4B)) that protect an estimated 267 square kilometres of rockfish habitat, amounting to 22% of available rockfish habitat in inside waters [@haggarty2018]. 
Although RCAs were established as one measure to help rebuild rockfish populations [@yamanaka2010], this analysis does not consider any possible effects of the closures. 
Remotely Operated Vehicle (ROV) surveys of RCAs in inside waters found that there was no difference in the abundance or size of Yelloweye Rockfish inside RCAs at the time of study (3-7 years after RCA establishment) [@haggarty2016b]. 
It is expected that, given the late age-at-maturity and longevity of rockfishes, it will take upwards of 20 years for populations to show responses to closed areas [@starr2015]. 
The RCAs in the inside waters have now been in place for 14 to 16 years, so we might expect to find increased densities and sizes of rockfish in RCAs soon. 
DFO, in partnership with biologists from the Washington Department of Fish and Wildlife (WDFW) and the National Ocean and Atmospheric Administration (NOAA), undertook an ROV survey of several RCAs in the Strait of Georgia in the fall of 2018 on board the CCGS Vector. 
However, results from this survey were not available in time to be included in this project. 

## STOCK STATUS {#sec:discussion-status}

The rebuilding plan for the inside stock of Yelloweye Rockfish was triggered by the 2010 stock assessment [@yamanaka2011], which estimated the stock to be below the LRP with high probability.
Out of all the reference  and robustness set OMs explored in our analysis, only OM Scenario (A), Low M, estimated median spawning biomass to be below the LRP in 2010.
In all OM scenarios, log recruitment deviations began to increase after 2000, albeit still below zero, likely tracking slight increases in the HBLL index during this period. 
The 2010 assessment used a surplus production (SP) model, with fundamentally different structural assumptions to the SRA used for conditioning OMs in our analysis.
As a check, we fit a SP model, similar to that used by @yamanaka2011, and obtained much lower biomass and stock status estimates than from the reference set SRA OMs.
Furthermore, the estimate of *B*~MSY~ was higher for the SP model than our OM Scenario (1), while the *F*~MSY~ estimate from the SP model was lower than those from the reference set SRA models, indicating lower productivity in the SP model.
The fact that the SP model had lower estimated productivity and biomass, and higher *B*~MSY~ would lead to a more pessimistic assessment of stock status.
The SP-fitting exercise suggests that model structure, rather than the addition of ten years of new data since the last assessment, was a major factor contributing to different perceptions of stock status between the current OMs and the previous assessment.

In a recent evaluation of the outside stock of Yelloweye Rockfish, @cox2020 found similar differences between their age-structured OMs, which estimated stock status to be above the LRP, and the 2014 SP-based assessment [@yamanaka2018yelloweyeoutside], which found the stock to be below the LRP, triggering a rebuilding plan.
@cox2020 noted that structural differences between SP and age-structured models would be expected to produce different results, particularly due to differences in the formulation of productivity.
We were able to mimic the stock status estimates of @yamanaka2011 when we forced the stock to have lower productivity in OM Scenario (A), although the mean value of *M* used in OM Scenario (A) was lower than that used by @yamanaka2011 to develop the productivity prior for their SP model.
@cox2020 noted that age-structured models allow for lags in recruitment to fisheries, surveys, and the spawning stock, characteristics that can promote resilience and are more realistic for a long-lived species like Yelloweye Rockfish.
These differences are controlled by fishery selectivity-at-age, survey selectivity-at-age and maturity-at-age, respectively, in age-structured models and can be over-simplified in aggregate SP models.
Our OM Scenario (4), where we estimated survey selectivity-at-age, resulted in lower estimates of stock status, implying that assumptions about selectivity were a contributing factor to perceptions of stock status (see Section \@ref(sec:discussion-uncertainties-selectivity)), most likely resulting from impacts on other parameter estimates such as *R*~0~ and autocorrelation in recruitment.
@cox2020 also noted that their SP-based MPs tended to underestimate biomass, which we also found in the current study, where the SP MPs generated no catch in the first decade of the projections.

Despite differences in perception of stock status among some of our OMs, and between this and the previous stock assessment, we note that the MP Framework provides a method for integrating across the major uncertainties in stock status and reference points (see Section \@ref(sec:discussion-implicit)) that are prevalent for this stock.
In particular, the inclusion of OM Scenario (A) in the robustness set provides decision-makers with an alternative view of stock status and performance of MPs. In cases such as these, where the data available are not sufficient to resolve the different estimates of stock status a "weight of evidence" approach can be used to make management decisions [@kronlund2020]. A weight of evidence approach considers the combined contributions of individual studies (totality of evidence) and enlists expert judgement to assign weights for each line of evidence (individual studies or operating models). 

## KEY UNCERTAINTIES {#sec:discussion-uncertainties}

### Selectivity {#sec:discussion-uncertainties-selectivity}

Selectivity was a major source of uncertainty in our OMs.
There are no available age-composition data for commercial or recreational fisheries, and none from the Dogfish survey.
We therefore fixed selectivity for all these gears.
Commercial and recreational selectivities were set to match those reported for the outside stock [@cox2020] and we set selectivity in the Dogfish survey to mirror the value used for the HBLL survey.
However, it was noted during the Outside Yelloweye Rebuilding process that additional biological sampling should be undertaken to inform the selectivity of commercial, recreational and FSC catches [@dfo2020], and this recommendation equally applies to the inside population. Full biological data, including otoliths from Yelloweye Rockfish were collected on the Dogfish survey in 2019 for the first time.
Although the ages were not yet available for this work, they may inform selectivity of the Dogfish survey for future work. 
We also initiated a project in August 2019 to compare the HBLL and Dogfish gear by fishing some of the Dogfish survey sites with both the HBLL and Dogfish survey gear. These data may also inform the comparability of the two surveys.  

Age-composition data from the area 4B surveys were sparse and have only been collected in recent years.
Initial attempts to estimate selectivity in the HBLL survey (coupled with equal weighting between the HBLL and Dogfish survey) resulted in implausible estimates of age-at-full-selectivity and a strong retrospective pattern in biomass estimates.
We therefore fixed age-at-full-selectivity at 22 *y*, and upweighted the Dogfish survey likelihood component, which greatly improved the retrospective behaviour.
To separate the effects of upweighting the Dogfish survey from fixing HBLL selectivity, we estimated HBLL selectivity in OM Scenario (4), which slightly changed the perception of stock status.

While we could have explored other fixed selectivity assumptions, we believe we used the most plausible values, and, for the HBLL survey, included an alternative OM scenario in the reference set.
Future applications of the MP Framework for this stock could explore other selectivity OM scenarios.


### Historical catch {#sec:discussion-uncertainties-catch}

The other major source of uncertainty in our analyses is the magnitude of historical commercial and recreational catch. Uncertainty regarding commercial catch is due to reporting of rockfishes other than Pacific Ocean Perch in an aggregate category before 1950, and large uncertainty in the magnitude of unreported catch during the period 1986--2005.
A reconstruction of historical catch data to 2005 was done by @haigh2011, which attempted to parse out Yelloweye Rockfish from the aggregated rockfish category and to account for discarded fish.
The reconstructed catches were used in the previous stock assessment [@yamanaka2011].
While there has been some controversy over reconstructed catch data, for both the outside and inside Yelloweye stocks, re-evaluation of the reconstruction was outside the scope of this work and it remains the best available time series of historical catches.
We therefore followed the same approach to reconstructing historical recreational catch data and estimating current recreational catch data as @yamanaka2011.
We evaluated the effect of doubling the nominal catch data for the period 1986--2005 in OM Scenario (2) but performance of MPs was not appreciably different from other OM reference set scenarios.

We deviated from @yamanaka2011 in our treatment of FSC catch. They applied an algorithm to explicitly estimate FSC catch, based on assumptions about consumption rates.
After discussions with Fisheries Biologists who work with local First Nations in the northern and southern portions of Area 4B, we elected to include FSC catches with commercial catches in the northern portion, because most of the rockfish catch is understood to be caught under dual fishing licences and would therefore be included in DFO commercial catch databases.
We elected to assume FSC catches in the southern region were accounted for in recreational catches, because most of the rockfish catch is caught from small vessels, so effort, at least, is likely already counted by DFO overflights.
We recognize the large uncertainties surrounding FSC catch.
Future applications of the MP Framework for this stock would benefit from more detailed collaborative work with First Nations to quantify contemporary and historical FSC catch in Area 4B.

## IMPLICIT VS. EXPLICIT KNOWLEDGE OF LIMIT REFERENCE POINTS {#sec:discussion-implicit}

This MP Framework, and all MSE processes, differ from conventional stock assessments in the way science advice is delivered [@anderson2020gfmp].
In most BC groundfish stock assessments [e.g., @yamanaka2011; @starr2017; @forrest2019], catch advice is presented in the form of decision tables, where probabilities of breaching reference points (e.g., probability of the stock falling below the LRP) are presented over a range of possible future TAC levels.
This approach depends on explicit reporting of reference points and estimation of stock status.
Following the production of a decision table, it is then the job of the decision-makers to select a future TAC based on the probabilities presented, taking into consideration other factors such as the economic needs of the fishery and some level of risk tolerance.
In this process, consideration of risk occurs at the final step of the decision-making process and may not always be transparent or be related to pre-agreed objectives.

MP frameworks differ from conventional assessments in two key ways: (1) reference points and stock status are not necessarily explicitly reported; and (2) objectives related to the probability of breaching reference points must be agreed upon at the beginning of the process, (i.e., Step 2 of the best practices).
Reference points and stock status are therefore still an integral component of the framework, but they are calculated in the OMs and are built into the performance metrics.
Critically, agreement on acceptable risk (e.g., acceptable probabilities of breaching reference points) must be reached at the beginning of the process so that performance metrics and satisficing criteria can be established.

For many stocks, especially data-limited stocks, it is not possible to reliably estimate biological reference points or estimate stock status.
MP frameworks such as this one may be especially important for these stocks.
The Sustainable Fisheries Framework and the Fish Stocks provisions of the *Fisheries Act* require that fish stocks be maintained at sustainable levels, and particularly above the LRP.
This framework implicitly preserves the intent of these policies despite the fact that reference points and stock status are not explicitly emphasized.

## REASSESSMENT FREQUENCY AND TRIGGERS {#sec:discussion-triggers}

In general, the purpose of an MP framework is to identify and select a robust MP that can be left in place for an agreed amount of time.
Interim checks between assessments are also recommended to ensure the selected MP is performing as expected.
In addition to the MSE best practice steps, @carruthers2018 describe a final evaluation step, where performance of the selected MP is formally reviewed once it has been implemented.
Departures from an MP's expected performance have been termed "exceptional circumstances".
These may occur when the observed system dynamics fall outside the range of OM scenarios specified in the OMs over which the MP was demonstrated to be robust [@butterworth2008].

Evidence for exceptional circumstances, occurring within the recommended assessment interval, would trigger a review of the OM(s) and MP, possibly resulting in a new OM, or an adjustment to the selected MP [@carruthers_hordyk_2018].
These authors list several examples of MSEs where formal protocols for detecting exceptional circumstances have been established.
In general, formal protocols include monitoring the biomass index, catch, and other data-types such as age-composition data, and comparing observations to the OM predictions.
An example of a trigger for re-evaluation could be the observed index of abundance falling outside the 90% confidence interval of the OM-projected index.
See @carruthers_hordyk_2018 for further recommendations on formal evaluation procedures.
Informal evaluation procedures, via feedback from stakeholders or visual comparison of observed data vs. projected data, can also be used to detect exceptional circumstances [e.g., @cox2008a].

Satisficed MPs in the current analyses included constant catch MPs and annual Islope MPs. All of the index-based MPs were also evaluated at five-year intervals. While all of these MPs met the LRP 1.5GT criteria, none of them met the ST C10 criteria.
Therefore, if an index-based MP is selected, we recommend annual updates.
In line with guidance for rebuilding plans in Canada [@dfo2013], we recommend re-evaluation of the performance of the selected MP at least every three years.

\clearpage

# ACKNOWLEDGEMENTS

We are grateful to Adam Keizer and Maureen Finn (Groundfish Management Unit), and Roger Kanno (Sustainable Fisheries Framework Coordinator) for helpful discussions and guidance regarding objectives for the rebuilding plan.

We are very grateful to Bob Bocking, Cheri Ayers and Christa Rusel, fisheries consultants working with local First Nations; and Mark Fetterly, Aleta Rushton and Patrik Zetterberg from DFO, who provided very helpful advice regarding FSC catch.

Ross Claytor and Dwayne Lepitzki from COSEWIC provided useful guidance on the development of performance metrics that we be of use for COSEWIC assessments. 

Strahan Tucker and the pinniped team, DFO, provided data on Pinniped abundance and rockfish consumption rates.
Spencer Wood, The Natural Capital Project, Stanford University, searched their large predator-prey database for us.

Rowan Haigh provided advice on the historical catch reconstruction.

We thank Tom Carruthers and Adrian Hordyk (UBC) for early guidance on this rebuilding plan and their cheerful willingness to add new features to the DLMtool software on request.

Finally we thank Dayv Lowry (WDFW) and Kendra Holt (DFO) for insightful reviews that greatly improved the working paper.


<!--chapter:end:07-discussion.Rmd-->

<!-- In general, you shouldn't need to edit this file with the exception of
the following French/English translation. For a French document, set the following header to: # RFRENCES CITES {-} -->

\clearpage

# REFERENCES {-}

<!--chapter:end:99-references.Rmd-->

---
output:
  word_document: default
  html_document: default
---
\clearpage

`r if(knitr:::is_latex_output()) '\\Appendices'`

`r if(!knitr:::is_latex_output()) '# (APPENDIX) Appendix {-}'`

# BIOLOGICAL DATA {#app:biological-data}

Inside Yelloweye Rockfish, which reside in area 4B (Figure \@ref(fig:map-4B)), are genetically distinct from the outside stock of Yelloweye Rockfish, whose range covers the rest of the coast [@andrews2018; @siegle2011; @siegle2013]. The northerly boundary between the two stocks is found in the middle of the Queen Charlotte Strait, north of Malcolm Island. Understanding of the Southern boundary has recently changed, based on analyses presented in @andrews2018, who argue that the Victoria Sill is the most likely geological boundary between the two populations and that the inside population extends into Puget Sound. Groundfish management area 4B is used to define the inside stock, despite the fact that area 4B extends beyond the boundaries of the biological population (Figure \@ref(fig:map-4B)). The inside and outside stocks are also considered two separate designatable units by COSEWIC [@cosewic2008].

## AGE, SIZE, AND GROWTH {#sec:growth}

Yelloweye Rockfish are a long-lived species, with a reported maximum age of 121 *y* for the outside stock [@keppel2019]. The maximum observed age for the inside Yelloweye Rockfish stock is 101 years, updated from the previously reported max age of 98 years based on additional recent ageing data (Figure \@ref(fig:age-freq)). 
Age data for Inside Yelloweye Rockfish, derived from the break and burn or break and bake methods, are available from various surveys in area 4B from 1984-2018.
Directed hard-bottom longline (HBLL) surveys began in Area 4B in 2003 after which greater numbers of Yelloweye Rockfish were aged.
Proportions-at-age of Yelloweye Rockfish are shown by year and sex in Figure \@ref(fig:age-freq). It is assumed that all ages are independent of subarea.
Human error can occur in reading ages from otoliths. Ageing precision for inside Yelloweye Rockfish is plotted in Figure \@ref(fig:age-precision) which displays ages for fish that were aged twice by independent technicians, including each technicians' reported range of possible ages.


Inside Yelloweye Rockfish grow up to 75.9 cm in length for males and 76.9 cm for females (Figure \@ref(fig:length-freq)). The maximum recorded weight is 8.0 kg for both males and females. Length-weight model fits and plots for all available survey data in area 4B are shown in Figure \@ref(fig:length-weight). It is assumed that all measurements are independent of subarea. The length-weight curve is of the form:

$$
\log (W_i) \sim \operatorname{Student-t}(df = 3, \log(a) + b \log(L_i), \sigma),
$$

with $W_i$ and $L_i$ representing the weight and length for fish $i$, respectively, and $\sigma$ representing the observation error scale.
We set the degrees of freedom of the Student-t distribution to 3 to be robust to outliers [@anderson2019synopsis].
The variables $a$ and $b$ represent the estimated length-weight parameters.
Length-age model fits and plots for inside Yelloweye Rockfish are shown in Figure \@ref(fig:length-age). The length-age growth curve is a von Bertalanffy model of the form:

$$
L_i \sim \operatorname{Log-normal}
\left( \log(l_\mathrm{inf} (1 - \exp(-k (A_i - t_0)))) -
\sigma^2 / 2, \sigma \right),
$$

where $L_i$ and $A_i$ represent the length and age of fish $i$, $l_\mathrm{inf}$, $k$, and $t_0$ represent the von Bertalanffy growth parameters, and $\sigma$ represents the scale parameter. The term $- \sigma^2 /2$ represents a 
lognormal bias adjustment term so we model the mean length rather than the median.
The model was fit in TMB as described in @anderson2019synopsis.

## MATURITY {#sec:maturity}

Yelloweye Rockfish, in addition to being large and long-lived, are also slow to mature. In order to examine age at maturity, sample records from all surveys within area 4B were analyzed for specimens that were identified as male or female with a valid maturity code and for which age was determined using the break and burn or break and bake methods. 

Maturity ogives are fit as logistic regressions to individual fish specimens, which are categorized as mature vs. not mature against length or age (Figure \@ref(fig:percent-maturity)):

\begin{align}
y_i &\sim \mathrm{Binomial}(\pi_i)\\
\mathrm{logit} \left( \pi_i \right) &= \beta_0 + \beta_1 x_i + \beta_2 F_i
\end{align}

where $y_i$ represents a 1 if fish $i$ is considered mature and a 0 if fish $i$
is considered immature. The $\beta$ parameters represent estimated coefficients,
$x_i$ represents either the length or age of fish $i$, and $F_i$ represents
a binary predictor that is 1 if the fish is female and 0 if the fish is male.
The variable $\pi_i$ represents the expected probability of fish $i$ being
mature. Models are fit to all available survey samples regardless of time of
year. Predicted vs. observed proportions mature-at-age are shown in Figure \@ref(fig:prop-mature).

(ref:fig-percent-maturity) Age-at-maturity ogive plots for inside Yelloweye Rockfish. The solid black lines represent fits to the female fish and the dashed grey lines represent fits to the male fish. The vertical lines indicate the estimated age at 50% maturity. Text on the panels indicates the estimated age at 5, 50 and 95% maturity for females (F) and males (M). Short rug lines along the top and bottom represent up to 1500 randomly chosen individual fish with a small amount of random jittering to help differentiate individual fish.

Maturity frequency by each month is shown in the bubble plot in Figure \@ref(fig:mat-months) for all fish in all surveys within area 4B for which maturity was sampled. Categories of maturity are listed from most immature (top) to most mature (bottom); individual fish, once mature, cycle through the mature stages.

## GENERATION TIME {#sec:generation}

Rebuilding guidance states that the timelines for rebuilding should be 1.5 to 2 times the generation time of the species [@dfo2013], where generation time is the average number of years between the birth of an individual and the birth of its offspring. 
A recent analysis for the Outside Yelloweye Rockfish stock estimated generation time at approximately 38 years which was the average age of the modeled unfished spawning stock [@cox2020]. 
We fixed generation time for Inside Yelloweye to be equal to that estimated for Outside Yelloweye Rockfish to align rebuilding timeframes between the two stocks.  

However, previous generation time estimates from COSEWIC and Pre-COSEWIC reports have been calculated using age at maturity and natural mortality (age at 50% maturity + 1/M). In 2008, a natural mortality rate of 0.02 and age at 50% maturity for females in the inside stock of 37.5 years were used to estimate generation time at 70 years [@cosewic2008], which is now thought to be higher than it probably is. 
In 2018, this was revised to be 40.5 to 45.0 years using a natural mortality of 0.038 and age at 50% maturity of 14.2 to 18.7 years, estimated using commercial and research data, respectively [@keppel2019]. 
Using this formula and the median estimate of natural mortality used in our baseline OM, 0.045, and the inside 50% maturity presented in Figure \@ref(fig:percent-maturity), the generation time would be 36 for females and 40 for males. 
There is, of course, great uncertainty associated with the estimation of generation time using this formula given that natural mortality is usually listed as the major axis of uncertainty in any stock assessment (e.g. @gertseva2017, this analysis). 
Maturity estimates, especially the classification of mature and immature individuals when done macroscopically, are also imprecise [@head2016]. 
Lastly, age estimates are also subject to error (Figure \@ref(fig:age-precision) replotted from Appendix A of the BC Groundfish Data Synopsis Report [@anderson2019synopsis]).



\clearpage

(ref:fig-age-freq) Age-frequency plot for Inside Yelloweye Rockfish from all available surveys in Area 4B: hard-bottom 
longline surveys (northern and southern) in inside waters (HBLL INS N/S), hard-bottom longline surveys in outside waters (a small portion of area 4B was included in this survey in 2014 and 2016; HBLL OUT S), and "OTHER" surveys including jig surveys in 1985 and 1986 and a bottom trawl survey in 2005. 
Female fish are shown as coloured circles and male fish are shown behind as light grey
circles. The total number of fish aged for a given survey and year are indicated
along the top of the panels. Diagonal lines are shown at five-year intervals to
facilitate tracing cohorts through time.


```{r age-freq, fig.cap="(ref:fig-age-freq)", out.width="6in"}
library(here)
knitr::include_graphics(here("mse/figures/age-freq.png"))
```


(ref:fig-age-precision) Ageing precision plot for inside Yelloweye Rockfish. Each dot and cross-hatch represents an individual fish that has been aged twice. The x-axis represents the age and upper and lower ends of the possible age range recorded for the initial ('primary') ageing of the fish. The y-axis represents the equivalent values recorded for the second ('precision') ageing of the fish by a different technician. The dashed diagonal line represents a perfect one-to-one agreement between the two ages. 300 fish have been randomly sampled from all Yelloweye Rockfish precision-aged, and a small amount of random jitter has been added to both axes to reduce overplotting with the same jitter value added to both the x and y axes for a given fish.


```{r age-precision, fig.cap="(ref:fig-age-precision)", out.width="4in"}
library(here)
knitr::include_graphics(here("figs/ye-ins-age-precision.png"))
```



(ref:fig-length-freq) Length-frequency plot for Inside Yelloweye Rockfish from all available surveys in Area 4B: hard-bottom 
longline surveys (northern and southern) in inside waters (HBLL INS N/S), hard-bottom longline surveys in outside waters (a small portion of area 4B was included in this survey in 2014 and 2016; HBLL OUT S), and "OTHER" surveys including jig surveys in 1985 and 1986 and a bottom trawl survey in 2005. Female fish are shown as coloured bars and male fish are shown behind as light grey bars. The total number of fish measured for a given survey and year are indicated in the top left corner of each panel.


```{r length-freq, fig.cap="(ref:fig-length-freq)", out.width="5in"}
library(here)
knitr::include_graphics(here("mse/figures/length-freq.png"))
```

```{r length-weight, fig.cap=paste0("Length-weight model fits and plots for inside Yelloweye Rockfish. Female model fits are indicated as solid black lines and male model fits are indicated as dashed grey lines. Text on the panels shows the parameter estimates and open grey circles represent individual fish that the models are fit to. These figures include all survey samples in area 4B."), out.width="0.6\\textwidth"}
library(here)
knitr::include_graphics(here("mse/figures/length-weight.png"))
```

```{r length-age, fig.cap=paste0("Length-age model fits and plots for inside Yelloweye Rockfish. Female model fit is indicated as a solid black line, male model fit is indicated as a dashed grey line, and combined sex model fit is indicated by a thin black line. Text shows the parameter estimates and open grey circles represent individual fish that the models are fit to. These figures include all survey samples."), out.width="0.6\\textwidth"}
library(here)
knitr::include_graphics(here("mse/figures/vb.png"))
```

```{r percent-maturity, fig.cap="(ref:fig-percent-maturity)", out.width="0.6\\textwidth"}
library(here)
knitr::include_graphics(here("mse/figures/mat-ogive-age.png"))
```

(ref:fig-prop-mature) Predicted and observed proportions mature-at-age for inside Yelloweye Rockfish.

```{r prop-mature, fig.cap="(ref:fig-prop-mature)", out.width="0.6\\textwidth"}
library(here)
knitr::include_graphics(here("mse/figures/mat-prop.png"))
```

(ref:fig-mat-months)   Maturity-frequency-by-month plot for inside Yelloweye Rockfish. The area of each circle corresponds to the number of fish specimens in a given maturity category for the given month. Female fish are indicated by black circles and male fish are indicated by light grey circles behind. The total number of fish specimens for each month are indicated by the numbers at the top of the plot.

```{r mat-months, fig.cap="(ref:fig-mat-months)", out.width="0.6\\textwidth"}
library(here)
knitr::include_graphics(here("mse/figures/mat-months.png"))
```

\clearpage

## SUMMARY TABLE OF BIOLOGICAL DATA AVAILABLE

```{r test, results='asis'}
dat <- readRDS(here("data-generated/yelloweye-rockfish-ins-privacy.rds"))
sum <- dat$survey_samples  
sum <- sum %>%
  group_by(year) %>%
  summarise(
    specimens = sum(!is.na(specimen_id)),
    length = sum(!is.na(length)),
    weight = sum(!is.na(weight)),
    maturity = sum(!is.na(maturity_name)),
    aged = sum(!is.na(age)),
    age_specimen_collected = sum(!is.na(age_specimen_collected))) %>%
  mutate(specimens = gsub("\\\n", " ", specimens))
sum %>%
  csasdown::csas_table(caption = "Inside Yelloweye Rockfish biological data.",
    col_names = c("Year", "Specimens", "Lengths", "Weights", "Maturities", "Ages", "Age specimen collected"),
    align = c( "c", "c", "c", "c", "c", "c", "c")) %>%
  kableExtra::kable_styling(latex_options = c("hold_position"))
```

\clearpage

<!--chapter:end:08-app-biological-data.Rmd-->

# FISHERY-INDEPENDENT SURVEY DATA {#app:index-data}

We conditioned the operating models using indices of abundance from the inside Hard Bottom Longline (HBLL) survey and the Strait of Georgia Dogfish Longline survey. Survey design and modelling of indices for each survey are described here.   

## INSIDE HBLL SURVEY INDEX {#sec:hbll-index-data}

The Inside HBLL survey for the Strait of Georgia management area (4B) has been providing catch-rate indices and associated biological data for inshore rockfish assessment since 2003 [@lochead2007].
The survey has a depth-stratified random design consisting of 2km by 2km survey blocks, and has always taken place on the CCGS Neocaligus vessel.
The survey uses size 13/0 snap-type circle hooks and squid bait with a two-hour soak time.
Hook-by-hook data, which has been collected since the start of the survey, is electronically collected and stored in a database.
For further details on survey design see @lochead2004.

The survey area is divided into northern and southern regions (Figure \@ref(fig:map-HBLL-NS)), which are fished in alternating years.
The border between the two regions occurs approximately at the northern ends of Pacific Fishery Management Areas (PFMAs) 14 and 15 (Figure \@ref(fig:map-4B)).
However, several irregularities have occurred (Figure \@ref(fig:hbll-raw)):

(ref:fig-map-HBLL-NS) Map of HBLL survey blocks indicating the northern (blue) and southern (green) regions. RCAs (orange blocks) are also shown.

```{r map-HBLL-NS, fig.cap="(ref:fig-map-HBLL-NS)", out.width="5in"}
knitr::include_graphics(here::here("figs/YE_Inside_2019_HBLL_L.png"))
```

- The survey did not take place in 2006 and 2017.
- The length of the survey has varied annually, and has lead to inconsistencies in the geographic extent surveyed between years.
- Desolation Sound (PFMA 15) is allocated as part of the southern region, but was sampled as part of the northern region in 2003, 2008, and 2019, and not sampled in 2009 and 2018. Catch rates of Yelloweye Rockfish are highest in Desolation Sound (PFMA 15; Figure \@ref(fig:map-4B)). Therefore, we expect the lack of sampling in 2009 and 2018 to have an effect on survey estimates from the southern survey.
- The full southern survey was not completed in 2009 where only 38 blocks were fished in the southern Strait of Georgia, and only between Nanaimo and Victoria. This is in contrast to normal years when approximately 70 blocks are fished as far north as Campbell River. Catch rates of most rockfish species caught on this survey tend to decline from the north to the south, so this could also have a major effect on the survey index in that year.

We applied a geostatistical spatiotemporal model to standardize of the HBLL index [e.g., @shelton2014; @thorson2015; @anderson2019synopsis] to account for the irregular implementation of the survey design (Section \@ref(sec:hbll-spatiotemporal)).
We confirmed, via simulation, that this approach can "stitch" together the north and south survey regions with relatively little bias (Section \@ref(sec:hbll-sim)).

### Hook competition {#sec:hbll-hook-competition}

A longline index of species abundance may not be proportional to actual abundance under certain conditions.
For example, if there is a high degree of competition among species for baited hooks, the actual catch may not accurately reflect the true abundance of less competitive species [@kuriyama2018].
The Inside HBLL survey catch is mostly comprised of North Pacific Spiny Dogfish (*Squalus suckleyi*; hereafter "Dogfish"), which are potentially a major hook competitor with rockfishes [@obradovich2018].
As in @yamanaka2011, we applied a hook competition correction, which accounts for the competition between individual fish for the bait on hooks, to the HBLL survey data. 
To apply the correction, a competition adjustment factor is estimated for each set, in each year.
This adjustment factor, $A_{i,t}$, scales up the observed number of Yelloweye Rockfish caught, $N_{i,t}$, for each set $i$ in each year $t$ to give the expected number of fish caught after accounting for competition, $N_{i,t}^{(0)}$:

$$
N_{i,t}^{(0)} = A_{i,t} N_{i,t}.
(\#eq:Nit)
$$

The adjustment factor depends on the proportion of observed hooks that are returned with bait still on them, $P_{i,t}$ (Figure \@ref(fig:hbll-baited)):

$$
A_{i,t} = - \frac{ \log P_{i,t}}{1 - P_{i,t}}.
(\#eq:hbll-hook-adjustment)
$$

As $P_{i,t} \rightarrow 0$, $A_{i,t} \rightarrow \infty$, so that the expected number $N_{i,t}^{(0)} \rightarrow \infty$.
Therefore, in cases where zero hooks were returned with bait, we set the number of baited hooks to one.
See @anderson2019synopsis (their Appendix G, Section G.5) for further details on the hook competition correction.
We passed the hook-competition-adjusted data (Figure \@ref(fig:hbll-hook-adjustment)) to the spatiotemporal model to develop the index of abundance.

### Spatiotemporal HBLL index standardization {#sec:hbll-spatiotemporal}

We fit a geostatistical spatiotemporal index-standardization model:

\begin{align}
  y_{s,t} &\sim \mathrm{NegBin}\left(\mu_{s,t}, \phi \right),\\
  \mu_{s,t} &= \exp \left( \bm{X}_{s,t} O_{s,t} + \bm{\beta} + \omega_s + \epsilon_{s,t} \right),
(\#eq:hbll-model)
\end{align}

where NegBin refers to the negative binomial distribution (the NB2 parameterization [@hilbe2011] where the variance scales quadratically with the mean),
$\phi$ represents the dispersion parameter,
$y_{s,t}$ and $\mu_{s,t}$ refers to the observed and expected value, respectively, at spatial point $s$ and time $t$,
$\phi$ refers to the dispersion parameter,
$\bm{X}$ refers to a design matrix, and
$\beta$ refers to a vector of estimated coefficients (an independent mean for each year).
The symbol $O_{s,t}$ represents an "offset" for the number of hooks and the hook-competition-adjustment factor.
Specifically, it was represented as $\log \left(S_{i,t} / A_{i,t} \right)$, where $S_{i,t}$ represents the area "swept" by the set.
We calculated of the area swept based on the number of hooks ($N^\textrm{hooks}_{i,t}$) in set $i$ and year $t$ as:

$$
N^\textrm{hooks}_{i,t} \cdot 0.0024384 \cdot 0.009144 \cdot 1000.
$$

The value 0.002438 corresponds to the spacing between hooks (8 ft) in kms, 0.009144 to an assumed 30 ft area swept around the set that fish are catchable (in kms), and 1000 scales the area swept from km to m.
Note that the 30 ft assumption only serves to scale the density up or down in all years and ultimately affects the survey-catchability estimate but will not influence the shape of the index timeseries.

We assumed that the spatial random effects ($\omega_s$) were drawn from a multivariate normal distribution with a covariance matrix $\bm{\Sigma}_\omega$:

$$
\bm{\omega} \sim \mathrm{MVNormal} \left( \bm{0}, \bm{\Sigma}_\omega \right).
$$

We constrained the spatial random effects to follow a \mbox{Mat\'ern} covariance
function, which defines the rate with which spatial correlation decays with
distance.
The \mbox{Mat\'ern} function describes the covariance $\Phi_\omega \left( s_j, s_k \right)$ between spatial locations $s_j$ and $s_k$ as:

$$
\Phi_\omega\left( s_j,s_k \right) = \tau_\omega^2/\Gamma(\nu)2^{\nu - 1}
    (\kappa d_{jk})^\nu K_\nu \left( \kappa d_{jk} \right),
$$

where $\tau_\omega^2$ represents the spatial variance, $\Gamma$ represents the Gamma
function, $K_\nu$ represents the Bessel function, $d_{jk}$ represents the
Euclidean distance between locations $s_j$ and $s_k$, and $\kappa$ represents
a scaling parameter that is estimated [e.g., @lindgren2011]. The parameter $\nu$
controls the smoothness of the covariance function. We set $\nu = 1$, which
lets us take advantage of the Stochastic Partial Differential Equation (SPDE)
approximation to Gaussian Markov Random Fields (GMRF) to greatly increase
computational efficiency [@lindgren2011].

We assumed the same structure for the spatiotemporal random effects, with each time slice being given its own independent set of random effects ($\bm{\epsilon}_t$) with covariance matrix $\bm{\Sigma}_{\epsilon,t}$:

$$
\bm{\epsilon}_t \sim \mathrm{MVNormal} \left( \bm{0}, \bm{\Sigma}_{\epsilon,t} \right).
$$

This covariance matrix is also constrained to follow a \mbox{Mat\'ern} covariance
function with the same $\kappa$ but its own $\tau_\epsilon^2$ (spatial variance):

$$
\Phi_\epsilon\left( s_j,s_k \right) = \tau_\epsilon^2/\Gamma(\nu)2^{\nu - 1}
    (\kappa d_{jk})^\nu K_\nu \left( \kappa d_{jk} \right).
$$

Although we have described the \mbox{Mat\'ern} functions above using the simple isometric form for simplicity (spatial correlation is the same in all directions), we actually allowed for anisotropy in the spatial and spatiotemporal correlation [e.g., @thorson2015].

The spatial random effects accounted for spatial factors that were constant across time, for example, depth and substrate type.
The spatiotemporal random effects accounted for factors that varied spatially from year-to-year, such as bottom temperature, water circulation patterns, species interactions, and species movement.
As sensitivity analyses, we included alternate versions of our models that: (1) also accounted for depth; and (2) did not account for hook competition.

We fit our model with the sdmTMB R package [@sdmtmb] and TMB [@tmb] using a "mesh" with 400 predictive-process "knots" generated by INLA [@lindgren2011; @rue2016] with locations determined by a K-means clustering algorithm (Figure \@ref(fig:hbll-spde)).
We estimated the fixed effects via maximum likelihood with the random effects set to the values that maximized the joint likelihood conditional on the estimated value of fixed effects.
We checked that the model fits were consistent with convergence by checking that the maximum gradient across all estimated coefficients was < 0.001 and that the covariance matrix was positive-definite.

We projected predictions from the model to the full survey domain (Figure \@ref(fig:hbll-area-grid)) using the covariance projection matrix and the bilinear interpolation mesh provided by INLA [@lindgren2011; @rue2016] (Figures \@ref(fig:hbll-spde) and \@ref(fig:hbll-predicted-spacetime)).
In terms of the model components, the spatial random effects were, by definition, constant across years (Figure \@ref(fig:hbll-spatial-re)), and the spatiotemporal random effects varied across years (Figure \@ref(fig:hbll-spatiotemporal-re)).

We then calculated expected biomass $B_t$ in year $t$ as:

$$
B_t = \sum_{j = 1}^{n_j}
  w_j \cdot \exp \left( \bm{X}_{j,t} \bm{\beta} + \bar{\bm{O}} + \omega_j + \epsilon_{j,t} \right),
$$

where $j$ references a grid cell within the survey domain, $w_j$ represents the area of that grid cell (Figure \@ref(fig:hbll-area-grid)), and $\bar{\bm{O}}$ represents the mean offset value.
In other words, we summed the predicted biomass across all grid cells within the survey domain for each year.
We generated standard errors on the annual estimates of log biomass via the generalized delta method as implemented in TMB [@tmb].

The resulting standardized population index accounts for the irregular sampling of the survey domain and hook competition and "stitches" the northern and southern regions into a single population index (Figure \@ref(fig:hbll-index)).
The inclusion of depth or the exclusion of the hook competition adjustments had relatively minor effects on the population index (Figure \@ref(fig:hbll-index)).
The model was also able to "fill in" what the index might hypothetically look like for the northern and southern regions independently (Figure \@ref(fig:hbll-index)).
Note that this statistical interpolation cannot account for one-off events in the unobserved region, such as an abnormally high abundance only in the northern region in a year when the southern region was surveyed.

### Simulation-testing survey "stitching" via spatiotemporal models {#sec:hbll-sim}

We undertook a basic simulation analysis to test that our approach of "stitching" northern and southern regions into a single survey domain was reasonable from a statistical perspective.
We generated a system that roughly matches the HBLL survey data we worked with in this document:

* 10 years of observations
* 100 possible spatial observation locations $s_j$ and $s_k$ drawn from a Uniform(0, 1) distribution each year.
* A marginal SD($\omega_s$) = 2.2
* A marginal SD($\epsilon_{s,t}$) = 0.3
* A \mbox{Mat\'ern} parameter $\kappa = 0.1$
* Annual means drawn from a Lognormal(0.1, 0.2) distribution
* A Poisson observation process (for simplicity vs. a negative binomial)

We simulated the underlying true mean abundance on a complete [0, 1] grid with 25 x 25 evenly sized grid cells.
We then discarded the northern and southern regions (above or below 0.5) in alternating years, to render approximately 50 observations per year, and attempted to fit the same form of spatiotemporal model as the one used for the HBLL index standardization (Figure \@ref(fig:stich-sim-pred)).

Despite the model only observing alternating northern and southern regions, the model was able to reconstruct the unobserved missing portions based on the estimated spatial correlation, and to a lesser extent, the estimated spatiotemporal correlation (Figure \@ref(fig:stich-sim-pred)).
By projecting the model predictions onto a grid over the full area of the simulated square, our model was able to produce an index that was similar to the true index (Figure \@ref(fig:stich-sim-index)).
If we instead naively generated the index using an approach to mimic a design-based approach (by summing the observed abundances each year and scaling it to the same geometric mean for visualization purposes), the resulting index does not reflect the true index trend in many years (Figure \@ref(fig:stich-sim-index)).

Through experimentation (not shown) we found that the stitching was most accurate at recapturing the true index if the magnitude of spatial correlation deviations ($\omega_s$) was much larger than the magnitude of spatiotemporal correlation deviations ($\epsilon_{s,t}$).
This is the case in our HBLL model, where the marginal standard deviation of $\omega_s$ was approximately six times larger than the marginal standard deviation of $\epsilon_{s,t}$.
The stitching was most needed when there was a north to south gradient in abundance, as seems evident for Yelloweye Rockfish.

```{r}
include_figs <- function(file) {
  knitr::include_graphics(here::here("figs", file), dpi = NA)
}
```

```{r hbll-raw, fig.cap="Inside HBLL survey observations of Yelloweye Rockfish. Gray background shading indicates the northern and southern survey areas. The area of the circles represents the number of fish caught per hook after accounting for hook competition.", out.width="\\textwidth"}
include_figs("hbll-joint-raw-data.png")
```

```{r hbll-area-grid, out.width="5in", fig.cap="Area per survey grid cell that is in water for the inside HBLL survey. The predicted count density for each grid cell is scaled up to the full survey domain based on these areas."}
include_figs("hbll-area-in-water.png")
```

```{r hbll-baited, fig.cap="Proportion baited hooks returned for the inside HBLL survey. Note the substantial difference between the northern and southern areas and the change in the north between 2003--2007 and subsequent years.", out.width="\\textwidth"}
include_figs("hbll-joint-baited.png")
```

```{r hbll-hook-adjustment, fig.cap="Hook adjustment factor for the inside HBLL survey accounting for the number of hooks and the number of returned baited hooks.", out.width="\\textwidth"}
include_figs("hbll-joint-hook-adjust.png")
```

```{r hbll-spde, fig.cap="Stochastic Partial Differential Equation (SPDE) mesh for the HBLL. The open grey circles in the background (often hidden) represent the locations of the observed data and the red dots represent the \"knots\". The lines show the triangularization mesh used in the SPDE approximation and bilinear interpolation. A greater number of knots will increase the accuracy of the approximation at the expense of computational time.", out.width="0.6\\textwidth"}
include_figs("hbll-joint-spde.png")
```

```{r hbll-predicted-spacetime, fig.cap="Predicted relative density in space and time for the inside HBLL survey. Observed (hook-adjusted) counts are illustrated with circles. Predictions are illustrated with colour shading.", out.width="\\textwidth"}
include_figs("hbll-joint-prediction-log.png")
```

```{r hbll-spatial-re, fig.cap="The spatial random effects. These are consistent spatially correlated differences in expected abundance through time. The values are shown in link (log) space.", out.width="4.2in"}
include_figs("hbll-joint-omega.png")
```

```{r hbll-spatiotemporal-re, fig.cap="The spatiotemporal random effects. These are spatially correlated deviations that change through time. Note the reversion to the mean in area-year combinations without sampling data. Note the difference in magnitude between the spatial random effects (previous figure) and these spatiotemporal random effects.", out.width="\\textwidth"}
include_figs("hbll-joint-epsilon.png")
```

```{r hbll-index, out.width="4in", fig.cap="The joint relative abundance index. Top panel shows the joint prediction from the spatial temporal model. Included are three versions: (1) random effects and annual means only, (2) adding a depth covariate, and (3) removing the hook adjustment factor. The middle and bottom panels show the joint predictions for the northern and southern areas. All shaded regions represent 95\\% confidence intervals. The joint index timeseries in the top panel have been scaled to have the same geometric mean as the main ``HBLL INS'' index for visualization purposes. Dashed vertical lines indicate years with surveys (mostly) in the southern area."}
include_figs("hbll-index-components-eps-depth2.png")
```

\clearpage

```{r stich-sim-pred, fig.cap="Simulation testing the relative abundance index calculation with alternating north and south observations. (A) The true simulated (mean) abundance in space and time. (B) The observed (dots) and estimated (colour) counts in space and time from the geostatistical model. The observations occur in north and south regions in alternating years and are ``blind'' to the missing region. Notice how the spatial temporal model is able to predict what the abundance should be in the ``blind'' region based on the consistent spatial correlation pattern (and to a lesser degree the spatiotemporal correlation pattern).", out.width="\\textwidth"}
include_figs("geostatistical-sim-predicted.png")
```

\clearpage

```{r stich-sim-index, fig.cap="Simulation testing the relative abundance index calculation with alternating north and south observations. The solid red line represents the true simulated abundance through time. The dashed and dotted green line represents a ``naive'' design-based estimate, which is calculated here by calculating the abundance with just the observed north or south counts in each year. The dashed blue line represents a geostatistical standardized index that attempts to account for the north-south biennial observations. The shaded blue region represents the modelled 95\\% confidence interval.", out.width="5in"}
include_figs("geostatistical-sim-stitched-index.png")
```

\clearpage

## DOGFISH SURVEY INDEX {#sec:dogfish-index-data}

```{r dogfish-model}
m <- readRDS(here::here("data-generated/dogfish-model.rds"))
est <- as.list(m$sd_report, "Estimate")
se <- as.list(m$sd_report, "Std. Error")
d2004 <- m$data %>% dplyr::filter(year == 2004)
hook_comparison <- d2004 %>% select(circle_hook, ye_count, fe_begin_retrieval_time) %>% reshape2::dcast(fe_begin_retrieval_time~circle_hook, value.var = "ye_count") %>% select(-fe_begin_retrieval_time) %>% rename(j_hook = `0`, circle_hook = `1`)
```

The Dogfish survey samples nine locations in the Strait of Georgia that were historically fished by the commercial Dogfish fishery [@king2012].
The survey began in 1986 and sampling has occurred in 1989, 2005, 2011, 2014, and 2019.
The survey is a depth-stratified longline survey that uses snap on gear with 300 size 14/0circle hooks baited with Pacific Herring and a two-hour soak time.
A more detailed description of survey methods is provided in @king2012.
For most of the time series, set-by-set catch of rockfish has been recorded.
Beginning in 2019, hook-by-hook data for all captured species were collected on board, along with biological data for rockfish.
We use a spatiotemporal model to estimate the density of Yelloweye Rockfish per km^2^. We calculated the area swept by multiplying the number of hooks deployed by the estimated distance between hooks (8 ft spacing) and the estimated width swept (the length of two gagnions).

The Dogfish survey is not designed to index rockfish, so there are several important differences between the inside HBLL and Dogfish survey designs. Perhaps the most significant difference is that the HBLL specifically targets habitats suitable for rockfish (i.e. hard bottom), whereas the Dogfish survey visits sites that were important in the commercial fishery that have mainly soft sediment bottoms. The Dogfish survey also uses slightly larger circle hooks than the HBLL survey (14/0 vs. 13/0); herring bait instead of squid; fishes 300 hooks per set instead of 225; and the hooks are spaced 1.8m apart instead of 2.4m. We use the Dogfish survey in this analysis because it provides the longest time series of fishery independent data for inside Yelloweye Rockfish and because it was used in the previous assessment in 2011. 

### Hook comparison {#sec:dog-hook-comparison}

The survey fished with J hooks originally and then changed to circle hooks in 2005.
In 2004, @mcfarlane2005 undertook a calibration study to assess the potential for a change in catch rates due to the change in hook type.
However, the study compared catch rates for Dogfish only, and the hook change likely affected catchability for Yelloweye Rockfish differently than for Dogfish.
The previous assessment attempted to deal with this by estimating a catchability ratio, using data for all rockfish, to scale the catch in the 1980s [@yamanaka2011].
It is not clear from their description how this catchability ratio was estimated.
The previous assessment was quite sensitive to the resulting Dogfish index (because of the large decline from the 1980s), and that decline was largely dependent on the hook ratio.

In the hook comparison study, `r sum(d2004$circle_hook)` sets used circle hooks and `r sum(d2004$circle_hook)` sets used J hooks.
On these experimental sets, `r sum(hook_comparison$j_hook)` Yelloweye Rockfish were caught on J hooks and `r sum(hook_comparison$circle_hook)` were caught on circle hooks Table \@ref(tab:dogfish-hook-comparison).
Although this represents a relatively small sample size of fish for estimating a hook correction factor for Yelloweye Rockfish,
by simultaneously estimating the correction factor while standardizing the population index using a geostatistical model, we were able to incorporate uncertainty in the correction factor into the resulting index standard errors (Section \@ref(sec:dog-index-model)).
Nonetheless, it is important to note that this correction factor is based on a limited number of sets. It is driven largely by five sets with one or two more Yelloweye Rockfish caught by circle hooks than J hooks and two sets with 12 and four Yelloweye Rockfish caught by circle hooks vs. zero by J hooks (Table \@ref(tab:dogfish-hook-comparison)).

\clearpage

```{r dogfish-hook-comparison, results='asis'}
hook_comparison %>%
  mutate(Set = 1:n()) %>%
  select(Set, j_hook, circle_hook) %>%
  csasdown::csas_table(caption = "Number of Yelloweye Rockfish caught in J-hook/circle-hook experiment in 2004.", col_names = c("Set", "J-hook", "Circle hook"))
```

### Depth {#sec:dog-depth}

In addition to the survey not being designed for rockfishes, and the change in gear type, the shallower depth stratum was dropped in 2004 and later surveys.
This was done to purposely try to avoid catching rockfish (because of conservation concerns).
While depth is not explicitly included in the spatiotemporal model, the spatial random effects should absorb much of the variation driven by depth while also accounting for other spatially varying effects.

### Hook competition {#sec:dog-hook-competition}

The previous inside Yelloweye Rockfish assessment indicates they used an exponential hook competition model on the Dogfish Survey data in 2011.
However, there are no data on the number of baited and empty hooks available for the Dogfish Survey prior to 2019 and it is unclear how the previous assessment accounted for this.
Therefore, we did not apply an explicit hook competition model in the present analysis.
However, to partially account for hook competition, we included the number of Dogfish caught (log transformed so as to have a multiplicative effect on observed account) as a covariate in the model.

### Spatiotemporal Dogfish survey index standardization {#sec:dog-index-model}

We used a similar geostatistical model to that described for the HBLL survey (Section \@ref(sec:hbll-spatiotemporal)) with the addition of Dogfish and hook-type covariates.
We included the log Dogfish count and hook-type in the model matrix $\bm{X}_{s,t}$:

\begin{align}
  y_{s,t} &\sim \mathrm{NegBin}(\mu_{s,t}, \phi),\\
  \mu_{s,t} &= \exp \left( \bm{X}_{s,t} \bm{\beta} + O_{s,t} + \omega_s + \epsilon_{s,t} \right),
(\#eq:dogfish-model)
\end{align}

with symbols defined as in Equation \@ref(eq:hbll-model).
Hook-type is an identifier for J-hook vs. circle-hook.
The offset represents the log(area swept), as previously defined.
We fit our model with sdmTMB [@sdmtmb] as described above with 300 knots.

In our projection of the model predictions onto the survey grid to calculate the standardized relative abundance:

$$
B_t = \sum_{j = 1}^{n_j}
  w_j \cdot \exp \left( \bm{X}_{j,t} \bm{\beta} + \bar{\bm{O}} + \omega_j + \epsilon_{j,t} \right),
(\#eq:dog-prediction)
$$

with symbols defined as above, we could predict for a J-hook or a circle hook.
Choosing one or the other would place more of the uncertainty in the years with one or the other since the other effect's uncertainty would be incorporated in only some years.
As a compromise, we chose to predict for an average hook type across the data set to distribute this hook-type uncertainty across the timeseries.
In practice, this meant coding circle hooks as `r round(min(m$data$circle_hook_centered), 2)` and J hooks as `r round(max(m$data$circle_hook_centered), 2)` in the model-fitting matrix $\bm{X}_{s,t}$ and setting the equivalent predictor in the prediction model matrix to 0.

We estimated that J hooks caught
`r sprintf("%.1f", round(exp(est$b_j[1]), 1))` times more Yelloweye Rockfish than circle-hooks, all else being equal, but with considerable uncertainty (95% confidence interval (CI): `r sprintf("%.1f", round(exp(est$b_j[1] - 1.96 * se$b_j[1]), 1))` -- `r sprintf("%.1f", round(exp(est$b_j[1] + 1.96 * se$b_j[1]), 1))`).
We estimated the log Dogfish effect to be `r sprintf("%.2f", round((est$b_j[10]), 2))` (95% CI: `r sprintf("%.2f", round((est$b_j[10] - 1.96 * se$b_j[10]), 2))` -- `r sprintf("%.2f", round((est$b_j[10] + 1.96 * se$b_j[10]), 2))`).
This means that we can expect to catch, on average, about `r -10 * round(est$b_j[10], 2)`% (95% CI: `r  -10 * round(est$b_j[10] + 1.96 * se$b_j[10], 2)`% -- `r -10 * round(est$b_j[10] - 1.96 * se$b_j[10], 2)`%)
fewer Yelloweye Rockfish for every 10% additional Dogfish also caught on the same set, presumably due to hook competition.

In Equation \@ref(eq:dog-prediction), we set up the prediction grid cells, indexed by $j$, by overlaying a 500 m x 500 m grid on the survey-domain. 
Because the Dogfish survey uses fixed stations rather than a randomly sampled grid, rectangles were manually drawn around all of the historically fished longline sets in order to delineate the area sampled (Figure \@ref(fig:dog-raw)).
We calculated the grid cell areas ($w_j$) after removing portion of the fine-scale grid cells that overlapped land.
We set up the design matrix $\bm{X}_{j,t}$ to predict for a mean Dogfish count and a mean area-swept offset.

The resulting projection of the model onto the fine-scale grid is shown in Figure \@ref(fig:dog-prediction) along with the modelled spatial (Figure \@ref(fig:dog-spatial)) and spatiotemporal (Figure \@ref(fig:dog-spatiotemporal)) random-effect values.
The standardized index for Yelloweye Rockfish for an average hook type indicates a decline in relative abundance from the 1980s to the next survey in 2004, but with considerable uncertainty (Figure \@ref(fig:dog-standardized-index)).
The index remained relatively stationary from 2004 until 2014 with a slight increase in the mean from 2014 to 2019, but again with considerable uncertainty (Figure \@ref(fig:dog-standardized-index)).

\clearpage

```{r dog-raw, fig.cap="Yelloweye Rockfish caught per area swept by hooks in the Dogfish Survey. The values are shown as area of circles. Grey rectangles illustrate the assumed survey domain.", out.width="\\textwidth"}
include_figs("dogfish-yelloweye-per-area-data.png")
```

```{r dog-prediction, fig.cap="Predicted Yelloweye Rockfish relative abundance (colour). The colour scale is log transformed. Circles represent the same observed data as in the previous figure.", out.width="\\textwidth"}
include_figs("dogfish-prediction-log.png")
```

```{r dog-spatial, fig.cap="Spatial random effects from the spatiotemporal model shown in log space. This represents consistent spatial correlation through time.", out.width="4.2in"}
include_figs("dogfish-omega.png")
```

```{r dog-spatiotemporal, fig.cap="Spatiotemporal random effects from the spatiotemporal model shown in log space. These panels represent spatial correlation that varies through time.", out.width="\\textwidth"}
include_figs("dogfish-epsilon.png")
```

```{r dog-standardized-index, fig.cap="The resulting standardized Yelloweye Rockfish relative abundance index. Dots represent mean estimates and line segments represent 95\\% confidence intervals. The dashed vertical line represents the year of the hook experiment and the switch from J hooks to circle hooks.", out.width="5in"}
include_figs("dogfish-index-estimated-hook.png")
```

\clearpage

<!--chapter:end:09-app-survey-data.Rmd-->

# CATCH DATA {#app:catch-data}

Inside Yelloweye Rockfish is targeted in hook and line commercial fisheries, Food Social and Ceremonial (FSC) fisheries, and recreational fisheries.
Management of Inside Yelloweye Rockfish fisheries began in 1986, with the introduction of the "ZN" category commercial licence and daily bag limits for recreational fishermen.
A chronology of management changes for  commercial and recreational fisheries is shown in Tables \@ref(tab:comm-mgt-changes) and \@ref(tab:rec-mgt-changes).

## COMMERCIAL CATCH DATA {#sec:com-catch-data}

Rockfish catch data can be grouped into three time periods: historic (1918-1950), early electronic (1951--2005), and modern (2006 onwards).
There are two major sources of uncertainty in the historical and early electronic periods for Inside Yelloweye Rockfish.
The first uncertainty is that rockfish catch, other than Pacific Ocean Perch (*Sebastes alutus*), was reported as an aggregate (other rockfish, ORF) in the historic period.
To reconstruct historical catches an algorithm was developed by DFO authors [@haigh2011].
The reconstruction algorithm applies a ratio calculated from a period with credible landings data from the hook and line dockside monitoring program (1997--2005) to generate a time series of catch by species, year, fishery sector, and management area [@haigh2011].
"Credible" landings data are taken from reference years where catch knowledge was considered high quality and stable, beginning in 1997 with the start of observer trawl coverage and the individual vessel quota system [@haigh2011]. 

The second major source of uncertainty is the magnitude of unreported catch that was released or discarded at sea, prior to the introduction of 100% observer coverage in 2006.
The catch reconstruction of @haigh2011 assumes no discarding prior to 1986, when the ZN licence was instituted.
Prior to that it is assumed all rockfish were kept. Discards are assumed to be fully reported in DFO databases since 2006 and the introduction of 100% observer coverage.
Non-retained Yelloweye Rockfish catch (releases or discards) was estimated for each fishery using the ratio of Yelloweye Rockfish discarded by a fishery to fishery-specific landed targets using data from 2000--2004 hook and line observer logs.
The estimated historical unreported catch was then incorporated into the catch reconstruction, giving a final annual total.  

The commercial catch time series used in this analysis (Figure \@ref(fig:commcatch2) and Table \@ref(tab:commcatch)) differs from the one previously reported in 2009, for several reasons.
Ongoing quality control and updates to the groundfish catch database resulted in minor differences in the data over time (Maria Surry, DFO, Pacific Biological Station, pers. comm., March 9, 2020).
As well, an earlier version of the catch reconstruction algorithm was used to develop the time series for the previous stock assessment, as the final version had not yet been published.
Further refinements to the reconstruction algorithm resulted in significant changes to the estimated historical catch in some years (Norm Olsen, DFO, Pacific Biological Station, pers. comm., March 9,2020).

The reconstruction algorithm could have been applied to all years in the time series until to 2005 (after which, full at-sea and dockside monitoring came into effect).
However, for this analysis we used the reconstructed catch data from 1918--1985, and switched to the nominal catch data in 1986.
The nominal catch from 1986--2005 was then doubled,to be consistent with the previous assessment [@yamanaka2011].
We made the choice to double the nominal catch rather than the reconstructed catch because, prior to the previous assessment, advice from industry representatives indicated they did not have confidence in the catch reconstruction between 1986 and 2005, and that the scale of unreported catch was probably equal to landed catch [@dfo2012b].
As a result of this advice, the catch for these years was doubled [@yamanaka2011]. However, because discards are estimated as part of the catch reconstruction algorithm, in the current analysis we doubled the nominal catch for the period 1986--2005 (rather than the reconstructed catch), to avoid double counting of discards.
As a sensitivity check, we explore one OM scenario where the 1986--2005 commercial catches were not doubled (the "Low catch" Scenario (2), Section \@ref(sec:approach3-reference2)). 

```{r commcatch2, out.width="0.8\\textwidth", fig.width=6, fig.cap="Commercial catch by sector for Inside Yelloweye Rockfish. This figure contains reconstructed (1918--1985) and nominal (1986--2019) catch estimates in tonnes."}
comm_catch <- read.csv(here("data-raw/ye_catch_by_sector.csv"))

tidyr::pivot_longer(comm_catch, -1) %>%
  mutate(name = gfutilities::firstup(gsub("_", " ", name))) %>%
  mutate(name = gsub("Hook line rockfish", "Hook and line rockfish", name)) %>%
  mutate(name = gsub("Dogfish lingcod", "Dogfish and lingcod", name)) %>%
  dplyr::filter(name != "Total t") %>% 
  ggplot(aes(year, value, fill = name)) + geom_col(width = 1) +
  gfdlm::theme_pbs() +
  scale_fill_brewer(palette = "Set2") + 
  coord_cartesian(expand = FALSE) +
  labs(fill = "Sector", y = "Catch (t)") +
  theme(axis.title.x = element_blank(), legend.position = "bottom",
    plot.margin = margin(t = 11 / 2, r = 11 / 2 + 5, b = 11 / 2, l = 11 / 2)
)
```


\clearpage

```{r commcatch, warning = FALSE, results = "asis"}

csasdown::csas_table(comm_catch,
  format = "latex",
  col_names = c("Year", "Trawl", "Halibut", "Dogfish and Lingcod", "Hook and Line Rockfish", "Total"),
  repeat_header = TRUE,
  caption = "Commercial catch by sector for Inside Yelloweye Rockfish. The table contains reconstructed (1918--1985) and nominal (1986--2019) catch estimates in tonnes. Although nominal catch is shown, total catch for each year between 1986-2005 was doubled in all OMs except the 'Low Catch' scenario. This was done for consistency with the previous stock assessment in 2012."
) %>%
  kableExtra::column_spec(1, width = "1.0cm") %>%
  kableExtra::column_spec(2:6, width = "2cm")  
```

\clearpage

## RECREATIONAL CATCH DATA {#sec:rec-catch-data}

In 2012, DFO established a coast-wide, internet-based survey of tidal water licence holders (iRec), which collects Yelloweye data [@dfo2015].
However, the results of the survey have not been calibrated to account for uncertainties such as non-response bias. Therefore the iRec data were not included in this analysis.

### Reconstructed historical recreational catch {#sec:recon-rec-catch-data}

Historical recreational catch, prior to 1982 was reconstructed for the previous assessment based on trends in fishing effort developed through interviews with the owners of a recreational fishing resort [@yamanaka2011].
We used the same historical time series of reconstructed recreational catch for the current analysis (Table \@ref(tab:rectable)).

### Creel survey data 1982-2019 {#sec:creel-catch-data}

Annual catch of inside Yelloweye Rockfish by the recreational fishery is estimated by the Strait of Georgia (SOG) and the Northern Vancouver Island (NVI) creel surveys in all PFMAs (Figure \@ref(fig:map-4B)).
The surveys cover PFMAs 12--20, 28, and 29 [@zetterberg2010].
Rockfish catch has been recorded in areas 13--19, 28, and 29 since 1982 but was not enumerated by species until 2000.
In PFMA 12 rockfish have been counted by species since 2000, with no records prior to 2000 [@zetterberg2010].

We followed the same method as in @yamanaka2011 to estimate the recreational catch of Inside Yelloweye Rockfish from 1982 to 1999.
First, for all PFMAs other than PFMA 12, the average proportion of Yelloweye Rockfish to total rockfish catch was calculated for each PFMA in 2000 and 2001.
The average proportions were then used to derive estimates of Yelloweye Rockfish catch from the total rockfish catch by PFMA between 1982--1999.
The previous assessment assumed that the proportion of Yelloweye Rockfish catch in PFMA 12, out of the total Yelloweye catch in the SOG, would remain relatively constant over time.
Therefore, to estimate catch of Yelloweye Rockfish in PFMA 12 for the years 1982--1999, the proportion of Yelloweye Rockfish caught in PFMA 12, out of the total Yelloweye Rockfish caught in the SOG in 2000 and 2001, was calculated.
The average proportion over 2000 and 2001 was then multiplied by the total Yelloweye Rockfish catch estimated for the rest of the SOG (sum of areas 13--19, 28 and 29) to estimate Yelloweye Rockfish catch in PFMA 12 by year. (Table \@ref(tab:recbyarea)).
To be consistent with the previous assessment, an adjustment of 1.09 was applied to total annual effort to account for lack of records in PFMA 12, where effort was not recorded prior to 2000.
We converted rockfish pieces to weight by multiplying by 2.49 kg, which was the average weight of Yelloweye sampled in the creel surveys between 2000 and 2008.

We did not develop a CPUE index for the recreational fishery, despite the availability of recent creel survey data. Since the imposition of management procedures aimed at conservation of rockfishes (Table \@ref(tab:rec-mgt-changes)) there has been a shift towards active avoidance of Rockfish in recreational fisheries. As a result, there is concern that a CPUE series for the recreational fishery would not be responsive to changes in abundance and therefore could be misleading for assessment purposes. 

\clearpage

```{r reccatch, out.width="0.8\\textwidth", fig.width=6, fig.cap="Recreational catch for Inside Yelloweye Rockfish. The black line indicates reconstructed catch and the bars are creel survey data. The data are a combination of reconstructed catch (1918--1981), catch parsed from total rockfish catch in creel surveys (1982-1999), and catch from species specific creel surveys (1982--2019)."}
rec_catch <- readr::read_csv(here("data-raw/rec-allcatch-effort.csv"))
 
# make a bar plot of recreational catch
ggplot() + 
  geom_line(data=filter(rec_catch, year <= 1981), aes(year, catch) ) +
  geom_col(data=filter(rec_catch, year %in% 1982:1999), aes(year, catch, fill="#999999"), width = 1 ) +
  geom_col(data=filter(rec_catch, year >= 2000), aes(year, catch, fill = "#E69F00"), width = 1 ) +
  gfdlm::theme_pbs() +
  coord_cartesian(expand = FALSE) +
  labs( y = "Catch (t)") +
  theme(axis.title.x = element_blank(), legend.position = "bottom",
    plot.margin = margin(t = 11 / 2, r = 11 / 2 + 5, b = 11 / 2, l = 11 / 2) ) +
  scale_fill_discrete(name = "Data Source", labels = c("Creel Survey:all rockfish", "Creel Survey:species specific"))

```

```{r rectable, echo = FALSE, warning = FALSE, results = "asis"}
# make a table of recreational catch
rec_catch <- rec_catch %>% mutate(catch = round(catch, 1)) %>% 
  mutate(effort= round(effort, 0)) %>% 
  mutate_if(is.numeric , replace_na, replace = "--") 

csasdown::csas_table(rec_catch,
  format = "latex",
  col_names = c("Year", "Catch (t)", "Effort (boat trips)"),
  align = c("c", "c", "c"),
  digits = 1,
  repeat_header = TRUE,
  caption = "Recreational catch for Inside Yelloweye. The data are a combination of reconstructed catch (1918--1981), catch parsed from total rockfish catch in creel surveys (1982-1999), and catch from species specific creel surveys (1982--2019)."
)
```


\clearpage

```{r recbyarea, echo=FALSE, warning=FALSE, results = "asis"}
rec_area <- readr::read_csv(here("data-raw/rec-catcheffortbyarea.csv"))

# organizing the data from long to wide format
rec_wide <- rec_area %>%
  select(year, tonnes, totaleffort, pfma) %>%
  mutate(tonnes = round(tonnes,1)) %>% 
  mutate(totaleffort = round(totaleffort, 0)) %>% 
  pivot_wider(names_from = pfma, values_from = c(tonnes, totaleffort)) %>%
  mutate(effort = round(rowSums(.[13:23], na.rm = TRUE) / 10000, 0)) %>%
  select(-starts_with("totaleffort")) %>%
  rename_at(vars(starts_with("tonnes_")), list(~ stringr::str_remove(., "tonnes_"))) %>% 
  mutate_if(is.numeric , replace_na, replace = "--") %>% 
  rename(Year = year, Effort = effort)


# make the table of catch by PFMA and total effort by year
csasdown::csas_table(rec_wide,
  format = "latex",
  digits = 1,
  caption = "Recreational catch estimates of Yelloweye Rockfish (tonnes) from the inside Strait of Georgia creel survey by statistical area (PFMA) and total effort in 10,000 boat trips by year from 1982 to 2019. Numbers of fish were converted to weight using 2.49 kg (average weight of yelloweye rockfish in the creel survey 2000--2008)."
) %>%
  kableExtra::column_spec(1:13, width = "0.75cm")
```


\clearpage

## FOOD, SOCIAL, AND CEREMONIAL CATCH (FSC) {#sec:fsc-catch-data}

Yelloweye Rockfish are an important traditional food source for coastal First Nations in BC [@eckert2018], including in the inside waters of 4B.
Total FSC catch of Yelloweye Rockfish is not available for either the historic or contemporary time period, and the available data is not resolved to the species level (M. Fetterly, DFO Policy Treaty Support, pers. comm., November 7, 2019 and  A. Rushton, DFO South Coast Fisheries Management, pers. comm., February 7, 2020).
To account for FSC catch in the last stock assessment, @yamanaka2011 used a consumption rate (0.23 kg/year/person), which was half of the consumption rate determined in a traditional diet study from Southeast Alaska.
They applied the consumption rate to the First Nations population near area 4B to estimate total consumption over the time series (1918-2009).
This approach assumes that the consumption rate of Yelloweye Rockfish by First Nations has remained constant, despite the fact that European colonization is known to have impacted most aspects of Indigenous society over this same time period.
A decline in the amount of fish and seafood consumed by First Nations in BC has been attributed to numerous social, ecological, and economic factors; including the loss of traditional territories, diminished traditional knowledge transmission, and barriers such as poverty that makes buying boats and fishing gear unattainable for many communities [@marushka2019].
Specific to the southern part of our study area, the Coast Salish people have seen their relationship to marine resources eroded due to the development of commercial and recreational fisheries, as well as policy and political decisions [@ayers2012].
We did not, therefore, follow the methods used in @yamanaka2011.

The only FSC data that are available are from the commercial dockside monitoring program (DMP) between 2006 and 2019 (Table \@ref(tab:fsc-catch)).
These data were collected from "dual fishing" trips, which occur when indigenous fishers choose to keep some of the catch obtained during a commercial fishing trip for FSC purposes.
Both commercial and FSC catch are monitored during the offload.
Between 0 and 0.8 tonnes amounting to an average of 5.6% of the total commercial catch has been landed on dual fishing trips in this time period.
The FSC catch from these dual trips is included in the annual totals for commercial catch within the groundfish sector databases. 
The DMP catch data can only be resolved to the trip level rather than the set level, so some of the dual fishing data may be from outside of area 4B (i.e. include the catch of Outside Yelloweye). 
In order to deal with this, if more than 50% of the sets on a trip took place in 4B, we included them in the commercial catch data for 4B.
Conversely, we excluded trips that had 50% or more sets completed outside of 4B. 
Most of the dual fishing trip took place in the northern part of the study area because this is also where most of the commercial fishing for Yelloweye Rockfish in 4B currently takes place.
Indigenous fishers from the member First Nations represented by the A-Tlegay Fisheries Society, are largely obtaining Yelloweye Rockfish on dual fishing trips (C. Rusel, pers. comm., November 8, 2019).

In the southern part of the study area, indigenous fishers have little commercial capacity.
FSC catch in the Strait of Georgia is, therefore, primarily from small recreational boats (C. Ayers, pers. comm., November 7, 2019; B. Bocking, pers. comm., November 7, 2019).
Some FSC effort from small boats will be captured in the recreational data from the creel survey program.
Although FSC fishers are not constrained by recreational catch limits or closures, their boats will be counted on the aerial portion of the creel survey, and therefore contribute to the expanded recreational catch estimates.
The proportion of FSC fishers encountered by the dockside creel monitor was not, however, readily available in the recreational database (CREST) (P. Zetterberg, DFO, pers. comm., November 29, 2019).

As we have shown, there are limited information available to assist with quantifying FSC catch of Inside Yelloweye Rockfish. Without more detailed information it is not possible to reliably estimate any impact of FSC catch on the results of this analysis. Greater collarboration with First Nations could help address some of these data issues, and should be a priority for future analyses. 

\clearpage

```{r fsc-catch, echo=FALSE, results = "asis"}
fsc_catch <- readr::read_csv(here("data-raw/fsc-dmp.csv")) %>% 
  dplyr::mutate(year = gsub("total", "Total", year)) %>% 
  dplyr::mutate(year = gsub("mean", "Mean", year))
csasdown::csas_table(fsc_catch,
  format = "latex",
  col_names = c("Year", "FSC", "Commercial", "Total", "Percent FSC"),
  caption = "FSC catch of Inside Yelloweye Rockfish as a proportion of total commercial catch reported to dockside observers from dual fishing trips."
)
```

\clearpage

## CHRONOLOGY OF MANAGEMENT CHANGES {#sec:management-changes}


```{r comm-mgt-changes, echo=FALSE, warning=FALSE, results="asis"}

comm_timeline <- readr::read_csv(here("data-raw/comm-management.csv")) %>% 
  dplyr::mutate(Year = gsub("-", "--", Year))

csasdown::csas_table(comm_timeline,
  format = "latex",
  col.names = c("Year", "Area", "Management Action"),
  caption = "History of management changes for the commercial Rockfish fishery in area 4B from 1986 to 2019."
)%>%
  kableExtra::column_spec(1, width = "2.5cm") %>%
  kableExtra::column_spec(2, width = "1.75cm") %>%
  kableExtra::column_spec(3, width = "7.5cm")

```

\clearpage

```{r rec-mgt-changes, echo=FALSE, warning=FALSE, results="asis"}
timeline <- readr::read_csv(here("data-raw/management-chronology.csv")) %>% 
  dplyr::mutate(Year = gsub("-", "--", Year))

csasdown::csas_table(timeline,
  format = "latex",
  col.names = c("Year", "Area", "Management Action"),
  caption = "History of management changes for the recreational Rockfish fishery from 1986 to 2019."
) %>%
  kableExtra::column_spec(1, width = "2.5cm") %>%
  kableExtra::column_spec(2, width = "1.75cm") %>%
  kableExtra::column_spec(3, width = "7.5cm")
```


<!--chapter:end:10-app-catch-data.Rmd-->

```{r load-oms, message = FALSE}
knitr_results <- TRUE
knitr_echo <- TRUE
library(purrr)
sc <- readRDS(here::here("mse/om/ye-scenarios2.rds"))
oms <- sc$scenario %>% set_names() %>%
  map(~ readRDS(here::here(paste0("mse/om/", .x, ".rds")))@OM)
names(oms) <- sc$scenario_human
nsim <- oms[[1]]@nsim
```

```{r display-om}
display_om <- function(om, slot) {
  out <- NULL
  x <- purrr::map(om, slot)
  cpars <- purrr::map(om, ~.x@cpars[[slot]])
  if ((length(unique(x)) == 1L && is.null(unlist(cpars))) |
      (length(unique(cpars[[1]])) == 1L && !is.null(unlist(cpars)))) {
    out <- x[[1]]
  } else if ((length(unique(x)) > 1L && is.null(unlist(cpars)))) {
    out <- reshape2::melt(x) %>% 
      dplyr::mutate(type = rep(c("min", "max"), length(om)/2)) %>%
      tidyr::pivot_wider(names_from = type, values_from = value) %>%
      dplyr::rename(scenario = L1)
  }
  if (!is.null(unlist(cpars)) && length(unique(cpars[[1]])) > 1L) {
    dat <- reshape2::melt(cpars)
    out <- ggplot(dat, aes(value)) + 
      geom_histogram(position="identity", bins = 18, fill = "grey85", 
        colour = "grey50") + 
      facet_wrap(~L1, nrow = 2) +
      gfdlm::theme_pbs() + 
      coord_cartesian(expand = FALSE) + 
      xlab(slot) +
      ylab("Frequency")
  }
  out
}
```

# INSIDE YELLOWEYE ROCKFISH OPERATING MODEL DEFINITION {#app:desc-om-yelloweye}

Here we describe the specification of the initial OM before conditioning with the SRA model.
The operating model is fully described in Appendix A of @anderson2020gfmp.
We use a convenience function `display_om()` to display the contents of various parameters in the OMs.
The object `oms` is a list of the operating models across the various OM scenarios.
If a given "slot" or OM parameter is entered as a single value then `display_om()` outputs a single value.
Where a range of values is displayed, this represents the lower and upper boundaries of a uniform distribution.
Where a "slot" or OM parameter is defined based on a stochastic distribution other than a uniform distribution, we demonstrate the sampling from that distribution along with the stochastic seed used to generate consistent samples.

## STOCK SLOT DESCRIPTIONS {#app:desc-stock-yelloweye}

<!-- slot-chunk-begin -->
### maxage {#app:desc-stock-maxage-yelloweye}

*The maximum age of individuals that is simulated.*

The maximum observed age of Inside Yelloweye Rockfish is 101 *y* [@databases2019].
Here we set a maximum age of 80 *y*, noting that the maximum age class is treated as a plus group once the OM is conditioned by the SRA [@anderson2020gfmp].

```{r desc-stock-maxage-yelloweye, results = knitr_results, echo = knitr_echo}
display_om(oms, "maxage")
```
<!-- slot-chunk-end -->

<!-- slot-chunk-begin -->
### M {#app:desc-stock-m-yelloweye}

*Natural mortality rate.*

The rate of natural mortality *M* is a core uncertainty for this stock, as for many stocks. 
We incorporated uncertainty using a Monte Carlo approach, by sampling *M* from a prior probability distribution based on that used by @yamanaka2011, where $M \sim \textrm{Lognormal}(0.045, 0.2)$ (with the seed in R set to 91283).
This was based on the Hoenig equation [@hoenig1983] using an assumed maximum age of 101 years.
The exception was OM Scenario (A), which used the distribution $M \sim \textrm{Lognormal}(0.025, 0.2)$.

```{r, eval=FALSE, echo=TRUE}
# pseudo code:
set.seed(91283)
OM@cpars$M <- rlnorm(nsim, log(0.045) - 0.5 * 0.2^2, 0.2)

set.seed(91283)
OM_Scenario_A@cpars$M <- rlnorm(nsim, log(0.025) - 0.5 * 0.2^2, 0.2)
```

```{r desc-stock-m-yelloweye, results = knitr_results, echo = knitr_echo, fig.cap="Distributions of natural mortality (\\emph{M}) used in the OM scenarios. All OMs used the same distributions except \"(A) Low M\"."}
display_om(oms, "M")
```
<!-- slot-chunk-end -->

<!-- slot-chunk-begin -->
### h {#app:desc-stock-h-yelloweye}

*Steepness of the stock-recruit relationship.*

Steepness (*h*) is another core uncertainty for most stocks. We incorporated uncertainty using a Monte Carlo approach, by sampling *h* from a prior probability distribution based on that published by @forrest2010 and used in @yamanaka2011, where $X \sim \textrm{Beta}(\alpha = 9.6, \beta = 5.5)$, which was then transformed to $h = 0.8 X + 0.2$.
The values for $\alpha$ and $\beta$ were selected to give mean *h* = 0.71 and standard deviation 0.1. While the standard deviation of 0.1 is lower than the value of 0.15 given in @yamanaka2011, a larger standard deviation is more likely to generate lower values of *h* with *F*~MSY~ < 0.01, which seemed implausible. The value of 0.1 still gave steepness values between 0.5--0.9, which appeared to be a sufficiently wide range of coverage.

```{r, eval=TRUE, echo=TRUE}
alphaconv <- function(m, sd) m * (((m * (1 - m)) / (sd^2)) - 1)
betaconv <- function(m, sd) (1 - m) * (((m * (1 - m)) / (sd^2)) - 1)

h_alpha <- alphaconv((0.71 - 0.2), 0.12)
h_beta <- betaconv((0.71 - 0.2), 0.12)
set.seed(65423)
h_samps <- 0.8 * rbeta(nsim, h_alpha, h_beta) + 0.2
mean(h_samps) %>% round(2)
sd(h_samps) %>% round(2)
```

```{r, eval=FALSE, echo=TRUE}
OM@cpars$h <- h_samps
```

```{r desc-stock-h-yelloweye, results = knitr_results, echo = knitr_echo, fig.cap="Distributions of steepness (\\emph{h}) used in the OM scenarios. All OMs used the same \\emph{h} samples."}
display_om(oms, "h")
```
<!-- slot-chunk-end -->

<!-- slot-chunk-begin -->
### Perr {#app:desc-stock-perr-yelloweye}

*Process error, the CV of lognormal recruitment deviations.*

We used a value of 0.4, as estimated in the base model for the Outside Yelloweye Rockfish rebuilding plan [@cox2020].
```{r desc-stock-perr-yelloweye, results = knitr_results, echo = knitr_echo}
display_om(oms, "Perr")
```
<!-- slot-chunk-end -->

<!-- slot-chunk-begin -->
### Linf {#app:desc-stock-linf-yelloweye}

*Mean asymptotic length.*

This value was estimated from length and age data from the survey data collected in Area 4B (see Appendix \@ref(app:biological-data)).
This parameter was estimated for both males and females combined, as no sexual dimorphism has been observed for this stock.

```{r desc-stock-linf-yelloweye, results = knitr_results, echo = knitr_echo}
display_om(oms, "Linf")
```
<!-- slot-chunk-end -->

<!-- slot-chunk-begin -->
### K {#app:desc-stock-k-yelloweye}

*von Bertalanffy growth parameter.*


This value was estimated from length and age data from the survey data collected in Area 4B (see Appendix \@ref(app:biological-data)).
This parameter was estimated for both males and females combined, as no sexual dimorphism has been observed for this stock.


```{r desc-stock-k-yelloweye, results = knitr_results, echo = knitr_echo}
display_om(oms, "K")
```
<!-- slot-chunk-end -->

<!-- slot-chunk-begin -->
### t0 {#app:desc-stock-t0-yelloweye}

*von Bertalanffy theoretical age at length zero.*


This value was estimated from length and age data from the survey data collected in Area 4B (see Appendix \@ref(app:biological-data)).
This parameter was estimated for both males and females combined, as no sexual dimorphism has been observed for this stock.


```{r desc-stock-t0-yelloweye, results = knitr_results, echo = knitr_echo}
display_om(oms, "t0")
```
<!-- slot-chunk-end -->

<!-- slot-chunk-begin -->
### Maturity {#app:desc-stock-maturity-yelloweye}

*Maturity ogive.*

Maturity was directly input as an age-based function.
Therefore the default DLMtool slots `L50` and `L50_95` were not used.
Female maturity-at-age was estimated using maturity and age data from the survey data collected in Area 4B (Appendix \@ref(app:biological-data)).
The minimum observed age of maturity was seven years and it assumed that younger ages were all immature.

```{r desc-stock-maturity, eval = FALSE, echo = TRUE}
create_maturity_ogive <- function(A50, A95, maxage, Amin) {
  ages <- 1:maxage
  mat_age <- 1/(1 + exp(log(19) * (ages - A50)/(A95 - A50)))
  return(ifelse(ages < Amin, 0, Amin, mat_age))
}
OM@cpars$Mat_age <- create_maturity_ogive(14.4, 27.4, OM@maxage, 7) %>% 
  array(OM@maxage, OM@nyears + OM@proyears, OM@nsim) %>% aperm(c(3, 1, 2))
```

<!-- slot-chunk-end -->

<!-- slot-chunk-begin -->
### a {#app:desc-stock-a-yelloweye}

*Length-weight parameter alpha.*

This value was estimated from length and weight data from the survey data collected in Area 4B (see Appendix \@ref(app:biological-data)).
This parameter was estimated for both males and females combined, as no sexual dimorphism has been observed for this stock.

```{r desc-stock-a-yelloweye, results = knitr_results, echo = knitr_echo}
display_om(oms, "a")
```
<!-- slot-chunk-end -->

<!-- slot-chunk-begin -->
### b {#app:desc-stock-b-yelloweye}

*Length-weight parameter beta. Positive real number.*

This value was estimated from length and weight data from the survey data collected in Area 4B (see Appendix \@ref(app:biological-data)).
This parameter was estimated for both males and females combined, as no sexual dimorphism has been observed for this stock.

```{r desc-stock-b-yelloweye, results = knitr_results, echo = knitr_echo}
display_om(oms, "b")
```
<!-- slot-chunk-end -->

## FLEET SLOT DESCRIPTIONS {#app:desc-fleet-yelloweye}

<!-- slot-chunk-begin -->
### CurrentYr {#app:desc-fleet-currentyr-yelloweye}

*The current calendar year (final year) of the historical simulations ($t_c$).*

```{r desc-fleet-currentyr-yelloweye, results = knitr_results, echo = knitr_echo}
display_om(oms, "CurrentYr")
```
<!-- slot-chunk-end -->

<!-- slot-chunk-begin -->
### nyears {#app:desc-fleet-nyears-yelloweye}

*The number of years for the historical period.*

The time series of historical catch data $t_1 = 1918$ to $t_c = 2019$ was used to define the historical period of the operating model.
 
```{r desc-fleet-nyears-yelloweye, results = knitr_results, echo = knitr_echo}
display_om(oms, "nyears")
```
<!-- slot-chunk-end -->


<!-- slot-chunk-begin -->
### Selectivity {#app:desc-fleet-selectivity-yelloweye}

Selectivities for all commercial and survey fleets were directly input as age-based logistic functions in the SRA model.
Therefore the default DLMtool slots describing selectivity-at-length were not used.

Selectivity-at-age in the HBLL survey was set to give 5% selectivity at 6.8 *y* and full selectivity at age = 22 *y*, in all OM scenarios except Scenario (4), where selectivity-at-age was estimated using available age-composition data (Figure \@ref(fig:HBLL-selectivity)).
Due to large uncertainties in selectivity-at-age in the Dogfish survey, selectivity in this survey was set to mirror selectivity in the HBLL survey.

(ref:fig-HBLL-selectivity) Selectivity-at-age for the HBLL survey, which was fixed for all OM scenarios except Scenario (4). Note that selectivity in the Dogfish Survey was set to mirror the selectivity in the HBLL survey within simulation replicates.

```{r HBLL-selectivity, fig.cap="(ref:fig-HBLL-selectivity)", out.width="6.3in"}
knitr::include_graphics(here::here("mse/figures/HBLL-selectivity.png"))
```

Selectivities-at-age in the recreational and commercial fleets were based on the values used in @cox2020 (Figure \@ref(fig:sra-selectivity)).
Commercial and recreational selectivity was fixed in the SRA model, for all OM scenarios.
For the recreational fleet, the age-at-50% and 95% selectivity was 6.7 *y* and 11.5 *y*, respectively.
For the commercial hook and line fleet, the age-at-50% and 95% selectivity was 14.4 *y* and 21 *y*, respectively.

(ref:fig-sel-fleet) Selectivities-at-age used in the SRA model for the recreational and commercial fleets.

```{r sra-selectivity, fig.cap="(ref:fig-sel-fleet)", out.width="3.8in"}
knitr::include_graphics(here::here("mse/figures/fishery-selectivity2.png"))
```

For the projection period ($t > t_c$), the DLMtool OM only accommodates one fishing fleet.
In analyses with more than one fishing fleet, selectivity-at-age is passed from the SRA back to the DLMtool OM as an average catch-weighted selectivity function, based on normalized SRA estimates of relative fishing mortality by age and year $F_{a,y}$ (see Appendix A of @anderson2020gfmp).
The closed-loop simulation projections assume that the relative selectivities across fleets remains constant, as estimated by the SRA in the final historical year($t_c$) (Figure \@ref(fig:om-selectivity)).

(ref:fig-om-sel) Selectivity-at-age in years $t \geq t_c$ for the combined commercial and recreational fleets in the OM projections.

```{r om-selectivity, fig.cap="(ref:fig-om-sel)", out.width="4.5in"}
knitr::include_graphics(here::here("mse/figures/fishery-selectivity-terminal-year.png"))
```

<!-- slot-chunk-end -->

\clearpage


## OBS SLOT DESCRIPTIONS {#app:desc-obs-yelloweye}

<!-- slot-chunk-begin -->
### Cobs {#app:desc-obs-cobs-yelloweye}

*Observation error in the catch expressed as a SD.*

This parameter ($\sigma_C$) sets the standard deviation of the simulated catch for the projection period. The DLMtool operating model can generate $\sigma_C$ based on the residuals between the predicted and observed catch. Since the SRA model conditions the OM on observed catch, the predicted catch will match the observed catch and thus, $\sigma_C < 0.01$.

<!-- slot-chunk-end -->

<!-- slot-chunk-begin -->
### Cbias {#app:desc-obs-cbias-yelloweye}

*Bias in the catch.*

This parameter controls the bias, expressed as the ratio of simulated observed to true catches, i.e. under/overreporting, for the projection period. The DLMtool operating model can estimate the bias parameter as the ratio of mean observed and mean predicted catch. Since the SRA model conditions the OM on observed catch, the ratio is 1.

<!-- slot-chunk-end -->

<!-- slot-chunk-begin -->
### Iobs {#app:desc-obs-iobs-yelloweye}

*Observation error in the relative abundance indices expressed as a SD.*

This parameter ($\sigma_I$) sets the standard deviation in simulated survey indices for the projection period.
We set $\sigma_I = 0.25$, based on the standard deviation of the observed HBLL index for all OM scenarios except Scenario (B), where $\sigma_I$ was set based on the standard deviation and autocorrelation from the index residuals in OM Scenario (1) (see Section \@ref(sec:approach3-referenceB)).

<!-- slot-chunk-end -->

<!-- slot-chunk-begin -->
### beta {#app:desc-obs-beta-yelloweye}

*A parameter controlling hyperstability/hyperdepletion where values below 1 lead to hyperstability (an index that decreases more slowly than true abundance) and values above 1 lead to hyperdepletion (an index that decreases more rapidly than true abundance). Uniform distribution*

We set the hyperstability/hyperdepletion parameter $\beta = 1$  to imply no hyperstability or hyperdepletion.

<!-- slot-chunk-end -->

## IMP SLOT DESCRIPTIONS {#app:desc-imp-yelloweye}

<!-- slot-chunk-begin -->
### TACFrac {#app:desc-imp-tacfrac-yelloweye}

*Mean fraction of TAC taken. Uniform distribution.*

We assumed no implementation error.

```{r desc-imp-tacfrac-yelloweye, results = knitr_results, echo = knitr_echo}
display_om(oms, "TACFrac")
```
<!-- slot-chunk-end -->

<!-- slot-chunk-begin -->
### TACSD {#app:desc-imp-tacsd-yelloweye}

*Log-normal CV in the fraction of TAC taken. Uniform distribution.*

We assumed no implementation error.

```{r desc-imp-tacsd-yelloweye, results = knitr_results, echo = knitr_echo}
display_om(oms, "TACSD")
```
<!-- slot-chunk-end -->


<!--chapter:end:11-app-om.Rmd-->


\newpage

# DATA-LIMITED MANAGEMENT PROCEDURES {#app:mps}

Here we present the MPs that were evaluated in the current study. See @anderson2020gfmp for a full list of MPs available in the MP Framework.

## CONSTANT-CATCH MANAGEMENT PROCEDURES {#sec:mp-cc}

We evaluated three alternative constant-catch MPs: 

- CC_5t:  Constant annual catch of 5 t
- CC_10t: Constant annual catch of 10 t 
- CC_15t: Constant annual catch of 15 t

## INDEX-BASED MPs {#sec:mp-ibased}

### Index-ratio MPs {#sec:mp-iratio}

Index-ratio MPs base their TAC recommendation in year $y$ on last year's catch $C_{y-1}$ multiplied by the ratio of the average population index in a recent time period (e.g., the last two years) compared to the average population index in a previous short period. Therefore the reference population index is a moving window average.

The TAC is calculated as:

$$
\textrm{TAC}_y = \alpha C_{y-1},
$$

where, for example,

$$
\alpha =
\left. \frac{I_{y-1} + I_{y-2}} {2} \middle/
\frac{I_{y-3} + I_{y-4} + I_{y-5}} {3} \right. ,
$$

where $\alpha$ is the ratio of the mean index in the most recent two years and the mean index in years 3--5 before the current year.

We evaluated two configurations of the index-ratio MPs, which differ in the time periods used to calculate $\alpha$, applied annually:

- Iratio_23:     ratio of the last 2 years to the previous 3 years

- Iratio_55:     ratio of the last 5 years to the previous 5 years

We also evaluated the same two configurations, applied every five years:

- Iratio_23_5u:  same as Iratio_23

- Iratio_55_5u:  same as Iratio_23

### Index-Slope MPs {#sec:mp-islope}

Index-slope MPs fit a linear regression of population index data compared to time and make a catch recommendation based on the slope of the regression. 
They are closely related to index-ratio MPs.
Here we describe three main "families" of index-slope MPs.

#### GB_slope: Geromont and Butterworth index slope {#sec:mp-gb-slope}

This MP adjusts TAC based on previous catch and the trend in a relative abundance index to aim for relatively stable catch rates [@geromont2015].
The TAC is calculated as:

$$
\textrm{TAC}_y= C_{y-1}(1+\lambda \beta_I),
$$

where $C_{y-1}$ is catch from the previous year, $\beta_I$ is the slope of a linear regression of the ln abundance index over the last $n$ years (default of $n = 5$), and $\lambda$ is a control parameter between 0 and 1 that adjusts how quickly TAC is adjusted based on the slope of the index. The default $\lambda$ value is 1 in DLMtool.
The TAC is subject to the following conditions that limit the rate at which the TAC can be adjusted up or down:

- if next TAC > 1.2 last catch, then TAC = 1.2 $\times$ last catch
- if next TAC < 0.8 last catch, then TAC = 0.8 $\times$ last catch.

We evaluated three configurations of GB_slope, each applied annually:

- GB_slope_lambda1:   $\lambda = 1$	and  $\beta_I$ is calculated from index in the preceding 5 years

- GB_slope_lambda05:  $\lambda = 0.5$	and $\beta_I$ is calculated from the preceding 5 years 

- GB_slope_yrs10:     $\lambda = 1$	and  $\beta_I$ is calculated from the preceding 10 years

We also evaluated the same three configurations, applied every five years:

- GB_slope_lambda1_5u

- GB_slope_lambda05_5u

- GB_slope_yrs10_5u

Illustrations of the GB_slope MPs are provided in @anderson2020gfmp (their Appendix D)

#### Islope: Index slope tracking {#sec:mp-islope-track}

These MPs incrementally adjust the TAC in an attempt to maintain a constant relative abundance index.
The MPs are similar to "GB_slope" with the addition of a parameter that determines the TAC in the first projection year ($\textrm{TAC}^*$) and different choices of the $\lambda$ parameter.
The TAC is calculated as:

$$
\textrm{TAC}_y = \textrm{TAC}^*(1+\lambda \beta_I),
$$

where, in the first projection year, $\textrm{TAC}^*$ is $(1-x)$ multiplied by the mean catch from the last 5 historical years.
We set $x=0$ for all configurations of the Islope MP.
In subsequent years, $\textrm{TAC}^*$ is the TAC from the previous year.
Again, $\lambda$ is a gain or smoothing parameter, and $\beta_I$ is the slope of the ln abundance index over the past $n$ years.

As for the GB_slope MPs, we evaluated three configurations of the Islope MPs, applied annually:

- Islope_10_lambda04:  $\lambda = 0.4$ and $\beta_I$ is calculated from the preceding 10 years

- Islope_10_lambda08:  $\lambda = 0.8$ and $\beta_I$ is calculated from the preceding 10 years

- Islope_5_lambda04:   $\lambda = 0.4$ and $\beta_I$ is calculated from index in the preceding 5 years

We also evaluated the same three configurations, applied every five years:

- Islope_10_lambda04_5u

- Islope_10_lambda08_5u

- Islope_5_lambda04_5u

Illustrations of the Islope MPs are provided in @anderson2020gfmp (their Appendix D)

#### IDX: Index-based MP from @cox2020 {#sec:mp-idx}

This MP was used in the rebuilding plan for Outside Yelloweye Rockfish in BC [@cox2020].
The MP assigns TAC based on:

$$
\textrm{TAC}_y =
\begin{cases}
\textrm{TAC}_\textrm{Floor}, & \textrm{if}\ \Delta I_y \leq \delta_\textrm{min} \\
(1 + \Delta I_y ) \textrm{TAC}_{y-1}, & \textrm{if}\ \delta_\textrm{min} \lt \Delta I_y \leq \delta_\textrm{max} \\
(1 + \delta_\textrm{max}) \textrm{TAC}_{y-1}, & \textrm{if}\ \Delta I_y \gt \delta_\textrm{max},
\end{cases}
$$

where $\delta_\textrm{min}$ is the most negative drop allowed in the relative biomass index before the fishery is closed that year and $\Delta I_y$ is defined as:

$$
\Delta I_y = \frac{I_y}{I_{y-n}} - 1,
$$

where $I_y$ refers to a population index value in year $y$ and $n$ determines the reference year.
We set $\textrm{TAC}_\textrm{Floor} = 5 t$.
We set $\delta_\textrm{min} = -0.5$ as in @cox2020.
The maximum increase in TAC is capped at $\delta_\textrm{max} = 0.25$ by default.
This means that the TAC in any one year cannot increase by more than 25%, implementing a "slow up" behaviour of the MP.
The parameters $\delta_\textrm{min}$ and $\delta_\textrm{max}$ could possibly be additionally tuned to adjust the behaviour of the MP.

Note that the "slow-up--fast-down" behaviour determined by settings for $\delta_\textrm{min}$ and $\delta_\textrm{max}$, combined with the simulated survey index variability, can result in the MP "ratcheting" down the TAC despite an overall increasing index (e.g., Figure \@ref(fig:proj-not-satisficed-eg)).
Furthermore, we implemented the MP exactly as described above and in @cox2020, which only uses $\textrm{TAC}_\textrm{Floor}$ if $\Delta I_y \leq \delta_\textrm{min}$.
This does *not* stop the TAC from slowly being lowered below $\textrm{TAC}_\textrm{Floor}$ by the "ramp" described by $(1 + \Delta I_y ) \textrm{TAC}_{y-1}$ if $\delta_\textrm{min} \lt \Delta I_y \leq \delta_\textrm{max}$ (e.g., Figure \@ref(fig:proj-not-satisficed-eg)).

This MP can be additionally smoothed:

$$
\textrm{TAC}_y = \lambda \cdot \textrm{TAC}_y + (1-\lambda) \textrm{TAC}_{y-1},
$$

where $\lambda$ controls the degree of smoothing and can range between 0 and 1. @cox2020 used $\lambda=0.5$.
We define these MPs for DLMtool as "IDX" ($\delta_{\textrm{min}} = -0.5$, $\delta_{\textrm{max}} = 0.25$) and "IDX_smooth" (same as IDX but with $\lambda = 0.5$ to split the difference between the upcoming proposed TAC and the one previously recommended).

We evaluated three configurations of the IDX MPs, applied annually:


- IDX                : IDX with $\Delta I_y = \frac{I_y}{I_{y-1}} -1$ 

- IDX_smooth         : IDX_smooth with $\Delta I_y = \frac{I_y}{I_{y-1}} -1$ 
  

- IDX_smooth_yrs5    : IDX with $\Delta I_y = \frac{I_y}{I_{y-5}} -1$

- IDX_yrs5           : IDX_smooth with $\Delta I_y = \frac{I_y}{I_{y-5}} -1$ 

We also evaluated the same four configurations, applied every five years:

- IDX_5u

- IDX_smooth_5u

- IDX_smooth_yrs5_5u

- IDX_yrs5_5u

Illustrations of the IDX MPs are provided in @anderson2020gfmp (their Appendix D).

## MODEL-BASED MANAGEMENT PROCEDURES {#sec:mp-model-based}

### Surplus Production Model {#sec:mp-sp}

In addition to the empirical MPs described above, we evaluated a surplus production (SP) model, paired with a harvest control rule as a model-based MP.
Here, we use the surplus production model implemented in MSEtool [@huynh_msetool_2019] and TMB [@tmb], based on @fletcher1978.
The SP model used in this framework is fully documented in @anderson2020gfmp (their Appendix D).
Note that the SP model uses all available indices in the historical period, but only the HBLL survey in the projection period.

We paired the model with two ramped harvest control rules (Figure \@ref(fig:mp-hcrs)):

1. HCR-8040: Above 80% of $\hat{B}/\hat{B}_\textrm{MSY}$, $F_y = \hat{F}_\textrm{MSY}$; at or below 40% of estimated $\hat{B}/\hat{B}_\textrm{MSY}$, $F_y = 0$; between 40% and 80%, interpolate the adjustment factor linearly.
Note that the hat notation indicates the reference point was estimated in the SP MP. 
This HCR creates operational control points that mimic the provisional biological upper stock reference and limit reference points from DFO's Sustainable Fisheries Framework (Figure \@ref(fig:pa-illustration)), where operational control points define the thresholds of management action (i.e., reducing fishing mortality).

2. HCR-4010: Above 40% of estimated $\hat{B}/\hat{B}_0$ (biomass divided by unfished equilibrium spawning biomass), $F_y = \hat{F}_\textrm{MSY}$; at 10% of estimated $\hat{B}/\hat{B}_0$, $F_y = 0$; between 10% and 40%, interpolate the adjustment factor linearly.
This is a commonly applied HCR in the fisheries literature and on the US West Coast [e.g., @berger_2019].
Note that this reference point is based on MP estimates of *B*~0~, whereas HCR-8040 is based on *B*~MSY~.

We evaluated two configurations of the SP model MPs, applied every five years:

- SP_8040_5u: SP model paired with HCR-8040

- SP_4010_5u: SP model paired with HCR-4010

We also evaluated the same two configurations, applied every 10 years:

- SP_4010_10u

- SP_8040_10u



```{r, mp-hcrs, fig.cap="Proposed provisional harvest control rules associated with model-based MPs.", fig.asp=0.38, fig.width=7.5, out.width="0.8\\textwidth"}
f <- function (Brel, LRP, TRP, rel_min = 0, rel_max = 1, ...) {
    adj <- rep(rel_max, length(Brel))
    adj[Brel <= LRP] <- rel_min
    cond <- Brel > LRP & Brel < TRP
    adj[cond] <- (rel_max - rel_min)/(TRP - LRP) * (Brel[cond] -
        LRP) + rel_min
    adj
}

pars4010 <- expand.grid(
  Brel = seq(0, 1, length.out = 200),
  LRP = c(0.1),
  TRP = c(0.4),
  type = "HCR-4010", stringsAsFactors = FALSE)
pars4010$tac <- purrr::pmap_dbl(pars4010, f)

pars8040 <- expand.grid(
  Brel = seq(0, 1, length.out = 200),
  LRP = c(0.4),
  TRP = c(0.8),
  type = "HCR-8040", stringsAsFactors = FALSE)
pars8040$tac <- purrr::pmap_dbl(pars8040, f)

parsMSY <- expand.grid(
  Brel = seq(0, 1, length.out = 200),
  LRP = NA,
  TRP = NA,
  type = "HCR-MSY", stringsAsFactors = FALSE)
parsMSY$tac <- 1

pars <- bind_rows(pars8040, pars4010) %>%
  bind_rows(parsMSY)

pars$type <- as.factor(pars$type)
pars$type <- forcats::fct_relevel(pars$type, "HCR-MSY", "HCR-4010", "HCR-8040")

make_hcr_fig <- function(dat, xlab = expression(Estimated~B/B[0])) {
  ggplot(dat, aes(Brel, tac)) +
  geom_line() +
  ggsidekick::theme_sleek() +
  labs(
    x = xlab,
    y = "TAC adjustment factor\n(proportion of MSY)"
  ) +
  geom_vline(aes(xintercept = LRP), lty = 2, alpha = 0.4) +
  geom_vline(aes(xintercept = TRP), lty = 2, alpha = 0.4)
}

g1 <- make_hcr_fig(filter(pars, type == "HCR-4010")) + ggtitle("HCR-4010")
g2 <- make_hcr_fig(filter(pars, type == "HCR-8040"), expression(Estimated~B/B[MSY])) + ggtitle("HCR-8040")

cowplot::plot_grid(g2, g1, nrow = 1)
```


<!--chapter:end:12-app-mp.Rmd-->

# PINNIPED PREDATION {#app:pinniped-predation}

In response to concerns about increasing populations of Harbour Seals (*Phoca vitulina*), Steller Sea Lions (*Eumetopias jubatus*), and California Sea Lions (*Zalophus californianus*), @yamanaka2011 explicitly explored the potential impact of consumption of Yelloweye Rockfish by pinnipeds in inside waters. 
To do so, they used published and unpublished census data for pinniped populations and assumptions about consumption rates of rockfishes, based on bioenergetic requirements and existing pinniped diet information. 
The Rockfish component of the diet available for the three species of pinnipeds was resolved to the genus level (*Sebastes* spp.) because bone fragments and otoliths recovered from scat samples cannot be identified to species.
Therefore, @yamanaka2011 assumed that the fraction of Yelloweye Rockfish in pinnipeds' diets, as a percentage of total *Sebastes* spp., was the same as their mean occurrence in monitoring surveys (longline, jig and trawl surveys), which they calculated to be 25%. 
The same fraction was used for all three pinniped species despite the fact that the ecology of Harbour Seals, California Sea Lions and Steller Sea Lions differs significantly, as do their maximum weights: 80 kg, 390 kg, and 1100 kg, respectively [@ford2014].

In comparison to other common rockfish in the Strait of Georgia, such as Yellowtail, Copper, and Puget Sound Rockfishes, Yelloweye Rockfish are larger and dwell deeper. As a result, Yelloweye Rockfish are less likely to be consumed by smaller predators such as Harbour Seals and California Sea Lions.
Furthermore, Steller Sea Lions, Orca Whales (*Orcinus orca*) and Chinook Salmon (*Oncorhynchus tshawytscha*) are the only predators of Yelloweye Rockfish listed in a large data-base of predator-prey interactions (database assembled for @dunne2016; @szoboszlai2015). 
DFO pinniped researchers have been undertaking a major survey program to identify pinniped prey by species, using genetic analysis of scat samples. 
Preliminary results have not identified Yelloweye Rockfish in scat from Harbour Seals (n=1248) or California Sea Lions (n=116). These same results suggest that Yelloweye Rockfish make up 0.1% of the diet of Steller Sea Lions in the Strait of Georgia (n=331) and West Coast of Vancouver Island (n=340) (S. Tucker, DFO Science, unpublished data). 
It should be noted that this analysis is limited in temporal and spatial scope and the sample sizes for the data that have been analyzed to date are relatively small. 
In addition, the preliminary data available are the percent of species' DNA reads relative to total DNA reads and are not yet calibrated in terms of biomass yields to correct for methodological and biological biases (S. Tucker, DFO Science, pers. comm., April 7, 2020).    

Steller Sea Lions faced severe population declines in BC due to hunting and directed predator culls, which were in place 1912--1968, but their abundance began to increase following protection in 1970 [@ford2014; @olesiuk2018]. Inside Yelloweye Rockfish are at higher risk of predation by Steller Sea Lions during the winter, because sea lions aggregate at breeding rookeries along the outer coast during the summer, although a small number of animals (~500) have recently been observed year-round in the Strait of Georgia [@majewski2020].
Winter population estimates for sea lions are less certain than summer estimates because the animals spend more time in the water than hauled out on land, and are more widely dispersed, making them more difficult to count.
Steller Sea Lion abundance in BC is approximately 1.25 fold higher in the winter, as animals from adjacent jurisdictions overwinter in BC waters [@olesiuk2018].
@yamanaka2011 found that the proportion of Steller Sea Lions wintering in inside waters was fairly constant over time, at 4.8% of the winter counts in Southern BC. 
Using this proportion, they estimated the number of Stellar Sea Lions in 4B decreased to a low of around 500 animals in 1970 and then increased to approximately the abundance recorded at the beginning of the time series in 1913 (1,897 in 1913, vs. 1,837 in 2010).
Since 2010, Steller Sea Lion counts in BC have continued to increase [@olesiuk2018]; however, the estimated abundance from the 2017 survey falls within the CI of the 2013 estimate [@majewski2020].   

Mortality rates of Yelloweye Rockfish from Steller Sea Lion predation were probably lower in the second half of the 1900's (1959 and 1999), when fewer than 1,000 animals were estimated to be in inside waters (data presented in Tables F4 and F5 of @yamanaka2011) and have likely increased with the recovery of the Steller Sea Lion population to a level similar to, or higher than it was in the early 1900's.
Further investigations into Steller Sea Lion predation of Yelloweye Rockfish in space and time would be useful to refine mortality estimates as would methods to incorporate time-varying mortality. 




<!--chapter:end:13-app-pinnipeds.Rmd-->

# COSEWIC CONSIDERATIONS {#app:cosewic}

The Inside Yelloweye Rockfish stock is also listed under the *Species at Risk Act* (SARA) as a Species of Special Concern [@cosewic2008], and is anticipated to be reassessed by COSEWIC in 2020.
COSEWIC and DFO have different criteria for assessing the status of marine fish stocks.
DFO focuses on current status relative to some reference state or threshold, while COSEWIC criteria (based on IUCN Red List categories) are focused on the probability of decline over past generations and the probability of continued declines in the future [@cosewic2015].
COSEWIC applies a set of quantitative assessment criteria and guidelines to develop and assign a status to the stock in question.
To inform the reassessment of Inside Yelloweye Rockfish, we report results for two of COSEWIC's quantitative assessment criteria that may be applicable to this stock, Metric A and Metric E.

## COSEWIC METRIC A

COSEWIC Metric A measures the probability that the stock has declined by 70%, 50% and 30% after three generations, where one generation for Inside Yelloweye Rockfish is defined as 38 years.
Note that three generations under this definition is 114 years but since our historical period (1918-2019) is 102 years, we use this as an approximation of three generations.
These probability thresholds are used to assign status designations of endangered, threatened, and species of special concern respectively, although other factors, such as cause of decline, are also considered [@cosewic2015].
To inform the COSEWIC re-assessment of Inside Yelloweye Rockfish, we report the following for each OM (Figure \@ref(fig:cosewic-metrics)):

1. P70 - Probability that, on average, the stock declined below 70% of *B*~1918~ over three generations, where generation time is 38 years and probability is calculated as $P[1 - B_{2019}/B_{1918} > 0.7]$.
2. P50 - Probability that, on average,  the stock declined below 50% of *B*~1918~ over three generations.
3. P30 - Probability that, on average,  the stock declined below 30% of *B*~1918~ over three generations.

(ref:fig-cosewic-metrics)
Results for COSEWIC metric A, the probability that the stock was on average below 70%, 50%, and 30% of *B*~1918~ over the past three generations, for each OM scenario, where one generation is defined as 38 years. 

```{r cosewic-metrics, fig.cap="(ref:fig-cosewic-metrics)", out.width="3in"}
knitr::include_graphics(here("mse/figures/historical_indicators2.png"))
```

## EXTINCTION RISK - COSEWIC METRIC E

COSEWIC Metric E measures the probability of future extinction of the stock.
A stock is designated as endangered if the probability of extinction is 20% within 20 years (or five generations, whichever is longer) and threatened if there is a 10% probability of extinction within 10 years.
Criteria E is seldom applied to marine fishes, due to heavy reliance on data, and assumptions about parameters required as inputs to population viability analyses (Ross Claytor, COSEWIC, pers.comm, January 29, 2020).
Another requirement for estimating extinction risk involves setting the threshold for extinction, which is not explicitly defined in the COSEWIC criteria [@cosewic2015].  

In order to evaluate the probability of future extinction under candidate MPs, stock-specific extinction thresholds must be assigned.
Below these thresholds the stock would be considered functionally extirpated or extinct.
We propose two candidate extinction thresholds of 2%*B*~0~ and 5%*B*~0~.
These arbitrary thresholds were informed by precedents in the literature [e.g., @forrest2015 used 5%*B*~0~] and historical depletion estimates for other species in the Strait of Georgia e.g., Lingcod in the Strait of Georgia have been estimated to be depleted to as low as 2%*B*~0~ but are recovering [@logan2005]. 
In the future, simulation-testing of alternative thresholds could be used to identify stock-specific extinction thresholds.

Using a projection period of 100 years, we calculated the probability that, on average throughout the whole 100 year projection period, the stock remains above 2% and 5% *B*~0~ under the five satisficed MPs and the no fishing reference MP for each OM scenario individually (Figure \@ref(fig:cosewic-all)).
We also calculated the average probability that the stock remains above each threshold under these MPs across all OM reference set scenarios (Figure \@ref(fig:cosewic-avg)):

1. 2%B~0~ = $P[B_y > 0.02 B_0]$ on average during the whole projection period
2. 5%B~0~ = $[B_y > 0.05 B_0]$ on average during the whole projection period

The results of this analysis show that there is a very low risk of extinction under the satisficed MPs, using these thresholds.

(ref:fig-cosewic-all)
Probability that the Inside Yelloweye Rockfish stock remains above 2% and 5% of *B*~0~, by OM scenario and MP. 

```{r cosewic-all, fig.cap="(ref:fig-cosewic-all)", out.width="\\textwidth"}
knitr::include_graphics(here("mse/figures/ye-tigure-cosewic-all.png"))
```

\clearpage

(ref:fig-cosewic-avg)
Probability that the Inside Yelloweye Rockfish stock remains above 2% and 5% of *B*~0~, averaged across reference set OMs. 

```{r cosewic-avg, fig.cap="(ref:fig-cosewic-avg)", out.width="3in"}
knitr::include_graphics(here("mse/figures/ye-tigure-cosewic-avg.png"))
```


















\clearpage

<!--chapter:end:14-app-cosewic.Rmd-->

# COMPUTATIONAL ENVIRONMENT

This version of the document was generated on `r Sys.time()` with
`r devtools::session_info()$platform$version` [@r2019] and R package versions:

```{r env, echo = FALSE, results='asis', message=FALSE, warning=FALSE, eval=TRUE, cache=FALSE}
library(TMB, warn.conflicts = FALSE, quietly = TRUE)
library(bookdown, warn.conflicts = FALSE, quietly = TRUE)
library(rmarkdown, warn.conflicts = FALSE, quietly = TRUE)
library(purrr, warn.conflicts = FALSE, quietly = TRUE)
library(tidyr, warn.conflicts = FALSE, quietly = TRUE)
library(DLMtool, warn.conflicts = FALSE, quietly = TRUE)
library(MSEtool, warn.conflicts = FALSE, quietly = TRUE)
library(cowplot, warn.conflicts = FALSE, quietly = TRUE)
library(gfdlm, warn.conflicts = FALSE, quietly = TRUE)
library(gfdata, warn.conflicts = FALSE, quietly = TRUE)
library(gfplot, warn.conflicts = FALSE, quietly = TRUE)
pkgs <- sort(c(
  "gfplot", "ggplot2", "dplyr", "knitr",
  "TMB", "purrr", "cowplot", "csasdown", "bookdown", "rmarkdown",
  "gfdlm", "gfdata", "gfplot", "tidyr",
  "DLMtool", "MSEtool"
))
info <- devtools::session_info()$packages
stopifnot(all(pkgs %in% info$package))
info <- info %>%
  dplyr::filter(package %in% pkgs) %>%
  dplyr::select(package, ondiskversion, date) %>%
  dplyr::rename(Package = package, Version = ondiskversion, Date = date)

info %>%
  knitr::kable(booktabs = TRUE, linesep = "", longtable = TRUE, format = "pandoc") %>%
  kableExtra::kable_styling(latex_options = c("hold_position"))
```

```{r sha, cache=TRUE}
get_sha <- function(path) {
  if (!identical(.Platform$OS.type, "windows")) {
    suppressWarnings({
      sha <- tryCatch(system(paste0("git ls-remote git@github.com:", path, ".git"),
        intern = TRUE, ignore.stderr = TRUE
      ), error = function(e) "error")
    })
    if (is.null(attr(sha, "status")) && sha != "error") {
      out <- substr(sha[grepl("HEAD", sha)], 1, 7)
    } else {
      out <- "xxxxxxx"
    }
  } else {
    out <- "xxxxxxx"
  }
  out
}
# sha_gfmp <- get_sha("pbs-assess/gfmp")
sha_gfmp <- "c5da749"
sha_gfdlm <- get_sha("pbs-assess/gfdlm")
sha_gfdlm <- "b895686"
# sha_gfdata <- get_sha("pbs-assess/gfdata")
sha_gfdata <- "7292039"
# sha_gfplot <- get_sha("pbs-assess/gfplot")
sha_gfplot <- "e0b36c0"
# sha_mse <- get_sha("pbs-assess/MSEtool")
sha_mse <- "fa1498c"
# sha_dlm <- get_sha("DLMtool/DLMtool")
sha_dlm <- "fa971cf"
# sha_csasdown <- get_sha("pbs-assess/csasdown")
sha_csasdown <- "f9d5081"
# sha_ye <- get_sha("pbs-assess/yelloweye-inside")
sha_ye <- "2f9a8a4"
```

The source code for this document is available at:\
<`r paste0("https://github.com/pbs-assess/yelloweye-inside/tree/", sha_ye)`>.

This document was compiled with the R package csasdown [@csasdown].

The specific versions of the primary packages used to generate this report can be viewed at:

<`r paste0("https://github.com/DLMtool/DLMtool/tree/", sha_dlm)`>\
<`r paste0("https://github.com/tcarruth/MSEtool/tree/", sha_mse)`>\
<`r paste0("https://github.com/pbs-assess/gfdata/tree/", sha_gfdata)`>\
<`r paste0("https://github.com/pbs-assess/gfplot/tree/", sha_gfplot)`>\
<`r paste0("https://github.com/pbs-assess/gfdlm/tree/", sha_gfdlm)`>\
<`r paste0("https://github.com/pbs-assess/csasdown/tree/", sha_csasdown)`>\

\vspace{4mm}
or installed via:

`# install.packages('devtools')`\
`devtools::install_github('DLMtool/DLMtool', ref = '`r sha_dlm`')`\
`devtools::install_github('tcarruth/MSEtool', ref = '`r sha_mse`')`\
`devtools::install_github('pbs-assess/gfdata', ref = '`r sha_gfdata`')`\
`devtools::install_github('pbs-assess/sha_gfplot', ref = '`r sha_gfplot`')`\
`devtools::install_github('pbs-assess/gfdlm', ref = '`r sha_gfdlm`')`\
`devtools::install_github('pbs-assess/csasdown', ref = '`r sha_csasdown`')`\

\clearpage

<!--chapter:end:98-environment.Rmd-->

